# ğŸ”§ Get PDF Working Again - Pehle Jaisa!

## ğŸ“Š Analysis:

**Sample PDF (Working):** `neurosense-report-priyanka_sahare-1765018667310.pdf`
- âœ… Perfect format
- âœ… All 7 parameters
- âœ… Radar chart
- âœ… AI recommendations
- âœ… Professional design

**Current Error:** 404 Not Found
- âŒ PDFs not accessible at `/uploads/` path
- âŒ Backend not responding properly
- âŒ Files might exist but server not serving them

---

## ğŸ¯ What Was Working Before:

Based on sample PDF (Priyanka Sahare from Dec 6, 2025):

1. âœ… **Gemini AI** was working (generated content)
2. âœ… **PDF generation** was successful
3. âœ… **Backend** was properly configured
4. âœ… **File serving** was working

---

## âš ï¸ What's Broken Now:

1. âŒ **404 errors** on PDF URLs
2. âŒ **Backend not serving files** from `/uploads` folder
3. âŒ **"PDF: Not available"** status in history
4. âŒ **Multiple failed attempts** in console

---

## âœ… Fix Steps (Back to Working State):

### Step 1: Check Backend is Running

```bash
# Start backend
npm run dev:backend
```

**Expected output:**
```
ğŸš€ Neuro360 Backend Server running on port 5000
ğŸ“Š QEEG Processing API: http://localhost:5000/api/qeeg
âœ… Gemini API key present: true
âœ… Supabase credentials found (optional)
```

**If backend shows errors, continue to Step 2.**

---

### Step 2: Create/Fix .env File

Create `.env` file in **ROOT** folder (NOT in server folder):

```env
# ===== CRITICAL: Backend API Configuration =====
VITE_API_URL=http://localhost:5000/api

# ===== REQUIRED: Gemini AI Key =====
# Get from: https://aistudio.google.com/apikey
GEMINI_API_KEY=your-actual-gemini-api-key-here

# ===== OPTIONAL: Supabase (for cloud storage) =====
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key

# ===== Environment =====
NODE_ENV=development
PORT=5000
```

**Critical:** `GEMINI_API_KEY` must be valid! Get from https://aistudio.google.com/apikey

---

### Step 3: Install Dependencies (If Missing)

```bash
# Root folder
npm install

# Server folder
cd server
npm install
cd ..
```

---

### Step 4: Restart Both Servers

```bash
# Terminal 1: Backend
npm run dev:backend

# Terminal 2: Frontend (new terminal)
npm run dev
```

---

### Step 5: Hard Refresh Browser

```
Ctrl + Shift + R
```

Or clear browser cache:
```
Ctrl + Shift + Delete
â†’ Clear cache and cookies
```

---

### Step 6: Test PDF Generation

1. **Select patient** (e.g., Priyanka Sahare)
2. **Upload files:**
   - Eyes Open PDF
   - Eyes Closed PDF
3. **Click "Execute Calculation"**
4. **Wait for results** (right panel should show 7 parameters)
5. **Click "Save & Download NeuroSense Report"**
6. **Wait 30-60 seconds** (Gemini AI takes time)
7. **PDF should download automatically!**

---

## ğŸ” Troubleshooting:

### Issue 1: "Gemini API key not found"

**Backend shows:**
```
âŒ GEMINI_API_KEY not found
```

**Fix:**
1. Get API key: https://aistudio.google.com/apikey
2. Add to `.env`: `GEMINI_API_KEY=your-key`
3. Restart backend

---

### Issue 2: "Module not found" Errors

**Backend shows:**
```
Error: Cannot find module 'pdfkit'
```

**Fix:**
```bash
cd server
npm install pdfkit chartjs-node-canvas canvas @google/generative-ai
cd ..
npm run dev:backend
```

---

### Issue 3: "Port already in use"

**Backend shows:**
```
Error: listen EADDRINUSE :::5000
```

**Fix (Windows):**
```bash
# Find process on port 5000
netstat -ano | findstr :5000

# Kill it (replace PID)
taskkill /PID <PID_NUMBER> /F

# Restart backend
npm run dev:backend
```

---

### Issue 4: Backend Starts But PDFs Still 404

**Check uploads folder exists:**
```bash
# Should exist:
ls server/uploads
```

**If missing, create it:**
```bash
mkdir server/uploads
```

**Check backend serves static files:**

Look in `server/index.js` for:
```javascript
app.use('/uploads', express.static(path.join(__dirname, 'uploads')));
```

---

## ğŸ“Š Expected Working Flow:

### 1. User Uploads Files
```
Frontend â†’ Backend: POST /api/qeeg/process
Backend: Processing with Gemini AI...
Backend: Extracting data from PDFs...
Backend: Calculating 7 parameters...
Backend â†’ Frontend: Results with scores
```

### 2. User Clicks "Save & Download"
```
Frontend: Checking existing PDFs...
Frontend: No PDF found, generating...
Frontend â†’ Backend: POST /api/qeeg/generate-pdf
Backend: Using Gemini for AI content...
Backend: Creating PDF with PDFKit...
Backend: Saved to /uploads/neurosense-report-*.pdf
Backend â†’ Frontend: PDF URL
Frontend: Auto-downloading PDF...
User: PDF downloaded! âœ…
```

### 3. Backend Logs (Success)
```
ğŸ“„ === PDF Report Generation Started ===
ğŸ‘¤ Patient: Priyanka Sahare
ğŸ“Š Parameters: 7
ğŸ¤– Using Gemini AI PDF Generator
ğŸ“ Generating AI-powered PDF...
âœ… PDF Report Generated Successfully!
ğŸ“„ File: neurosense-report-priyanka_sahare-1765018667310.pdf
ğŸ“Š Size: 171 KB
ğŸ === PDF Generation Completed ===
```

---

## ğŸ¯ Quick Checklist:

Before testing, ensure:

- [ ] Backend running on port 5000
- [ ] `.env` file exists in ROOT folder
- [ ] `VITE_API_URL=http://localhost:5000/api` in .env
- [ ] `GEMINI_API_KEY` is valid in .env
- [ ] `server/uploads/` folder exists
- [ ] Frontend restarted after .env changes
- [ ] Browser cache cleared (Ctrl+Shift+R)
- [ ] No other process using port 5000
- [ ] Internet connection stable (for Gemini AI)

---

## ğŸ’¡ Pro Tips:

### Tip 1: Keep Backend Terminal Visible
Watch for errors in real-time during PDF generation.

### Tip 2: Check Network Tab
Open DevTools (F12) â†’ Network â†’ Filter: "generate-pdf"
See if request reaches backend and what response is.

### Tip 3: Test Backend Health
Open in browser:
```
http://localhost:5000/api/health
```
Should show: `{"status":"OK"}`

### Tip 4: Sample Test Data
Use same patient as working PDF:
- Name: Priyanka Sahare
- Age: 9
- Gender: Female
- Should generate similar PDF

---

## ğŸš€ Success Indicators:

When everything works:

**Backend Console:**
```
ğŸ“„ === PDF Report Generation Started ===
ğŸ¤– Using Gemini 2.0 Flash (Multimodal)
âœ… Model initialized: gemini-2.0-flash
âœ… Gemini extraction successful!
âœ… PDF Report Generated Successfully!
```

**Frontend Console:**
```
ğŸ”§ Preparing patient data...
ğŸŒ Calling backend API: http://localhost:5000/api/qeeg/generate-pdf
ğŸ“¡ Backend response status: 200
âœ… PDF generated successfully!
ğŸ’¾ Saving to database...
âœ… Results saved successfully!
ğŸ“¥ Auto-downloading PDF...
```

**Browser:**
- âœ… Toast: "Generating NeuroSense PDF Report..."
- âœ… Toast: "PDF Report generated!"
- âœ… PDF file downloads automatically
- âœ… File size: ~100-200 KB
- âœ… Opens properly in PDF viewer

**Processing History:**
- âœ… Shows "PDF Available" badge (green)
- âœ… "NeuroSense Report" button enabled
- âœ… Clicking downloads PDF

---

## âš ï¸ Common Mistakes:

### Mistake 1: .env in Wrong Location
```
âŒ server/.env  (wrong!)
âœ… .env         (correct - root folder)
```

### Mistake 2: Wrong Port in .env
```
âŒ VITE_API_URL=http://localhost:3001/api
âœ… VITE_API_URL=http://localhost:5000/api
```

### Mistake 3: Invalid/Missing Gemini Key
```
âŒ GEMINI_API_KEY=
âŒ GEMINI_API_KEY=your-key-here (placeholder!)
âœ… GEMINI_API_KEY=AIzaSyB... (actual key)
```

### Mistake 4: Not Restarting After Changes
After editing .env:
1. âœ… Restart backend
2. âœ… Restart frontend
3. âœ… Hard refresh browser

---

## ğŸ“ Still Not Working?

### Collect Debug Info:

1. **Backend terminal output** (full logs)
2. **Browser console errors** (F12 â†’ Console)
3. **Network tab** (F12 â†’ Network â†’ "generate-pdf" request)
4. **`.env` file contents** (hide API keys)
5. **Backend port** (from terminal)
6. **File sizes** of PDFs you're uploading

### Check These Specific Things:

```bash
# 1. Backend health
curl http://localhost:5000/api/health

# 2. Uploads folder exists
ls server/uploads

# 3. Gemini key in env
cat .env | grep GEMINI

# 4. Process on port 5000
netstat -ano | findstr :5000

# 5. Dependencies installed
ls node_modules | grep pdfkit
ls server/node_modules | grep @google
```

---

## âœ¨ Final Words:

**Sample PDF shows everything was configured correctly before!**

Main issues usually:
1. Missing/invalid Gemini API key
2. Backend not running
3. Wrong port in .env
4. Dependencies not installed

**Follow steps exactly and it WILL work again like before!** ğŸ‰

The sample PDF proves:
- âœ… Code is correct
- âœ… Gemini integration works
- âœ… PDF design is perfect
- âœ… Just need proper setup!

**Good luck! Ab same perfect PDFs banegi! ğŸš€**
