{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","type":"user","message":{"role":"user","content":"I need you to analyze the algorithm calculation implementation and compare it with the user's specification screenshot.\n\nThe user has provided a detailed specification table showing:\n\n**7 Parameters with their Sub-Parameters:**\n\n1. **Cognition:**\n   - Focus Score (Theta:Beta) - Eyes Open, Absolute Power - Formula: Average Theta/Beta at Fz and Cz - Metric: Less than 1.5 is normal\n   - Alpha Peak - Eyes Closed, Special - Pz or below - Metric: More than 9 is normal\n   - Alpha:Theta balance - Eyes Closed, Absolute Power - Order: Fz > Cz > Pz - Metric: Fz>Cz>Pz is normal\n\n2. **Stress:**\n   - Arousal score (High Beta:Beta) - Eyes Open, Absolute - Less than 1 is normal\n   - Relaxation Score - Eyes Closed, Absolute - EC Alpha:EC Beta at Pz - More than 1 is healthy\n   - Regeneration (Alpha modulation) - EO & EC, Relative - Alpha Pz (EC-EO)/EC*100 - More than 30% is healthy\n\n3. **Focus & Attention:**\n   - Focus Score Theta - Eyes Open, Relative - Average Theta at Fz and Cz - Less than 20 is normal\n   - Alpha:Theta balance - Eyes Closed, Absolute - Fz>Cz>Pz is normal\n   - Focus Stimulus Control (Theta:Beta) - Eyes Open, Absolute - Average at Fz and Cz - Less than 1.5 is normal\n\n4. **Burnout & Fatigue:**\n   - Arousal Score (High Beta:Beta) - Eyes Open, Absolute - Less than 1 is normal\n   - Relaxation Score - Eyes Closed, Absolute - More than 1 is healthy\n   - Excessive Delta - Eyes Open, Relative - Less than 70% is normal\n\n5. **Emotional Regulation:**\n   - Alpha Asymmetry Frontal - Eyes Closed, Absolute - Less than 1 is normal\n   - Arousal Score - Eyes Open, Absolute - Less than 1 is normal\n   - Regeneration Alpha Modulation - EO & EC, Relative - More than 30% is healthy\n\n6. **Learning:**\n   - Peak Alpha - Eyes Closed, Special - More than 9 is normal\n   - Focus Theta:Beta - Eyes Open, Relative - Less than 1.5 is normal\n   - Arousal Score - Eyes Open, Absolute - Less than 1 is normal\n\n7. **Creativity:**\n   - Relaxation Score - Eyes Closed, Absolute - More than 1 is healthy\n   - Focus Theta:Beta - Eyes Open, Relative - Less than 1.5 is normal\n   - Peak Alpha - Eyes Closed, Special - More than 9 is normal\n\n**Your Task:**\n1. Read and analyze: server/services/algorithmCalculator.js\n2. Read and analyze: server/services/zscoreCalculator.js\n3. Compare the implementation with the specification above\n4. Identify any discrepancies, missing formulas, or incorrect thresholds\n5. Check if the metrics (pass/fail thresholds) match exactly\n6. Verify if all sub-parameters are implemented correctly\n7. Create a detailed comparison table showing:\n   - Parameter name\n   - Sub-parameter name\n   - Expected formula (from spec)\n   - Actual implementation (from code)\n   - Expected threshold (from spec)\n   - Actual threshold (from code)\n   - Match status (âœ… Matches / âŒ Mismatch / âš ï¸ Missing)\n\nReturn a comprehensive analysis with all findings."},"uuid":"0ae17544-288b-42cb-8f09-1c7d3e5e9200","timestamp":"2025-12-09T09:16:58.644Z"}
{"parentUuid":"0ae17544-288b-42cb-8f09-1c7d3e5e9200","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017kZw9KF79aiQ42jmrAcNwY","type":"message","role":"assistant","content":[{"type":"text","text":"I'll analyze the algorithm calculation implementation and compare it with the specifications. Let me start by reading the relevant files."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":9818,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":9818,"ephemeral_1h_input_tokens":0},"output_tokens":154,"service_tier":"standard"}},"requestId":"req_011CVvrvcw39KQcmwk6pSwTM","type":"assistant","uuid":"966e4502-a7e2-468b-a720-c7d61cfd744b","timestamp":"2025-12-09T09:17:01.888Z"}
{"parentUuid":"966e4502-a7e2-468b-a720-c7d61cfd744b","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017kZw9KF79aiQ42jmrAcNwY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NkEvbbG5jKq5RP3QAuW3UG","name":"Read","input":{"file_path":"D:\\Todays\\Neuro360\\server\\services\\algorithmCalculator.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":9818,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":9818,"ephemeral_1h_input_tokens":0},"output_tokens":154,"service_tier":"standard"}},"requestId":"req_011CVvrvcw39KQcmwk6pSwTM","type":"assistant","uuid":"7d645bfc-a04c-4449-b337-a8e785f8ca16","timestamp":"2025-12-09T09:17:02.194Z"}
{"parentUuid":"7d645bfc-a04c-4449-b337-a8e785f8ca16","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_017kZw9KF79aiQ42jmrAcNwY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017e65pH8bCkqgFosE1kVLEv","name":"Read","input":{"file_path":"D:\\Todays\\Neuro360\\server\\services\\zscoreCalculator.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":9818,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":9818,"ephemeral_1h_input_tokens":0},"output_tokens":154,"service_tier":"standard"}},"requestId":"req_011CVvrvcw39KQcmwk6pSwTM","type":"assistant","uuid":"e8138356-0c30-41f2-9b3f-184c919a5cf3","timestamp":"2025-12-09T09:17:02.711Z"}
{"parentUuid":"e8138356-0c30-41f2-9b3f-184c919a5cf3","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NkEvbbG5jKq5RP3QAuW3UG","type":"tool_result","content":"     1â†’/**\n     2â†’ * QEEG Algorithm Calculator\n     3â†’ * Based on Rhea's Report - Calculates 7 brain health parameters\n     4â†’ * Each parameter has 3 sub-metrics, scored 0-3, classified as Low/Medium/High\n     5â†’ */\n     6â†’\n     7â†’class AlgorithmCalculator {\n     8â†’  constructor(qeegData) {\n     9â†’    this.data = qeegData;\n    10â†’    this.results = {\n    11â†’      parameters: [],\n    12â†’      rawCalculations: {},\n    13â†’      overallScore: 0\n    14â†’    };\n    15â†’  }\n    16â†’\n    17â†’  /**\n    18â†’   * Main calculation method - calculates all 7 parameters\n    19â†’   */\n    20â†’  calculate() {\n    21â†’    console.log('\\nðŸ§® ========== STARTING ALGORITHM CALCULATIONS ==========');\n    22â†’    console.log('ðŸ“Š Input Data Structure:', JSON.stringify(this.data, null, 2));\n    23â†’\n    24â†’    console.log('\\nðŸ› === ENHANCED DEBUG MODE ACTIVATED ===');\n    25â†’    console.log('ðŸ“‹ This debug output will show:');\n    26â†’    console.log('   1. Every raw value extracted from QEEG data');\n    27â†’    console.log('   2. All mathematical formulas and calculations');\n    28â†’    console.log('   3. Threshold comparisons and scoring logic');\n    29â†’    console.log('   4. Final score aggregation for each parameter');\n    30â†’    console.log('===========================================\\n');\n    31â†’\n    32â†’    const parameters = [\n    33â†’      this.calculateCognition(),\n    34â†’      this.calculateStress(),\n    35â†’      this.calculateFocusAttention(),\n    36â†’      this.calculateBurnoutFatigue(),\n    37â†’      this.calculateEmotionalRegulation(),\n    38â†’      this.calculateLearning(),\n    39â†’      this.calculateCreativity()\n    40â†’    ];\n    41â†’\n    42â†’    console.log('\\nâœ… Final 7 Parameter Scores Calculated:');\n    43â†’    parameters.forEach((p, i) => {\n    44â†’      console.log(`${i + 1}. ${p.name}: ${p.score}/${p.maxScore} (${p.classification}) ${this.getEmoji(p.classification)}`);\n    45â†’      p.metrics.forEach(m => {\n    46â†’        console.log(`   - ${m.name}: ${m.score} point (value: ${JSON.stringify(m.value)})`);\n    47â†’      });\n    48â†’    });\n    49â†’\n    50â†’    // === ENHANCED DEBUG: Show complete calculation summary ===\n    51â†’    console.log('\\nðŸ› === DEBUG: COMPLETE CALCULATION SUMMARY ===');\n    52â†’    console.log('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”');\n    53â†’    console.log('â”‚ Parameter                   â”‚ Score â”‚ Classificationâ”‚');\n    54â†’    console.log('â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤');\n    55â†’    parameters.forEach(p => {\n    56â†’      const padding = ' '.repeat(28 - p.name.length);\n    57â†’      console.log(`â”‚ ${p.name}${padding}â”‚  ${p.score}/3  â”‚ ${p.classification.padEnd(12)} â”‚`);\n    58â†’    });\n    59â†’    console.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜');\n    60â†’    console.log(`\\nðŸ“Š OVERALL BRAIN HEALTH SCORE: ${parameters.reduce((sum, p) => sum + p.score, 0)}/21`);\n    61â†’    console.log('=== END DEBUG: CALCULATION SUMMARY ===\\n');\n    62â†’\n    63â†’    console.log('========== CALCULATIONS COMPLETE ==========\\n');\n    64â†’\n    65â†’    this.results.parameters = parameters;\n    66â†’    this.results.overallScore = parameters.reduce((sum, p) => sum + p.score, 0);\n    67â†’\n    68â†’    return this.results;\n    69â†’  }\n    70â†’\n    71â†’  getEmoji(classification) {\n    72â†’    if (classification === 'Low') return 'ðŸ”´';\n    73â†’    if (classification === 'Medium') return 'ðŸŸ¡';\n    74â†’    return 'ðŸŸ¢';\n    75â†’  }\n    76â†’\n    77â†’  // ==================== HELPER METHODS ====================\n    78â†’\n    79â†’  /**\n    80â†’   * Get value from QEEG data table\n    81â†’   * @param {string} condition - 'EC' (Eyes Closed) or 'EO' (Eyes Open)\n    82â†’   * @param {string} powerType - 'absolute' or 'relative'\n    83â†’   * @param {string} channel - e.g., 'Fz', 'Cz', 'Pz'\n    84â†’   * @param {string} band - e.g., 'Theta', 'Alpha', 'Beta', 'HiBeta', 'Delta'\n    85â†’   */\n    86â†’  getValue(condition, powerType, channel, band) {\n    87â†’    try {\n    88â†’      return this.data[condition][powerType][channel][band];\n    89â†’    } catch (error) {\n    90â†’      console.error(`Error getting value: ${condition}.${powerType}.${channel}.${band}`);\n    91â†’      return null;\n    92â†’    }\n    93â†’  }\n    94â†’\n    95â†’  /**\n    96â†’   * Score a metric based on threshold\n    97â†’   * Returns 1 if condition is met (HEALTHY/NORMAL state by default)\n    98â†’   * Use 'invert: true' for stress/problem indicators\n    99â†’   */\n   100â†’  scoreMetric(value, threshold, comparison = 'less', invert = false) {\n   101â†’    if (value === null || value === undefined) return 0;\n   102â†’\n   103â†’    let result = 0;\n   104â†’\n   105â†’    if (comparison === 'less') {\n   106â†’      result = value < threshold ? 1 : 0;\n   107â†’    } else if (comparison === 'more') {\n   108â†’      result = value > threshold ? 1 : 0;\n   109â†’    } else if (comparison === 'equal') {\n   110â†’      result = value === threshold ? 1 : 0;\n   111â†’    }\n   112â†’\n   113â†’    // Invert for stress/problem indicators (where 1 point = problem detected)\n   114â†’    return invert ? (1 - result) : result;\n   115â†’  }\n   116â†’\n   117â†’  /**\n   118â†’   * Classify score to bucket (Low/Medium/High)\n   119â†’   */\n   120â†’  classifyScore(score) {\n   121â†’    if (score <= 1) return 'Low';\n   122â†’    if (score === 2) return 'Medium';\n   123â†’    return 'High';\n   124â†’  }\n   125â†’\n   126â†’  // ==================== INDIVIDUAL METRICS ====================\n   127â†’\n   128â†’  /**\n   129â†’   * Focus Score (Theta:Beta Ratio) - Used in multiple parameters\n   130â†’   * Eyes Open, Absolute Power, Fz & Cz average\n   131â†’   * < 1.5 is normal\n   132â†’   */\n   133â†’  calculateFocusScore() {\n   134â†’    console.log('\\n  ðŸ” === Calculating Focus Score (Theta:Beta) ===');\n   135â†’    console.log('  ðŸ“‹ Purpose: Measures mental focus by comparing slow (Theta) vs fast (Beta) brain waves');\n   136â†’    console.log('  ðŸ“Š Data Source: Eyes Open (EO), Absolute Power, Channels Fz & Cz');\n   137â†’    console.log('  ðŸŽ¯ Expected: Ratio < 1.5 indicates good focus (more Beta than Theta)\\n');\n   138â†’\n   139â†’    const fzTheta = this.getValue('EO', 'absolute', 'Fz', 'Theta');\n   140â†’    const fzBeta = this.getValue('EO', 'absolute', 'Fz', 'Beta');\n   141â†’    const czTheta = this.getValue('EO', 'absolute', 'Cz', 'Theta');\n   142â†’    const czBeta = this.getValue('EO', 'absolute', 'Cz', 'Beta');\n   143â†’\n   144â†’    console.log('  ðŸ› DEBUG - Step 1: Extract Raw Values from QEEG Data');\n   145â†’    console.log('     â”œâ”€ EO.absolute.Fz.Theta =', fzTheta, 'Î¼VÂ²');\n   146â†’    console.log('     â”œâ”€ EO.absolute.Fz.Beta  =', fzBeta, 'Î¼VÂ²');\n   147â†’    console.log('     â”œâ”€ EO.absolute.Cz.Theta =', czTheta, 'Î¼VÂ²');\n   148â†’    console.log('     â””â”€ EO.absolute.Cz.Beta  =', czBeta, 'Î¼VÂ²');\n   149â†’\n   150â†’    // Fix: Use == null to allow 0 values (valid EEG readings)\n   151â†’    if (fzTheta == null || fzBeta == null || czTheta == null || czBeta == null) {\n   152â†’      console.log('     âŒ Missing values, returning 0');\n   153â†’      return { value: null, score: 0 };\n   154â†’    }\n   155â†’\n   156â†’    console.log('\\n  ðŸ› DEBUG - Step 2: Calculate Theta:Beta Ratios');\n   157â†’    const fzRatio = fzTheta / fzBeta;\n   158â†’    const czRatio = czTheta / czBeta;\n   159â†’    console.log('     â”œâ”€ Fz Ratio = Theta/Beta = ' + fzTheta + ' / ' + fzBeta + ' = ' + fzRatio.toFixed(3));\n   160â†’    console.log('     â””â”€ Cz Ratio = Theta/Beta = ' + czTheta + ' / ' + czBeta + ' = ' + czRatio.toFixed(3));\n   161â†’\n   162â†’    console.log('\\n  ðŸ› DEBUG - Step 3: Calculate Average Ratio');\n   163â†’    const avgRatio = (fzRatio + czRatio) / 2;\n   164â†’    console.log('     â””â”€ Average = (Fz + Cz) / 2 = (' + fzRatio.toFixed(3) + ' + ' + czRatio.toFixed(3) + ') / 2 = ' + avgRatio.toFixed(3));\n   165â†’\n   166â†’    console.log('\\n  ðŸ› DEBUG - Step 4: Score Against Threshold');\n   167â†’    console.log('     â”œâ”€ Threshold: < 1.5 = Normal (good focus)');\n   168â†’    console.log('     â”œâ”€ Actual Value: ' + avgRatio.toFixed(3));\n   169â†’    console.log('     â”œâ”€ Comparison: ' + avgRatio.toFixed(3) + ' < 1.5 ? ' + (avgRatio < 1.5));\n   170â†’    const score = this.scoreMetric(avgRatio, 1.5, 'less');\n   171â†’    console.log('     â””â”€ âœ… SCORE: ' + score + '/1 ' + (score === 1 ? '(PASS - Good focus)' : '(FAIL - Poor focus)'));\n   172â†’\n   173â†’    return {\n   174â†’      value: avgRatio,\n   175â†’      score: score,\n   176â†’      description: `Theta:Beta Ratio = ${avgRatio.toFixed(2)} (< 1.5 is normal)`,\n   177â†’      details: { fzRatio: fzRatio.toFixed(2), czRatio: czRatio.toFixed(2) }\n   178â†’    };\n   179â†’  }\n   180â†’\n   181â†’  /**\n   182â†’   * Alpha Peak - Used in multiple parameters\n   183â†’   * Eyes Closed, Special (highest frequency at Pz or below)\n   184â†’   * > 9 Hz is normal\n   185â†’   */\n   186â†’  calculateAlphaPeak() {\n   187â†’    console.log('\\n  ðŸ” === Calculating Alpha Peak ===');\n   188â†’    // Get alpha peak from data - NO DEFAULT VALUE\n   189â†’    const alphaPeak = this.data.EC?.special?.alphaPeak || this.data.EC?.special?.O1 || null;\n   190â†’\n   191â†’    console.log('     Raw Value:', alphaPeak);\n   192â†’\n   193â†’    // If no data available, return 0 score\n   194â†’    if (alphaPeak === null || alphaPeak === undefined) {\n   195â†’      console.log('     âŒ No data available, returning 0');\n   196â†’      return { value: null, score: 0 };\n   197â†’    }\n   198â†’\n   199â†’    const score = this.scoreMetric(alphaPeak, 9, 'more');\n   200â†’    console.log(`     Threshold: > 9 Hz = normal`);\n   201â†’    console.log(`     Result: ${alphaPeak} > 9 = ${alphaPeak > 9}`);\n   202â†’    console.log(`     âœ… SCORE: ${score}/1`);\n   203â†’\n   204â†’    return {\n   205â†’      value: alphaPeak,\n   206â†’      score: score,\n   207â†’      description: `Alpha Peak = ${alphaPeak.toFixed(1)} Hz (> 9 is normal)`\n   208â†’    };\n   209â†’  }\n   210â†’\n   211â†’  /**\n   212â†’   * Alpha:Theta Balance - Used in multiple parameters\n   213â†’   * Eyes Closed, Absolute Power, Fz, Cz, Pz\n   214â†’   * Order Pz > Cz > Fz is normal for eyes-closed (posterior dominance)\n   215â†’   * NOTE: Per Rhea's report, posterior dominance (Pz > Cz > Fz) is \"actually common\n   216â†’   * in eyes-closed recordings where alpha typically peaks over parietal/occipital sites\"\n   217â†’   */\n   218â†’  calculateAlphaThetaBalance() {\n   219â†’    console.log('\\n  ðŸ” === Calculating Alpha:Theta Balance ===');\n   220â†’    const fzAlpha = this.getValue('EC', 'absolute', 'Fz', 'Alpha');\n   221â†’    const fzTheta = this.getValue('EC', 'absolute', 'Fz', 'Theta');\n   222â†’    const czAlpha = this.getValue('EC', 'absolute', 'Cz', 'Alpha');\n   223â†’    const czTheta = this.getValue('EC', 'absolute', 'Cz', 'Theta');\n   224â†’    const pzAlpha = this.getValue('EC', 'absolute', 'Pz', 'Alpha');\n   225â†’    const pzTheta = this.getValue('EC', 'absolute', 'Pz', 'Theta');\n   226â†’\n   227â†’    console.log('     Raw Values - Fz:', { Alpha: fzAlpha, Theta: fzTheta });\n   228â†’    console.log('     Raw Values - Cz:', { Alpha: czAlpha, Theta: czTheta });\n   229â†’    console.log('     Raw Values - Pz:', { Alpha: pzAlpha, Theta: pzTheta });\n   230â†’\n   231â†’    // Fix: Use == null to allow 0 values (valid EEG readings)\n   232â†’    if (fzAlpha == null || fzTheta == null || czAlpha == null || czTheta == null || pzAlpha == null || pzTheta == null) {\n   233â†’      console.log('     âŒ Missing values, returning 0');\n   234â†’      return { value: null, score: 0 };\n   235â†’    }\n   236â†’\n   237â†’    const fzRatio = fzAlpha / fzTheta;\n   238â†’    const czRatio = czAlpha / czTheta;\n   239â†’    const pzRatio = pzAlpha / pzTheta;\n   240â†’\n   241â†’    console.log(`     Ratios - Fz: ${fzRatio.toFixed(2)}, Cz: ${czRatio.toFixed(2)}, Pz: ${pzRatio.toFixed(2)}`);\n   242â†’    console.log(`     Expected Order: Pz > Cz > Fz (posterior dominant for EC)`);\n   243â†’    console.log(`     Actual Order: Pz(${pzRatio.toFixed(2)}) > Cz(${czRatio.toFixed(2)}) > Fz(${fzRatio.toFixed(2)})`);\n   244â†’\n   245â†’    // Normal pattern for eyes-closed: Pz > Cz > Fz (posterior dominant)\n   246â†’    const isNormalOrder = pzRatio > czRatio && czRatio > fzRatio;\n   247â†’\n   248â†’    console.log(`     Check: ${pzRatio.toFixed(2)} > ${czRatio.toFixed(2)} = ${pzRatio > czRatio}`);\n   249â†’    console.log(`     Check: ${czRatio.toFixed(2)} > ${fzRatio.toFixed(2)} = ${czRatio > fzRatio}`);\n   250â†’    console.log(`     âœ… SCORE: ${isNormalOrder ? 1 : 0}/1`);\n   251â†’\n   252â†’    return {\n   253â†’      value: { fz: fzRatio.toFixed(2), cz: czRatio.toFixed(2), pz: pzRatio.toFixed(2) },\n   254â†’      score: isNormalOrder ? 1 : 0,\n   255â†’      description: `Alpha:Theta Order = ${isNormalOrder ? 'Pz > Cz > Fz (Normal for EC)' : 'Abnormal order'}`,\n   256â†’      details: { fzRatio, czRatio, pzRatio, order: isNormalOrder }\n   257â†’    };\n   258â†’  }\n   259â†’\n   260â†’  /**\n   261â†’   * Arousal Score (HiBeta:Beta Ratio) - Used in multiple parameters\n   262â†’   * Eyes Open, Absolute Power, Fz & Cz average\n   263â†’   * < 1 is normal\n   264â†’   */\n   265â†’  calculateArousalScore() {\n   266â†’    console.log('\\n  ðŸ” === Calculating Arousal Score (HiBeta:Beta) ===');\n   267â†’    const fzBeta = this.getValue('EO', 'absolute', 'Fz', 'Beta');\n   268â†’    const fzHiBeta = this.getValue('EO', 'absolute', 'Fz', 'HiBeta');\n   269â†’    const czBeta = this.getValue('EO', 'absolute', 'Cz', 'Beta');\n   270â†’    const czHiBeta = this.getValue('EO', 'absolute', 'Cz', 'HiBeta');\n   271â†’\n   272â†’    console.log('     Raw Values - Fz:', { Beta: fzBeta, HiBeta: fzHiBeta });\n   273â†’    console.log('     Raw Values - Cz:', { Beta: czBeta, HiBeta: czHiBeta });\n   274â†’\n   275â†’    // Fix: Use == null to allow 0 values (valid EEG readings)\n   276â†’    if (fzBeta == null || fzHiBeta == null || czBeta == null || czHiBeta == null) {\n   277â†’      console.log('     âŒ Missing values, returning 0');\n   278â†’      return { value: null, score: 0 };\n   279â†’    }\n   280â†’\n   281â†’    const fzRatio = fzHiBeta / fzBeta;\n   282â†’    const czRatio = czHiBeta / czBeta;\n   283â†’    const avgRatio = (fzRatio + czRatio) / 2;\n   284â†’    const score = this.scoreMetric(avgRatio, 1, 'less');\n   285â†’\n   286â†’    console.log(`     Fz ratio (HiBeta/Beta): ${fzRatio.toFixed(3)}`);\n   287â†’    console.log(`     Cz ratio (HiBeta/Beta): ${czRatio.toFixed(3)}`);\n   288â†’    console.log(`     Average: ${avgRatio.toFixed(3)}`);\n   289â†’    console.log(`     Threshold: < 1 = normal (low arousal)`);\n   290â†’    console.log(`     Result: ${avgRatio.toFixed(3)} < 1 = ${avgRatio < 1}`);\n   291â†’    console.log(`     âœ… SCORE: ${score}/1`);\n   292â†’\n   293â†’    return {\n   294â†’      value: avgRatio,\n   295â†’      score: score,\n   296â†’      description: `Arousal Score = ${avgRatio.toFixed(2)} (< 1 is normal)`,\n   297â†’      details: { fzRatio: fzRatio.toFixed(2), czRatio: czRatio.toFixed(2) }\n   298â†’    };\n   299â†’  }\n   300â†’\n   301â†’  /**\n   302â†’   * Relaxation Score - Used in multiple parameters\n   303â†’   * Eyes Closed, RELATIVE Power, Pz, Alpha/Beta\n   304â†’   * >= 10 is healthy\n   305â†’   */\n   306â†’  calculateRelaxationScore() {\n   307â†’    console.log('\\n  ðŸ” === Calculating Relaxation Score ===');\n   308â†’    console.log('  ðŸ“‹ Purpose: Measures ability to relax by comparing Alpha vs Beta waves');\n   309â†’    console.log('  ðŸ“Š Data Source: Eyes Closed (EC), RELATIVE Power (%), Pz channel (posterior)');\n   310â†’    console.log('  ðŸŽ¯ Expected: Alpha/Beta >= 10 indicates good relaxation capacity\\n');\n   311â†’\n   312â†’    const pzAlpha = this.getValue('EC', 'relative', 'Pz', 'Alpha');\n   313â†’    const pzBeta = this.getValue('EC', 'relative', 'Pz', 'Beta');\n   314â†’\n   315â†’    console.log('  ðŸ› DEBUG - Step 1: Extract Raw Values from QEEG Data');\n   316â†’    console.log('     â”œâ”€ EC.relative.Pz.Alpha =', pzAlpha, '%');\n   317â†’    console.log('     â””â”€ EC.relative.Pz.Beta  =', pzBeta, '%');\n   318â†’\n   319â†’    // Fix: Use == null to allow 0 values (valid EEG readings)\n   320â†’    if (pzAlpha == null || pzBeta == null || pzBeta === 0) {\n   321â†’      console.log('     âš ï¸ Missing or zero Beta value, returning 0');\n   322â†’      return { value: null, score: 0 };\n   323â†’    }\n   324â†’\n   325â†’    console.log('\\n  ðŸ› DEBUG - Step 2: Calculate Alpha:Beta Ratio');\n   326â†’    const ratio = pzAlpha / pzBeta;\n   327â†’    console.log('     â””â”€ Ratio = Alpha/Beta = ' + pzAlpha + ' / ' + pzBeta + ' = ' + ratio.toFixed(2));\n   328â†’\n   329â†’    console.log('\\n  ðŸ› DEBUG - Step 3: Score Against Threshold');\n   330â†’    console.log('     â”œâ”€ Threshold: >= 9.9 (accounting for rounding, ~10.0 is healthy)');\n   331â†’    console.log('     â”œâ”€ Actual Value: ' + ratio.toFixed(2));\n   332â†’    console.log('     â”œâ”€ Comparison: ' + ratio.toFixed(2) + ' >= 9.9 ? ' + (ratio >= 9.9));\n   333â†’\n   334â†’    // Use >= 9.9 to account for rounding (9.96 â‰ˆ 10.0 is considered healthy)\n   335â†’    const score = ratio >= 9.9 ? 1 : 0;\n   336â†’    console.log('     â””â”€ âœ… SCORE: ' + score + '/1 ' + (score === 1 ? '(PASS - Good relaxation)' : '(FAIL - Poor relaxation)'));\n   337â†’\n   338â†’    console.log('\\n  ðŸ’¡ Interpretation:');\n   339â†’    if (ratio >= 10) {\n   340â†’      console.log('     â†’ High Alpha relative to Beta = Good relaxation capacity');\n   341â†’      console.log('     â†’ Brain can easily shift into relaxed, calm state');\n   342â†’    } else {\n   343â†’      console.log('     â†’ Low Alpha relative to Beta = Difficulty relaxing');\n   344â†’      console.log('     â†’ May indicate stress or hyperarousal');\n   345â†’    }\n   346â†’\n   347â†’    return {\n   348â†’      value: ratio,\n   349â†’      score: score,\n   350â†’      description: `Relaxation Score = ${ratio.toFixed(2)} (>= 10 is healthy)`\n   351â†’    };\n   352â†’  }\n   353â†’\n   354â†’  /**\n   355â†’   * Regeneration (Alpha Modulation) - Used in multiple parameters\n   356â†’   * EO & EC, Relative Power, Pz, (EC-EO)/EC * 100\n   357â†’   * > 30% is healthy\n   358â†’   */\n   359â†’  calculateRegeneration() {\n   360â†’    console.log('\\n  ðŸ” === Calculating Regeneration (Alpha Modulation) ===');\n   361â†’    console.log('     Using: EC vs EO relative power at Pz');\n   362â†’    const ecAlpha = this.getValue('EC', 'relative', 'Pz', 'Alpha');\n   363â†’    const eoAlpha = this.getValue('EO', 'relative', 'Pz', 'Alpha');\n   364â†’\n   365â†’    console.log('     Raw Values:', { 'EC Alpha': ecAlpha, 'EO Alpha': eoAlpha });\n   366â†’\n   367â†’    // Fix: Use == null to allow 0 values (valid EEG readings)\n   368â†’    if (ecAlpha == null || eoAlpha == null || ecAlpha === 0) {\n   369â†’      console.log('     âŒ Missing or zero EC Alpha value, returning 0');\n   370â†’      return { value: null, score: 0 };\n   371â†’    }\n   372â†’\n   373â†’    const modulation = ((ecAlpha - eoAlpha) / ecAlpha) * 100;\n   374â†’    const score = this.scoreMetric(modulation, 30, 'more');\n   375â†’\n   376â†’    console.log(`     Formula: ((EC - EO) / EC) Ã— 100`);\n   377â†’    console.log(`     Calculation: ((${ecAlpha} - ${eoAlpha}) / ${ecAlpha}) Ã— 100`);\n   378â†’    console.log(`     Modulation: ${modulation.toFixed(1)}%`);\n   379â†’    console.log(`     Threshold: > 30% = healthy (good alpha reactivity)`);\n   380â†’    console.log(`     Result: ${modulation.toFixed(1)}% > 30% = ${modulation > 30}`);\n   381â†’    console.log(`     âœ… SCORE: ${score}/1`);\n   382â†’\n   383â†’    return {\n   384â†’      value: modulation,\n   385â†’      score: score,\n   386â†’      description: `Alpha Modulation = ${modulation.toFixed(1)}% (> 30% is healthy)`\n   387â†’    };\n   388â†’  }\n   389â†’\n   390â†’  /**\n   391â†’   * Focus Theta (Relative Power) - Used in Focus & Attention\n   392â†’   * Eyes Open, Relative Power, Fz & Cz average\n   393â†’   * < 20% is normal\n   394â†’   */\n   395â†’  calculateFocusTheta() {\n   396â†’    console.log('\\n  ðŸ” === Calculating Focus Theta ===');\n   397â†’    console.log('     Using: EO relative power at Fz and Cz');\n   398â†’    const fzTheta = this.getValue('EO', 'relative', 'Fz', 'Theta');\n   399â†’    const czTheta = this.getValue('EO', 'relative', 'Cz', 'Theta');\n   400â†’\n   401â†’    console.log('     Raw Values:', { 'Fz Theta': fzTheta, 'Cz Theta': czTheta });\n   402â†’\n   403â†’    // Fix: Use == null to allow 0 values (valid EEG readings)\n   404â†’    if (fzTheta == null || czTheta == null) {\n   405â†’      console.log('     âŒ Missing values, returning 0');\n   406â†’      return { value: null, score: 0 };\n   407â†’    }\n   408â†’\n   409â†’    const avgTheta = (fzTheta + czTheta) / 2;\n   410â†’    const score = this.scoreMetric(avgTheta, 20, 'less');\n   411â†’\n   412â†’    console.log(`     Average: (${fzTheta} + ${czTheta}) / 2 = ${avgTheta.toFixed(1)}%`);\n   413â†’    console.log(`     Threshold: < 20% = normal (low frontal theta)`);\n   414â†’    console.log(`     Result: ${avgTheta.toFixed(1)}% < 20% = ${avgTheta < 20}`);\n   415â†’    console.log(`     âœ… SCORE: ${score}/1`);\n   416â†’\n   417â†’    return {\n   418â†’      value: avgTheta,\n   419â†’      score: score,\n   420â†’      description: `Focus Theta = ${avgTheta.toFixed(1)}% (< 20% is normal)`\n   421â†’    };\n   422â†’  }\n   423â†’\n   424â†’  /**\n   425â†’   * Excessive Delta - Used in Burnout & Fatigue\n   426â†’   * Eyes Open, Relative Power, avg of Fz, C3, Cz, C4, P3, Pz, P4\n   427â†’   * < 70% is normal\n   428â†’   */\n   429â†’  calculateExcessiveDelta() {\n   430â†’    console.log('\\n  ðŸ” === Calculating Excessive Delta ===');\n   431â†’    console.log('     Using: EO relative power, averaging 7 channels');\n   432â†’    const channels = ['Fz', 'C3', 'Cz', 'C4', 'P3', 'Pz', 'P4'];\n   433â†’    let sum = 0;\n   434â†’    let count = 0;\n   435â†’    const channelValues = {};\n   436â†’\n   437â†’    for (const channel of channels) {\n   438â†’      const delta = this.getValue('EO', 'relative', channel, 'Delta');\n   439â†’      channelValues[channel] = delta !== null ? delta : 'N/A';\n   440â†’      if (delta !== null) {\n   441â†’        sum += delta;\n   442â†’        count++;\n   443â†’      }\n   444â†’    }\n   445â†’\n   446â†’    console.log('     Channel Values:', channelValues);\n   447â†’    console.log(`     Valid channels: ${count}/7`);\n   448â†’\n   449â†’    if (count === 0) {\n   450â†’      console.log('     âŒ No valid channel data, returning 0');\n   451â†’      return { value: null, score: 0 };\n   452â†’    }\n   453â†’\n   454â†’    const avgDelta = sum / count;\n   455â†’    const score = this.scoreMetric(avgDelta, 70, 'less');\n   456â†’\n   457â†’    console.log(`     Sum: ${sum.toFixed(2)}, Count: ${count}`);\n   458â†’    console.log(`     Average Delta: ${avgDelta.toFixed(1)}%`);\n   459â†’    console.log(`     Threshold: < 70% = normal (low delta during wakefulness)`);\n   460â†’    console.log(`     Result: ${avgDelta.toFixed(1)}% < 70% = ${avgDelta < 70}`);\n   461â†’    console.log(`     âœ… SCORE: ${score}/1`);\n   462â†’\n   463â†’    return {\n   464â†’      value: avgDelta,\n   465â†’      score: score,\n   466â†’      description: `Excessive Delta = ${avgDelta.toFixed(1)}% (< 70% is normal)`\n   467â†’    };\n   468â†’  }\n   469â†’\n   470â†’  /**\n   471â†’   * Alpha Asymmetry (Frontal) - Used in Emotional Regulation\n   472â†’   * Eyes Closed, Absolute Power, F3 & F4\n   473â†’   * F4/F3 < 1 is normal\n   474â†’   */\n   475â†’  calculateAlphaAsymmetry() {\n   476â†’    console.log('\\n  ðŸ” === Calculating Alpha Asymmetry (Frontal) ===');\n   477â†’    console.log('     Using: EC absolute power at F3 and F4');\n   478â†’    const f3Alpha = this.getValue('EC', 'absolute', 'F3', 'Alpha');\n   479â†’    const f4Alpha = this.getValue('EC', 'absolute', 'F4', 'Alpha');\n   480â†’\n   481â†’    console.log('     Raw Values:', { 'F3 Alpha': f3Alpha, 'F4 Alpha': f4Alpha });\n   482â†’\n   483â†’    // Fix: Use == null to allow 0 values (valid EEG readings)\n   484â†’    if (f3Alpha == null || f4Alpha == null || f3Alpha === 0) {\n   485â†’      console.log('     âŒ Missing or zero F3 value, returning 0');\n   486â†’      return { value: null, score: 0 };\n   487â†’    }\n   488â†’\n   489â†’    const ratio = f4Alpha / f3Alpha;\n   490â†’    const score = this.scoreMetric(ratio, 1, 'less');\n   491â†’\n   492â†’    console.log(`     Ratio: F4/F3 = ${f4Alpha} / ${f3Alpha} = ${ratio.toFixed(3)}`);\n   493â†’    console.log(`     Threshold: < 1 = normal (left frontal dominance, positive affect)`);\n   494â†’    console.log(`     Result: ${ratio.toFixed(3)} < 1 = ${ratio < 1}`);\n   495â†’    console.log(`     âœ… SCORE: ${score}/1`);\n   496â†’\n   497â†’    return {\n   498â†’      value: ratio,\n   499â†’      score: score,\n   500â†’      description: `Alpha Asymmetry = ${ratio.toFixed(2)} (< 1 is normal)`\n   501â†’    };\n   502â†’  }\n   503â†’\n   504â†’  // ==================== 7 PARAMETER CALCULATIONS ====================\n   505â†’\n   506â†’  /**\n   507â†’   * 1. Cognition\n   508â†’   * - Focus Score (Theta:Beta Ratio)\n   509â†’   * - Alpha Peak\n   510â†’   * - Alpha:Theta Balance\n   511â†’   */\n   512â†’  calculateCognition() {\n   513â†’    console.log('\\nðŸ“Š Calculating COGNITION...');\n   514â†’    const metric1 = this.calculateFocusScore();\n   515â†’    const metric2 = this.calculateAlphaPeak();\n   516â†’    const metric3 = this.calculateAlphaThetaBalance();\n   517â†’\n   518â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   519â†’    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n   520â†’\n   521â†’    return {\n   522â†’      name: 'Cognition',\n   523â†’      score: totalScore,\n   524â†’      maxScore: 3,\n   525â†’      classification: this.classifyScore(totalScore),\n   526â†’      metrics: [\n   527â†’        { name: 'Focus Score (Theta:Beta)', ...metric1 },\n   528â†’        { name: 'Alpha Peak', ...metric2 },\n   529â†’        { name: 'Alpha:Theta Balance', ...metric3 }\n   530â†’      ]\n   531â†’    };\n   532â†’  }\n   533â†’\n   534â†’  /**\n   535â†’   * 2. Stress (Note: 0/3 is healthy, 3/3 is high stress)\n   536â†’   * - Arousal Score (inverted: abnormal = 1 point)\n   537â†’   * - Relaxation Score (inverted: abnormal = 1 point)\n   538â†’   * - Regeneration (inverted: abnormal = 1 point)\n   539â†’   */\n   540â†’  calculateStress() {\n   541â†’    console.log('\\nðŸ“Š === STRESS PARAMETER (0/3 = Healthy, 3/3 = High Stress) ===');\n   542â†’    const metric1 = this.calculateArousalScore();\n   543â†’    const metric2 = this.calculateRelaxationScore();\n   544â†’    const metric3 = this.calculateRegeneration();\n   545â†’\n   546â†’    // Invert scores: 0->1, 1->0 (so abnormal values add to stress score)\n   547â†’    const invertedScore1 = 1 - metric1.score;\n   548â†’    const invertedScore2 = 1 - metric2.score;\n   549â†’    const invertedScore3 = 1 - metric3.score;\n   550â†’\n   551â†’    console.log(`\\n  ðŸ”„ INVERTING SCORES (abnormal values = stress):`);\n   552â†’    console.log(`     Arousal normal score: ${metric1.score} â†’ Inverted (stress): ${invertedScore1}`);\n   553â†’    console.log(`     Relaxation normal score: ${metric2.score} â†’ Inverted (stress): ${invertedScore2}`);\n   554â†’    console.log(`     Regeneration normal score: ${metric3.score} â†’ Inverted (stress): ${invertedScore3}`);\n   555â†’\n   556â†’    const totalScore = invertedScore1 + invertedScore2 + invertedScore3;\n   557â†’    console.log(`\\n  ðŸ“Š STRESS TOTAL: ${invertedScore1} + ${invertedScore2} + ${invertedScore3} = ${totalScore}/3`);\n   558â†’\n   559â†’    return {\n   560â†’      name: 'Stress',\n   561â†’      score: totalScore,\n   562â†’      maxScore: 3,\n   563â†’      classification: this.classifyScore(totalScore),\n   564â†’      metrics: [\n   565â†’        { name: 'Arousal Score', ...metric1, score: invertedScore1 },\n   566â†’        { name: 'Relaxation Score', ...metric2, score: invertedScore2 },\n   567â†’        { name: 'Regeneration (Alpha Modulation)', ...metric3, score: invertedScore3 }\n   568â†’      ]\n   569â†’    };\n   570â†’  }\n   571â†’\n   572â†’  /**\n   573â†’   * 3. Focus & Attention\n   574â†’   * - Focus Theta\n   575â†’   * - Alpha:Theta Balance\n   576â†’   * - Focus Score (Theta:Beta)\n   577â†’   */\n   578â†’  calculateFocusAttention() {\n   579â†’    console.log('\\nðŸ“Š Calculating FOCUS & ATTENTION...');\n   580â†’    const metric1 = this.calculateFocusTheta();\n   581â†’    const metric2 = this.calculateAlphaThetaBalance();\n   582â†’    const metric3 = this.calculateFocusScore();\n   583â†’\n   584â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   585â†’    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n   586â†’\n   587â†’    return {\n   588â†’      name: 'Focus & Attention',\n   589â†’      score: totalScore,\n   590â†’      maxScore: 3,\n   591â†’      classification: this.classifyScore(totalScore),\n   592â†’      metrics: [\n   593â†’        { name: 'Focus Theta', ...metric1 },\n   594â†’        { name: 'Alpha:Theta Balance', ...metric2 },\n   595â†’        { name: 'Focus Score (Theta:Beta)', ...metric3 }\n   596â†’      ]\n   597â†’    };\n   598â†’  }\n   599â†’\n   600â†’  /**\n   601â†’   * 4. Burnout & Fatigue (Note: 0/3 is healthy)\n   602â†’   * - Arousal Score (inverted: abnormal = 1 point)\n   603â†’   * - Relaxation Score (inverted: abnormal = 1 point)\n   604â†’   * - Excessive Delta (inverted: abnormal = 1 point)\n   605â†’   */\n   606â†’  calculateBurnoutFatigue() {\n   607â†’    console.log('\\nðŸ“Š === BURNOUT & FATIGUE PARAMETER (0/3 = Healthy, 3/3 = High Burnout) ===');\n   608â†’    const metric1 = this.calculateArousalScore();\n   609â†’    const metric2 = this.calculateRelaxationScore();\n   610â†’    const metric3 = this.calculateExcessiveDelta();\n   611â†’\n   612â†’    // Invert scores: 0->1, 1->0 (so abnormal values add to burnout score)\n   613â†’    const invertedScore1 = 1 - metric1.score;\n   614â†’    const invertedScore2 = 1 - metric2.score;\n   615â†’    const invertedScore3 = 1 - metric3.score;\n   616â†’\n   617â†’    console.log(`\\n  ðŸ”„ INVERTING SCORES (abnormal values = burnout):`);\n   618â†’    console.log(`     Arousal normal score: ${metric1.score} â†’ Inverted (burnout): ${invertedScore1}`);\n   619â†’    console.log(`     Relaxation normal score: ${metric2.score} â†’ Inverted (burnout): ${invertedScore2}`);\n   620â†’    console.log(`     Excessive Delta normal score: ${metric3.score} â†’ Inverted (burnout): ${invertedScore3}`);\n   621â†’\n   622â†’    const totalScore = invertedScore1 + invertedScore2 + invertedScore3;\n   623â†’    console.log(`\\n  ðŸ“Š BURNOUT TOTAL: ${invertedScore1} + ${invertedScore2} + ${invertedScore3} = ${totalScore}/3`);\n   624â†’\n   625â†’    return {\n   626â†’      name: 'Burnout & Fatigue',\n   627â†’      score: totalScore,\n   628â†’      maxScore: 3,\n   629â†’      classification: this.classifyScore(totalScore),\n   630â†’      metrics: [\n   631â†’        { name: 'Arousal Score', ...metric1, score: invertedScore1 },\n   632â†’        { name: 'Relaxation Score', ...metric2, score: invertedScore2 },\n   633â†’        { name: 'Excessive Delta', ...metric3, score: invertedScore3 }\n   634â†’      ]\n   635â†’    };\n   636â†’  }\n   637â†’\n   638â†’  /**\n   639â†’   * 5. Emotional Regulation\n   640â†’   * - Alpha Asymmetry\n   641â†’   * - Arousal Score\n   642â†’   * - Regeneration\n   643â†’   */\n   644â†’  calculateEmotionalRegulation() {\n   645â†’    console.log('\\nðŸ“Š Calculating EMOTIONAL REGULATION...');\n   646â†’    const metric1 = this.calculateAlphaAsymmetry();\n   647â†’    const metric2 = this.calculateArousalScore();\n   648â†’    const metric3 = this.calculateRegeneration();\n   649â†’\n   650â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   651â†’    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n   652â†’\n   653â†’    return {\n   654â†’      name: 'Emotional Regulation',\n   655â†’      score: totalScore,\n   656â†’      maxScore: 3,\n   657â†’      classification: this.classifyScore(totalScore),\n   658â†’      metrics: [\n   659â†’        { name: 'Alpha Asymmetry (Frontal)', ...metric1 },\n   660â†’        { name: 'Arousal Score', ...metric2 },\n   661â†’        { name: 'Regeneration (Alpha Modulation)', ...metric3 }\n   662â†’      ]\n   663â†’    };\n   664â†’  }\n   665â†’\n   666â†’  /**\n   667â†’   * 6. Learning\n   668â†’   * - Alpha Peak\n   669â†’   * - Focus Score (Theta:Beta)\n   670â†’   * - Arousal Score\n   671â†’   */\n   672â†’  calculateLearning() {\n   673â†’    console.log('\\nðŸ“Š Calculating LEARNING...');\n   674â†’    const metric1 = this.calculateAlphaPeak();\n   675â†’    const metric2 = this.calculateFocusScore();\n   676â†’    const metric3 = this.calculateArousalScore();\n   677â†’\n   678â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   679â†’    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n   680â†’\n   681â†’    return {\n   682â†’      name: 'Learning',\n   683â†’      score: totalScore,\n   684â†’      maxScore: 3,\n   685â†’      classification: this.classifyScore(totalScore),\n   686â†’      metrics: [\n   687â†’        { name: 'Alpha Peak', ...metric1 },\n   688â†’        { name: 'Focus Score (Theta:Beta)', ...metric2 },\n   689â†’        { name: 'Arousal Score', ...metric3 }\n   690â†’      ]\n   691â†’    };\n   692â†’  }\n   693â†’\n   694â†’  /**\n   695â†’   * 7. Creativity\n   696â†’   * - Relaxation Score\n   697â†’   * - Focus Score (Theta:Beta)\n   698â†’   * - Alpha Peak\n   699â†’   */\n   700â†’  calculateCreativity() {\n   701â†’    console.log('\\nðŸ“Š Calculating CREATIVITY...');\n   702â†’    const metric1 = this.calculateRelaxationScore();\n   703â†’    const metric2 = this.calculateFocusScore();\n   704â†’    const metric3 = this.calculateAlphaPeak();\n   705â†’\n   706â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   707â†’    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n   708â†’\n   709â†’    return {\n   710â†’      name: 'Creativity',\n   711â†’      score: totalScore,\n   712â†’      maxScore: 3,\n   713â†’      classification: this.classifyScore(totalScore),\n   714â†’      metrics: [\n   715â†’        { name: 'Relaxation Score', ...metric1 },\n   716â†’        { name: 'Focus Score (Theta:Beta)', ...metric2 },\n   717â†’        { name: 'Alpha Peak', ...metric3 }\n   718â†’      ]\n   719â†’    };\n   720â†’  }\n   721â†’}\n   722â†’\n   723â†’module.exports = AlgorithmCalculator;\n   724â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"155c9295-938e-4982-9296-e5d287616bb6","timestamp":"2025-12-09T09:17:07.766Z","toolUseResult":{"type":"text","file":{"filePath":"D:\\Todays\\Neuro360\\server\\services\\algorithmCalculator.js","content":"/**\n * QEEG Algorithm Calculator\n * Based on Rhea's Report - Calculates 7 brain health parameters\n * Each parameter has 3 sub-metrics, scored 0-3, classified as Low/Medium/High\n */\n\nclass AlgorithmCalculator {\n  constructor(qeegData) {\n    this.data = qeegData;\n    this.results = {\n      parameters: [],\n      rawCalculations: {},\n      overallScore: 0\n    };\n  }\n\n  /**\n   * Main calculation method - calculates all 7 parameters\n   */\n  calculate() {\n    console.log('\\nðŸ§® ========== STARTING ALGORITHM CALCULATIONS ==========');\n    console.log('ðŸ“Š Input Data Structure:', JSON.stringify(this.data, null, 2));\n\n    console.log('\\nðŸ› === ENHANCED DEBUG MODE ACTIVATED ===');\n    console.log('ðŸ“‹ This debug output will show:');\n    console.log('   1. Every raw value extracted from QEEG data');\n    console.log('   2. All mathematical formulas and calculations');\n    console.log('   3. Threshold comparisons and scoring logic');\n    console.log('   4. Final score aggregation for each parameter');\n    console.log('===========================================\\n');\n\n    const parameters = [\n      this.calculateCognition(),\n      this.calculateStress(),\n      this.calculateFocusAttention(),\n      this.calculateBurnoutFatigue(),\n      this.calculateEmotionalRegulation(),\n      this.calculateLearning(),\n      this.calculateCreativity()\n    ];\n\n    console.log('\\nâœ… Final 7 Parameter Scores Calculated:');\n    parameters.forEach((p, i) => {\n      console.log(`${i + 1}. ${p.name}: ${p.score}/${p.maxScore} (${p.classification}) ${this.getEmoji(p.classification)}`);\n      p.metrics.forEach(m => {\n        console.log(`   - ${m.name}: ${m.score} point (value: ${JSON.stringify(m.value)})`);\n      });\n    });\n\n    // === ENHANCED DEBUG: Show complete calculation summary ===\n    console.log('\\nðŸ› === DEBUG: COMPLETE CALCULATION SUMMARY ===');\n    console.log('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”');\n    console.log('â”‚ Parameter                   â”‚ Score â”‚ Classificationâ”‚');\n    console.log('â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤');\n    parameters.forEach(p => {\n      const padding = ' '.repeat(28 - p.name.length);\n      console.log(`â”‚ ${p.name}${padding}â”‚  ${p.score}/3  â”‚ ${p.classification.padEnd(12)} â”‚`);\n    });\n    console.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜');\n    console.log(`\\nðŸ“Š OVERALL BRAIN HEALTH SCORE: ${parameters.reduce((sum, p) => sum + p.score, 0)}/21`);\n    console.log('=== END DEBUG: CALCULATION SUMMARY ===\\n');\n\n    console.log('========== CALCULATIONS COMPLETE ==========\\n');\n\n    this.results.parameters = parameters;\n    this.results.overallScore = parameters.reduce((sum, p) => sum + p.score, 0);\n\n    return this.results;\n  }\n\n  getEmoji(classification) {\n    if (classification === 'Low') return 'ðŸ”´';\n    if (classification === 'Medium') return 'ðŸŸ¡';\n    return 'ðŸŸ¢';\n  }\n\n  // ==================== HELPER METHODS ====================\n\n  /**\n   * Get value from QEEG data table\n   * @param {string} condition - 'EC' (Eyes Closed) or 'EO' (Eyes Open)\n   * @param {string} powerType - 'absolute' or 'relative'\n   * @param {string} channel - e.g., 'Fz', 'Cz', 'Pz'\n   * @param {string} band - e.g., 'Theta', 'Alpha', 'Beta', 'HiBeta', 'Delta'\n   */\n  getValue(condition, powerType, channel, band) {\n    try {\n      return this.data[condition][powerType][channel][band];\n    } catch (error) {\n      console.error(`Error getting value: ${condition}.${powerType}.${channel}.${band}`);\n      return null;\n    }\n  }\n\n  /**\n   * Score a metric based on threshold\n   * Returns 1 if condition is met (HEALTHY/NORMAL state by default)\n   * Use 'invert: true' for stress/problem indicators\n   */\n  scoreMetric(value, threshold, comparison = 'less', invert = false) {\n    if (value === null || value === undefined) return 0;\n\n    let result = 0;\n\n    if (comparison === 'less') {\n      result = value < threshold ? 1 : 0;\n    } else if (comparison === 'more') {\n      result = value > threshold ? 1 : 0;\n    } else if (comparison === 'equal') {\n      result = value === threshold ? 1 : 0;\n    }\n\n    // Invert for stress/problem indicators (where 1 point = problem detected)\n    return invert ? (1 - result) : result;\n  }\n\n  /**\n   * Classify score to bucket (Low/Medium/High)\n   */\n  classifyScore(score) {\n    if (score <= 1) return 'Low';\n    if (score === 2) return 'Medium';\n    return 'High';\n  }\n\n  // ==================== INDIVIDUAL METRICS ====================\n\n  /**\n   * Focus Score (Theta:Beta Ratio) - Used in multiple parameters\n   * Eyes Open, Absolute Power, Fz & Cz average\n   * < 1.5 is normal\n   */\n  calculateFocusScore() {\n    console.log('\\n  ðŸ” === Calculating Focus Score (Theta:Beta) ===');\n    console.log('  ðŸ“‹ Purpose: Measures mental focus by comparing slow (Theta) vs fast (Beta) brain waves');\n    console.log('  ðŸ“Š Data Source: Eyes Open (EO), Absolute Power, Channels Fz & Cz');\n    console.log('  ðŸŽ¯ Expected: Ratio < 1.5 indicates good focus (more Beta than Theta)\\n');\n\n    const fzTheta = this.getValue('EO', 'absolute', 'Fz', 'Theta');\n    const fzBeta = this.getValue('EO', 'absolute', 'Fz', 'Beta');\n    const czTheta = this.getValue('EO', 'absolute', 'Cz', 'Theta');\n    const czBeta = this.getValue('EO', 'absolute', 'Cz', 'Beta');\n\n    console.log('  ðŸ› DEBUG - Step 1: Extract Raw Values from QEEG Data');\n    console.log('     â”œâ”€ EO.absolute.Fz.Theta =', fzTheta, 'Î¼VÂ²');\n    console.log('     â”œâ”€ EO.absolute.Fz.Beta  =', fzBeta, 'Î¼VÂ²');\n    console.log('     â”œâ”€ EO.absolute.Cz.Theta =', czTheta, 'Î¼VÂ²');\n    console.log('     â””â”€ EO.absolute.Cz.Beta  =', czBeta, 'Î¼VÂ²');\n\n    // Fix: Use == null to allow 0 values (valid EEG readings)\n    if (fzTheta == null || fzBeta == null || czTheta == null || czBeta == null) {\n      console.log('     âŒ Missing values, returning 0');\n      return { value: null, score: 0 };\n    }\n\n    console.log('\\n  ðŸ› DEBUG - Step 2: Calculate Theta:Beta Ratios');\n    const fzRatio = fzTheta / fzBeta;\n    const czRatio = czTheta / czBeta;\n    console.log('     â”œâ”€ Fz Ratio = Theta/Beta = ' + fzTheta + ' / ' + fzBeta + ' = ' + fzRatio.toFixed(3));\n    console.log('     â””â”€ Cz Ratio = Theta/Beta = ' + czTheta + ' / ' + czBeta + ' = ' + czRatio.toFixed(3));\n\n    console.log('\\n  ðŸ› DEBUG - Step 3: Calculate Average Ratio');\n    const avgRatio = (fzRatio + czRatio) / 2;\n    console.log('     â””â”€ Average = (Fz + Cz) / 2 = (' + fzRatio.toFixed(3) + ' + ' + czRatio.toFixed(3) + ') / 2 = ' + avgRatio.toFixed(3));\n\n    console.log('\\n  ðŸ› DEBUG - Step 4: Score Against Threshold');\n    console.log('     â”œâ”€ Threshold: < 1.5 = Normal (good focus)');\n    console.log('     â”œâ”€ Actual Value: ' + avgRatio.toFixed(3));\n    console.log('     â”œâ”€ Comparison: ' + avgRatio.toFixed(3) + ' < 1.5 ? ' + (avgRatio < 1.5));\n    const score = this.scoreMetric(avgRatio, 1.5, 'less');\n    console.log('     â””â”€ âœ… SCORE: ' + score + '/1 ' + (score === 1 ? '(PASS - Good focus)' : '(FAIL - Poor focus)'));\n\n    return {\n      value: avgRatio,\n      score: score,\n      description: `Theta:Beta Ratio = ${avgRatio.toFixed(2)} (< 1.5 is normal)`,\n      details: { fzRatio: fzRatio.toFixed(2), czRatio: czRatio.toFixed(2) }\n    };\n  }\n\n  /**\n   * Alpha Peak - Used in multiple parameters\n   * Eyes Closed, Special (highest frequency at Pz or below)\n   * > 9 Hz is normal\n   */\n  calculateAlphaPeak() {\n    console.log('\\n  ðŸ” === Calculating Alpha Peak ===');\n    // Get alpha peak from data - NO DEFAULT VALUE\n    const alphaPeak = this.data.EC?.special?.alphaPeak || this.data.EC?.special?.O1 || null;\n\n    console.log('     Raw Value:', alphaPeak);\n\n    // If no data available, return 0 score\n    if (alphaPeak === null || alphaPeak === undefined) {\n      console.log('     âŒ No data available, returning 0');\n      return { value: null, score: 0 };\n    }\n\n    const score = this.scoreMetric(alphaPeak, 9, 'more');\n    console.log(`     Threshold: > 9 Hz = normal`);\n    console.log(`     Result: ${alphaPeak} > 9 = ${alphaPeak > 9}`);\n    console.log(`     âœ… SCORE: ${score}/1`);\n\n    return {\n      value: alphaPeak,\n      score: score,\n      description: `Alpha Peak = ${alphaPeak.toFixed(1)} Hz (> 9 is normal)`\n    };\n  }\n\n  /**\n   * Alpha:Theta Balance - Used in multiple parameters\n   * Eyes Closed, Absolute Power, Fz, Cz, Pz\n   * Order Pz > Cz > Fz is normal for eyes-closed (posterior dominance)\n   * NOTE: Per Rhea's report, posterior dominance (Pz > Cz > Fz) is \"actually common\n   * in eyes-closed recordings where alpha typically peaks over parietal/occipital sites\"\n   */\n  calculateAlphaThetaBalance() {\n    console.log('\\n  ðŸ” === Calculating Alpha:Theta Balance ===');\n    const fzAlpha = this.getValue('EC', 'absolute', 'Fz', 'Alpha');\n    const fzTheta = this.getValue('EC', 'absolute', 'Fz', 'Theta');\n    const czAlpha = this.getValue('EC', 'absolute', 'Cz', 'Alpha');\n    const czTheta = this.getValue('EC', 'absolute', 'Cz', 'Theta');\n    const pzAlpha = this.getValue('EC', 'absolute', 'Pz', 'Alpha');\n    const pzTheta = this.getValue('EC', 'absolute', 'Pz', 'Theta');\n\n    console.log('     Raw Values - Fz:', { Alpha: fzAlpha, Theta: fzTheta });\n    console.log('     Raw Values - Cz:', { Alpha: czAlpha, Theta: czTheta });\n    console.log('     Raw Values - Pz:', { Alpha: pzAlpha, Theta: pzTheta });\n\n    // Fix: Use == null to allow 0 values (valid EEG readings)\n    if (fzAlpha == null || fzTheta == null || czAlpha == null || czTheta == null || pzAlpha == null || pzTheta == null) {\n      console.log('     âŒ Missing values, returning 0');\n      return { value: null, score: 0 };\n    }\n\n    const fzRatio = fzAlpha / fzTheta;\n    const czRatio = czAlpha / czTheta;\n    const pzRatio = pzAlpha / pzTheta;\n\n    console.log(`     Ratios - Fz: ${fzRatio.toFixed(2)}, Cz: ${czRatio.toFixed(2)}, Pz: ${pzRatio.toFixed(2)}`);\n    console.log(`     Expected Order: Pz > Cz > Fz (posterior dominant for EC)`);\n    console.log(`     Actual Order: Pz(${pzRatio.toFixed(2)}) > Cz(${czRatio.toFixed(2)}) > Fz(${fzRatio.toFixed(2)})`);\n\n    // Normal pattern for eyes-closed: Pz > Cz > Fz (posterior dominant)\n    const isNormalOrder = pzRatio > czRatio && czRatio > fzRatio;\n\n    console.log(`     Check: ${pzRatio.toFixed(2)} > ${czRatio.toFixed(2)} = ${pzRatio > czRatio}`);\n    console.log(`     Check: ${czRatio.toFixed(2)} > ${fzRatio.toFixed(2)} = ${czRatio > fzRatio}`);\n    console.log(`     âœ… SCORE: ${isNormalOrder ? 1 : 0}/1`);\n\n    return {\n      value: { fz: fzRatio.toFixed(2), cz: czRatio.toFixed(2), pz: pzRatio.toFixed(2) },\n      score: isNormalOrder ? 1 : 0,\n      description: `Alpha:Theta Order = ${isNormalOrder ? 'Pz > Cz > Fz (Normal for EC)' : 'Abnormal order'}`,\n      details: { fzRatio, czRatio, pzRatio, order: isNormalOrder }\n    };\n  }\n\n  /**\n   * Arousal Score (HiBeta:Beta Ratio) - Used in multiple parameters\n   * Eyes Open, Absolute Power, Fz & Cz average\n   * < 1 is normal\n   */\n  calculateArousalScore() {\n    console.log('\\n  ðŸ” === Calculating Arousal Score (HiBeta:Beta) ===');\n    const fzBeta = this.getValue('EO', 'absolute', 'Fz', 'Beta');\n    const fzHiBeta = this.getValue('EO', 'absolute', 'Fz', 'HiBeta');\n    const czBeta = this.getValue('EO', 'absolute', 'Cz', 'Beta');\n    const czHiBeta = this.getValue('EO', 'absolute', 'Cz', 'HiBeta');\n\n    console.log('     Raw Values - Fz:', { Beta: fzBeta, HiBeta: fzHiBeta });\n    console.log('     Raw Values - Cz:', { Beta: czBeta, HiBeta: czHiBeta });\n\n    // Fix: Use == null to allow 0 values (valid EEG readings)\n    if (fzBeta == null || fzHiBeta == null || czBeta == null || czHiBeta == null) {\n      console.log('     âŒ Missing values, returning 0');\n      return { value: null, score: 0 };\n    }\n\n    const fzRatio = fzHiBeta / fzBeta;\n    const czRatio = czHiBeta / czBeta;\n    const avgRatio = (fzRatio + czRatio) / 2;\n    const score = this.scoreMetric(avgRatio, 1, 'less');\n\n    console.log(`     Fz ratio (HiBeta/Beta): ${fzRatio.toFixed(3)}`);\n    console.log(`     Cz ratio (HiBeta/Beta): ${czRatio.toFixed(3)}`);\n    console.log(`     Average: ${avgRatio.toFixed(3)}`);\n    console.log(`     Threshold: < 1 = normal (low arousal)`);\n    console.log(`     Result: ${avgRatio.toFixed(3)} < 1 = ${avgRatio < 1}`);\n    console.log(`     âœ… SCORE: ${score}/1`);\n\n    return {\n      value: avgRatio,\n      score: score,\n      description: `Arousal Score = ${avgRatio.toFixed(2)} (< 1 is normal)`,\n      details: { fzRatio: fzRatio.toFixed(2), czRatio: czRatio.toFixed(2) }\n    };\n  }\n\n  /**\n   * Relaxation Score - Used in multiple parameters\n   * Eyes Closed, RELATIVE Power, Pz, Alpha/Beta\n   * >= 10 is healthy\n   */\n  calculateRelaxationScore() {\n    console.log('\\n  ðŸ” === Calculating Relaxation Score ===');\n    console.log('  ðŸ“‹ Purpose: Measures ability to relax by comparing Alpha vs Beta waves');\n    console.log('  ðŸ“Š Data Source: Eyes Closed (EC), RELATIVE Power (%), Pz channel (posterior)');\n    console.log('  ðŸŽ¯ Expected: Alpha/Beta >= 10 indicates good relaxation capacity\\n');\n\n    const pzAlpha = this.getValue('EC', 'relative', 'Pz', 'Alpha');\n    const pzBeta = this.getValue('EC', 'relative', 'Pz', 'Beta');\n\n    console.log('  ðŸ› DEBUG - Step 1: Extract Raw Values from QEEG Data');\n    console.log('     â”œâ”€ EC.relative.Pz.Alpha =', pzAlpha, '%');\n    console.log('     â””â”€ EC.relative.Pz.Beta  =', pzBeta, '%');\n\n    // Fix: Use == null to allow 0 values (valid EEG readings)\n    if (pzAlpha == null || pzBeta == null || pzBeta === 0) {\n      console.log('     âš ï¸ Missing or zero Beta value, returning 0');\n      return { value: null, score: 0 };\n    }\n\n    console.log('\\n  ðŸ› DEBUG - Step 2: Calculate Alpha:Beta Ratio');\n    const ratio = pzAlpha / pzBeta;\n    console.log('     â””â”€ Ratio = Alpha/Beta = ' + pzAlpha + ' / ' + pzBeta + ' = ' + ratio.toFixed(2));\n\n    console.log('\\n  ðŸ› DEBUG - Step 3: Score Against Threshold');\n    console.log('     â”œâ”€ Threshold: >= 9.9 (accounting for rounding, ~10.0 is healthy)');\n    console.log('     â”œâ”€ Actual Value: ' + ratio.toFixed(2));\n    console.log('     â”œâ”€ Comparison: ' + ratio.toFixed(2) + ' >= 9.9 ? ' + (ratio >= 9.9));\n\n    // Use >= 9.9 to account for rounding (9.96 â‰ˆ 10.0 is considered healthy)\n    const score = ratio >= 9.9 ? 1 : 0;\n    console.log('     â””â”€ âœ… SCORE: ' + score + '/1 ' + (score === 1 ? '(PASS - Good relaxation)' : '(FAIL - Poor relaxation)'));\n\n    console.log('\\n  ðŸ’¡ Interpretation:');\n    if (ratio >= 10) {\n      console.log('     â†’ High Alpha relative to Beta = Good relaxation capacity');\n      console.log('     â†’ Brain can easily shift into relaxed, calm state');\n    } else {\n      console.log('     â†’ Low Alpha relative to Beta = Difficulty relaxing');\n      console.log('     â†’ May indicate stress or hyperarousal');\n    }\n\n    return {\n      value: ratio,\n      score: score,\n      description: `Relaxation Score = ${ratio.toFixed(2)} (>= 10 is healthy)`\n    };\n  }\n\n  /**\n   * Regeneration (Alpha Modulation) - Used in multiple parameters\n   * EO & EC, Relative Power, Pz, (EC-EO)/EC * 100\n   * > 30% is healthy\n   */\n  calculateRegeneration() {\n    console.log('\\n  ðŸ” === Calculating Regeneration (Alpha Modulation) ===');\n    console.log('     Using: EC vs EO relative power at Pz');\n    const ecAlpha = this.getValue('EC', 'relative', 'Pz', 'Alpha');\n    const eoAlpha = this.getValue('EO', 'relative', 'Pz', 'Alpha');\n\n    console.log('     Raw Values:', { 'EC Alpha': ecAlpha, 'EO Alpha': eoAlpha });\n\n    // Fix: Use == null to allow 0 values (valid EEG readings)\n    if (ecAlpha == null || eoAlpha == null || ecAlpha === 0) {\n      console.log('     âŒ Missing or zero EC Alpha value, returning 0');\n      return { value: null, score: 0 };\n    }\n\n    const modulation = ((ecAlpha - eoAlpha) / ecAlpha) * 100;\n    const score = this.scoreMetric(modulation, 30, 'more');\n\n    console.log(`     Formula: ((EC - EO) / EC) Ã— 100`);\n    console.log(`     Calculation: ((${ecAlpha} - ${eoAlpha}) / ${ecAlpha}) Ã— 100`);\n    console.log(`     Modulation: ${modulation.toFixed(1)}%`);\n    console.log(`     Threshold: > 30% = healthy (good alpha reactivity)`);\n    console.log(`     Result: ${modulation.toFixed(1)}% > 30% = ${modulation > 30}`);\n    console.log(`     âœ… SCORE: ${score}/1`);\n\n    return {\n      value: modulation,\n      score: score,\n      description: `Alpha Modulation = ${modulation.toFixed(1)}% (> 30% is healthy)`\n    };\n  }\n\n  /**\n   * Focus Theta (Relative Power) - Used in Focus & Attention\n   * Eyes Open, Relative Power, Fz & Cz average\n   * < 20% is normal\n   */\n  calculateFocusTheta() {\n    console.log('\\n  ðŸ” === Calculating Focus Theta ===');\n    console.log('     Using: EO relative power at Fz and Cz');\n    const fzTheta = this.getValue('EO', 'relative', 'Fz', 'Theta');\n    const czTheta = this.getValue('EO', 'relative', 'Cz', 'Theta');\n\n    console.log('     Raw Values:', { 'Fz Theta': fzTheta, 'Cz Theta': czTheta });\n\n    // Fix: Use == null to allow 0 values (valid EEG readings)\n    if (fzTheta == null || czTheta == null) {\n      console.log('     âŒ Missing values, returning 0');\n      return { value: null, score: 0 };\n    }\n\n    const avgTheta = (fzTheta + czTheta) / 2;\n    const score = this.scoreMetric(avgTheta, 20, 'less');\n\n    console.log(`     Average: (${fzTheta} + ${czTheta}) / 2 = ${avgTheta.toFixed(1)}%`);\n    console.log(`     Threshold: < 20% = normal (low frontal theta)`);\n    console.log(`     Result: ${avgTheta.toFixed(1)}% < 20% = ${avgTheta < 20}`);\n    console.log(`     âœ… SCORE: ${score}/1`);\n\n    return {\n      value: avgTheta,\n      score: score,\n      description: `Focus Theta = ${avgTheta.toFixed(1)}% (< 20% is normal)`\n    };\n  }\n\n  /**\n   * Excessive Delta - Used in Burnout & Fatigue\n   * Eyes Open, Relative Power, avg of Fz, C3, Cz, C4, P3, Pz, P4\n   * < 70% is normal\n   */\n  calculateExcessiveDelta() {\n    console.log('\\n  ðŸ” === Calculating Excessive Delta ===');\n    console.log('     Using: EO relative power, averaging 7 channels');\n    const channels = ['Fz', 'C3', 'Cz', 'C4', 'P3', 'Pz', 'P4'];\n    let sum = 0;\n    let count = 0;\n    const channelValues = {};\n\n    for (const channel of channels) {\n      const delta = this.getValue('EO', 'relative', channel, 'Delta');\n      channelValues[channel] = delta !== null ? delta : 'N/A';\n      if (delta !== null) {\n        sum += delta;\n        count++;\n      }\n    }\n\n    console.log('     Channel Values:', channelValues);\n    console.log(`     Valid channels: ${count}/7`);\n\n    if (count === 0) {\n      console.log('     âŒ No valid channel data, returning 0');\n      return { value: null, score: 0 };\n    }\n\n    const avgDelta = sum / count;\n    const score = this.scoreMetric(avgDelta, 70, 'less');\n\n    console.log(`     Sum: ${sum.toFixed(2)}, Count: ${count}`);\n    console.log(`     Average Delta: ${avgDelta.toFixed(1)}%`);\n    console.log(`     Threshold: < 70% = normal (low delta during wakefulness)`);\n    console.log(`     Result: ${avgDelta.toFixed(1)}% < 70% = ${avgDelta < 70}`);\n    console.log(`     âœ… SCORE: ${score}/1`);\n\n    return {\n      value: avgDelta,\n      score: score,\n      description: `Excessive Delta = ${avgDelta.toFixed(1)}% (< 70% is normal)`\n    };\n  }\n\n  /**\n   * Alpha Asymmetry (Frontal) - Used in Emotional Regulation\n   * Eyes Closed, Absolute Power, F3 & F4\n   * F4/F3 < 1 is normal\n   */\n  calculateAlphaAsymmetry() {\n    console.log('\\n  ðŸ” === Calculating Alpha Asymmetry (Frontal) ===');\n    console.log('     Using: EC absolute power at F3 and F4');\n    const f3Alpha = this.getValue('EC', 'absolute', 'F3', 'Alpha');\n    const f4Alpha = this.getValue('EC', 'absolute', 'F4', 'Alpha');\n\n    console.log('     Raw Values:', { 'F3 Alpha': f3Alpha, 'F4 Alpha': f4Alpha });\n\n    // Fix: Use == null to allow 0 values (valid EEG readings)\n    if (f3Alpha == null || f4Alpha == null || f3Alpha === 0) {\n      console.log('     âŒ Missing or zero F3 value, returning 0');\n      return { value: null, score: 0 };\n    }\n\n    const ratio = f4Alpha / f3Alpha;\n    const score = this.scoreMetric(ratio, 1, 'less');\n\n    console.log(`     Ratio: F4/F3 = ${f4Alpha} / ${f3Alpha} = ${ratio.toFixed(3)}`);\n    console.log(`     Threshold: < 1 = normal (left frontal dominance, positive affect)`);\n    console.log(`     Result: ${ratio.toFixed(3)} < 1 = ${ratio < 1}`);\n    console.log(`     âœ… SCORE: ${score}/1`);\n\n    return {\n      value: ratio,\n      score: score,\n      description: `Alpha Asymmetry = ${ratio.toFixed(2)} (< 1 is normal)`\n    };\n  }\n\n  // ==================== 7 PARAMETER CALCULATIONS ====================\n\n  /**\n   * 1. Cognition\n   * - Focus Score (Theta:Beta Ratio)\n   * - Alpha Peak\n   * - Alpha:Theta Balance\n   */\n  calculateCognition() {\n    console.log('\\nðŸ“Š Calculating COGNITION...');\n    const metric1 = this.calculateFocusScore();\n    const metric2 = this.calculateAlphaPeak();\n    const metric3 = this.calculateAlphaThetaBalance();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n\n    return {\n      name: 'Cognition',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [\n        { name: 'Focus Score (Theta:Beta)', ...metric1 },\n        { name: 'Alpha Peak', ...metric2 },\n        { name: 'Alpha:Theta Balance', ...metric3 }\n      ]\n    };\n  }\n\n  /**\n   * 2. Stress (Note: 0/3 is healthy, 3/3 is high stress)\n   * - Arousal Score (inverted: abnormal = 1 point)\n   * - Relaxation Score (inverted: abnormal = 1 point)\n   * - Regeneration (inverted: abnormal = 1 point)\n   */\n  calculateStress() {\n    console.log('\\nðŸ“Š === STRESS PARAMETER (0/3 = Healthy, 3/3 = High Stress) ===');\n    const metric1 = this.calculateArousalScore();\n    const metric2 = this.calculateRelaxationScore();\n    const metric3 = this.calculateRegeneration();\n\n    // Invert scores: 0->1, 1->0 (so abnormal values add to stress score)\n    const invertedScore1 = 1 - metric1.score;\n    const invertedScore2 = 1 - metric2.score;\n    const invertedScore3 = 1 - metric3.score;\n\n    console.log(`\\n  ðŸ”„ INVERTING SCORES (abnormal values = stress):`);\n    console.log(`     Arousal normal score: ${metric1.score} â†’ Inverted (stress): ${invertedScore1}`);\n    console.log(`     Relaxation normal score: ${metric2.score} â†’ Inverted (stress): ${invertedScore2}`);\n    console.log(`     Regeneration normal score: ${metric3.score} â†’ Inverted (stress): ${invertedScore3}`);\n\n    const totalScore = invertedScore1 + invertedScore2 + invertedScore3;\n    console.log(`\\n  ðŸ“Š STRESS TOTAL: ${invertedScore1} + ${invertedScore2} + ${invertedScore3} = ${totalScore}/3`);\n\n    return {\n      name: 'Stress',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [\n        { name: 'Arousal Score', ...metric1, score: invertedScore1 },\n        { name: 'Relaxation Score', ...metric2, score: invertedScore2 },\n        { name: 'Regeneration (Alpha Modulation)', ...metric3, score: invertedScore3 }\n      ]\n    };\n  }\n\n  /**\n   * 3. Focus & Attention\n   * - Focus Theta\n   * - Alpha:Theta Balance\n   * - Focus Score (Theta:Beta)\n   */\n  calculateFocusAttention() {\n    console.log('\\nðŸ“Š Calculating FOCUS & ATTENTION...');\n    const metric1 = this.calculateFocusTheta();\n    const metric2 = this.calculateAlphaThetaBalance();\n    const metric3 = this.calculateFocusScore();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n\n    return {\n      name: 'Focus & Attention',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [\n        { name: 'Focus Theta', ...metric1 },\n        { name: 'Alpha:Theta Balance', ...metric2 },\n        { name: 'Focus Score (Theta:Beta)', ...metric3 }\n      ]\n    };\n  }\n\n  /**\n   * 4. Burnout & Fatigue (Note: 0/3 is healthy)\n   * - Arousal Score (inverted: abnormal = 1 point)\n   * - Relaxation Score (inverted: abnormal = 1 point)\n   * - Excessive Delta (inverted: abnormal = 1 point)\n   */\n  calculateBurnoutFatigue() {\n    console.log('\\nðŸ“Š === BURNOUT & FATIGUE PARAMETER (0/3 = Healthy, 3/3 = High Burnout) ===');\n    const metric1 = this.calculateArousalScore();\n    const metric2 = this.calculateRelaxationScore();\n    const metric3 = this.calculateExcessiveDelta();\n\n    // Invert scores: 0->1, 1->0 (so abnormal values add to burnout score)\n    const invertedScore1 = 1 - metric1.score;\n    const invertedScore2 = 1 - metric2.score;\n    const invertedScore3 = 1 - metric3.score;\n\n    console.log(`\\n  ðŸ”„ INVERTING SCORES (abnormal values = burnout):`);\n    console.log(`     Arousal normal score: ${metric1.score} â†’ Inverted (burnout): ${invertedScore1}`);\n    console.log(`     Relaxation normal score: ${metric2.score} â†’ Inverted (burnout): ${invertedScore2}`);\n    console.log(`     Excessive Delta normal score: ${metric3.score} â†’ Inverted (burnout): ${invertedScore3}`);\n\n    const totalScore = invertedScore1 + invertedScore2 + invertedScore3;\n    console.log(`\\n  ðŸ“Š BURNOUT TOTAL: ${invertedScore1} + ${invertedScore2} + ${invertedScore3} = ${totalScore}/3`);\n\n    return {\n      name: 'Burnout & Fatigue',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [\n        { name: 'Arousal Score', ...metric1, score: invertedScore1 },\n        { name: 'Relaxation Score', ...metric2, score: invertedScore2 },\n        { name: 'Excessive Delta', ...metric3, score: invertedScore3 }\n      ]\n    };\n  }\n\n  /**\n   * 5. Emotional Regulation\n   * - Alpha Asymmetry\n   * - Arousal Score\n   * - Regeneration\n   */\n  calculateEmotionalRegulation() {\n    console.log('\\nðŸ“Š Calculating EMOTIONAL REGULATION...');\n    const metric1 = this.calculateAlphaAsymmetry();\n    const metric2 = this.calculateArousalScore();\n    const metric3 = this.calculateRegeneration();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n\n    return {\n      name: 'Emotional Regulation',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [\n        { name: 'Alpha Asymmetry (Frontal)', ...metric1 },\n        { name: 'Arousal Score', ...metric2 },\n        { name: 'Regeneration (Alpha Modulation)', ...metric3 }\n      ]\n    };\n  }\n\n  /**\n   * 6. Learning\n   * - Alpha Peak\n   * - Focus Score (Theta:Beta)\n   * - Arousal Score\n   */\n  calculateLearning() {\n    console.log('\\nðŸ“Š Calculating LEARNING...');\n    const metric1 = this.calculateAlphaPeak();\n    const metric2 = this.calculateFocusScore();\n    const metric3 = this.calculateArousalScore();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n\n    return {\n      name: 'Learning',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [\n        { name: 'Alpha Peak', ...metric1 },\n        { name: 'Focus Score (Theta:Beta)', ...metric2 },\n        { name: 'Arousal Score', ...metric3 }\n      ]\n    };\n  }\n\n  /**\n   * 7. Creativity\n   * - Relaxation Score\n   * - Focus Score (Theta:Beta)\n   * - Alpha Peak\n   */\n  calculateCreativity() {\n    console.log('\\nðŸ“Š Calculating CREATIVITY...');\n    const metric1 = this.calculateRelaxationScore();\n    const metric2 = this.calculateFocusScore();\n    const metric3 = this.calculateAlphaPeak();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n    console.log(`   Total: ${metric1.score} + ${metric2.score} + ${metric3.score} = ${totalScore}/3`);\n\n    return {\n      name: 'Creativity',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [\n        { name: 'Relaxation Score', ...metric1 },\n        { name: 'Focus Score (Theta:Beta)', ...metric2 },\n        { name: 'Alpha Peak', ...metric3 }\n      ]\n    };\n  }\n}\n\nmodule.exports = AlgorithmCalculator;\n","numLines":724,"startLine":1,"totalLines":724}}}
{"parentUuid":"155c9295-938e-4982-9296-e5d287616bb6","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017e65pH8bCkqgFosE1kVLEv","type":"tool_result","content":"     1â†’/**\n     2â†’ * QEEG Z-Score Algorithm Calculator\n     3â†’ * Calculates 7 brain health parameters using Z-score data instead of raw power values\n     4â†’ * Z-scores represent standard deviations from age-matched norms\n     5â†’ * Each parameter has 3 sub-metrics, scored 0-3, classified as Low/Medium/High\n     6â†’ */\n     7â†’\n     8â†’const THRESHOLDS = require('./zscoreThresholds');\n     9â†’\n    10â†’class ZScoreCalculator {\n    11â†’  constructor(qeegData) {\n    12â†’    this.data = qeegData;\n    13â†’    this.results = {\n    14â†’      parameters: [],\n    15â†’      rawCalculations: {},\n    16â†’      overallScore: 0\n    17â†’    };\n    18â†’  }\n    19â†’\n    20â†’  /**\n    21â†’   * Main calculation method - calculates all 7 parameters\n    22â†’   */\n    23â†’  calculate() {\n    24â†’    console.log('\\nðŸ§® ========== STARTING Z-SCORE ALGORITHM CALCULATIONS ==========');\n    25â†’    console.log('ðŸ“Š Input Data Type: Z-SCORE MODE (Standard Deviations from Age-Matched Norms)');\n    26â†’    console.log('ðŸ“‹ Z-score interpretation:');\n    27â†’    console.log('   â€¢ Z = 0: Average (at the norm)');\n    28â†’    console.log('   â€¢ Z > 0: Above average (higher than norm)');\n    29â†’    console.log('   â€¢ Z < 0: Below average (lower than norm)');\n    30â†’    console.log('   â€¢ |Z| < 1.0: Within normal range (Â±1 SD)');\n    31â†’    console.log('   â€¢ |Z| > 2.0: Clinically significant deviation');\n    32â†’    console.log('===========================================\\n');\n    33â†’\n    34â†’    console.log('ðŸ› === ENHANCED Z-SCORE DEBUG MODE ACTIVATED ===');\n    35â†’    console.log('ðŸ“‹ This debug output will show:');\n    36â†’    console.log('   1. Every Z-score value from QEEG data');\n    37â†’    console.log('   2. Threshold comparisons (e.g., within Â±1.0 SD)');\n    38â†’    console.log('   3. Clinical interpretation of deviations');\n    39â†’    console.log('   4. Final score aggregation for each parameter');\n    40â†’    console.log('===========================================\\n');\n    41â†’\n    42â†’    const parameters = [\n    43â†’      this.calculateCognition(),\n    44â†’      this.calculateStress(),\n    45â†’      this.calculateFocusAttention(),\n    46â†’      this.calculateBurnoutFatigue(),\n    47â†’      this.calculateEmotionalRegulation(),\n    48â†’      this.calculateLearning(),\n    49â†’      this.calculateCreativity()\n    50â†’    ];\n    51â†’\n    52â†’    console.log('\\nâœ… Final 7 Parameter Scores Calculated (Z-Score Mode):');\n    53â†’    parameters.forEach((p, i) => {\n    54â†’      const emoji = p.score <= 1 ? 'ðŸ”´' : p.score === 2 ? 'ðŸŸ¡' : 'ðŸŸ¢';\n    55â†’      console.log(`${i + 1}. ${p.name}: ${p.score}/${p.maxScore} (${p.classification}) ${emoji}`);\n    56â†’      p.metrics.forEach(m => {\n    57â†’        console.log(`   - ${m.name}: ${m.score} point - ${m.interpretation}`);\n    58â†’      });\n    59â†’    });\n    60â†’\n    61â†’    // === ENHANCED DEBUG: Show complete Z-score calculation summary ===\n    62â†’    console.log('\\nðŸ› === DEBUG: COMPLETE Z-SCORE CALCULATION SUMMARY ===');\n    63â†’    console.log('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”');\n    64â†’    console.log('â”‚ Parameter                   â”‚ Score â”‚ Classificationâ”‚');\n    65â†’    console.log('â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤');\n    66â†’    parameters.forEach(p => {\n    67â†’      const padding = ' '.repeat(28 - p.name.length);\n    68â†’      console.log(`â”‚ ${p.name}${padding}â”‚  ${p.score}/3  â”‚ ${p.classification.padEnd(12)} â”‚`);\n    69â†’    });\n    70â†’    console.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜');\n    71â†’    console.log(`\\nðŸ“Š OVERALL BRAIN HEALTH SCORE: ${parameters.reduce((sum, p) => sum + p.score, 0)}/21`);\n    72â†’    console.log('=== END DEBUG: Z-SCORE CALCULATION SUMMARY ===\\n');\n    73â†’\n    74â†’    console.log('========== Z-SCORE CALCULATIONS COMPLETE ==========\\n');\n    75â†’\n    76â†’    this.results.parameters = parameters;\n    77â†’    this.results.overallScore = parameters.reduce((sum, p) => sum + p.score, 0);\n    78â†’\n    79â†’    return this.results;\n    80â†’  }\n    81â†’\n    82â†’  // ==================== HELPER METHODS ====================\n    83â†’\n    84â†’  /**\n    85â†’   * Get Z-score value from QEEG data\n    86â†’   * @param {string} condition - 'EC' (Eyes Closed) or 'EO' (Eyes Open)\n    87â†’   * @param {string} powerType - 'absolute' or 'relative'\n    88â†’   * @param {string} channel - e.g., 'Fz', 'Cz', 'Pz'\n    89â†’   * @param {string} band - e.g., 'Theta', 'Alpha', 'Beta', 'HiBeta', 'Delta'\n    90â†’   */\n    91â†’  getZScore(condition, powerType, channel, band) {\n    92â†’    try {\n    93â†’      // Z-scores are stored in data[condition].zscores[powerType][channel][band]\n    94â†’      return this.data[condition].zscores[powerType][channel][band];\n    95â†’    } catch (error) {\n    96â†’      console.error(`Error getting Z-score: ${condition}.zscores.${powerType}.${channel}.${band}`);\n    97â†’      return null;\n    98â†’    }\n    99â†’  }\n   100â†’\n   101â†’  /**\n   102â†’   * Check if Z-score is within normal range\n   103â†’   * @param {number} zscore - The Z-score value\n   104â†’   * @param {number} threshold - Threshold value (typically 1.0 or 2.0)\n   105â†’   * @param {string} comparison - 'within', 'above', 'below'\n   106â†’   * @returns {number} 1 if passes, 0 if fails\n   107â†’   */\n   108â†’  scoreZMetric(zscore, threshold, comparison = 'within') {\n   109â†’    if (zscore === null || zscore === undefined) return 0;\n   110â†’\n   111â†’    if (comparison === 'within') {\n   112â†’      // Check if Z-score is within Â±threshold (normal range)\n   113â†’      return Math.abs(zscore) <= threshold ? 1 : 0;\n   114â†’    } else if (comparison === 'below') {\n   115â†’      // Check if Z-score is below threshold (not elevated)\n   116â†’      return zscore < threshold ? 1 : 0;\n   117â†’    } else if (comparison === 'above') {\n   118â†’      // Check if Z-score is above threshold (not reduced)\n   119â†’      return zscore > threshold ? 1 : 0;\n   120â†’    }\n   121â†’    return 0;\n   122â†’  }\n   123â†’\n   124â†’  /**\n   125â†’   * Classify score to bucket (Low/Medium/High)\n   126â†’   */\n   127â†’  classifyScore(score) {\n   128â†’    if (score <= 1) return 'Low';\n   129â†’    if (score === 2) return 'Medium';\n   130â†’    return 'High';\n   131â†’  }\n   132â†’\n   133â†’  // ==================== INDIVIDUAL METRICS ====================\n   134â†’\n   135â†’  /**\n   136â†’   * COGNITION METRICS\n   137â†’   */\n   138â†’\n   139â†’  /**\n   140â†’   * Metric 1: Focus Score (Theta & Beta Z-scores)\n   141â†’   * Eyes Open, Check Fz & Cz Theta and Beta Z-scores\n   142â†’   * Pass if Theta Z-score < 1.0 AND Beta Z-score > -1.0\n   143â†’   */\n   144â†’  calculateFocusScore() {\n   145â†’    console.log('\\n  ðŸ” === Calculating Focus Score (Z-Score Mode) ===');\n   146â†’    console.log('  ðŸ“‹ Purpose: Assess focus based on Z-scores (deviations from age norms)');\n   147â†’    console.log('  ðŸ“Š Data Source: Eyes Open (EO), Absolute Power Z-scores, Fz & Cz');\n   148â†’    console.log('  ðŸŽ¯ Criteria: Theta Z < 1.0 (not elevated) AND Beta Z > -1.0 (not reduced)\\n');\n   149â†’\n   150â†’    const fzTheta = this.getZScore('EO', 'absolute', 'Fz', 'Theta');\n   151â†’    const fzBeta = this.getZScore('EO', 'absolute', 'Fz', 'Beta');\n   152â†’    const czTheta = this.getZScore('EO', 'absolute', 'Cz', 'Theta');\n   153â†’    const czBeta = this.getZScore('EO', 'absolute', 'Cz', 'Beta');\n   154â†’\n   155â†’    console.log('  ðŸ› DEBUG - Step 1: Extract Z-Score Values');\n   156â†’    console.log('     â”œâ”€ EO.zscores.absolute.Fz.Theta = ' + (fzTheta !== null ? fzTheta.toFixed(2) : 'NULL') + ' SD');\n   157â†’    console.log('     â”œâ”€ EO.zscores.absolute.Fz.Beta  = ' + (fzBeta !== null ? fzBeta.toFixed(2) : 'NULL') + ' SD');\n   158â†’    console.log('     â”œâ”€ EO.zscores.absolute.Cz.Theta = ' + (czTheta !== null ? czTheta.toFixed(2) : 'NULL') + ' SD');\n   159â†’    console.log('     â””â”€ EO.zscores.absolute.Cz.Beta  = ' + (czBeta !== null ? czBeta.toFixed(2) : 'NULL') + ' SD');\n   160â†’\n   161â†’    if (fzTheta == null || fzBeta == null || czTheta == null || czBeta == null) {\n   162â†’      console.log('     âŒ Missing Z-score data, returning 0');\n   163â†’      return {\n   164â†’        name: 'Focus Score',\n   165â†’        value: null,\n   166â†’        score: 0,\n   167â†’        interpretation: 'Insufficient data',\n   168â†’        details: 'Missing Z-score data for frontal regions'\n   169â†’      };\n   170â†’    }\n   171â†’\n   172â†’    console.log('\\n  ðŸ› DEBUG - Step 2: Check Thresholds');\n   173â†’    console.log('     Fz checks:');\n   174â†’    console.log('     â”œâ”€ Theta Z < 1.0? ' + fzTheta.toFixed(2) + ' < 1.0 = ' + (fzTheta < THRESHOLDS.COGNITION.FOCUS_SCORE.THETA_ELEVATED));\n   175â†’    console.log('     â””â”€ Beta Z > -1.0? ' + fzBeta.toFixed(2) + ' > -1.0 = ' + (fzBeta > THRESHOLDS.COGNITION.FOCUS_SCORE.BETA_REDUCED));\n   176â†’\n   177â†’    console.log('     Cz checks:');\n   178â†’    console.log('     â”œâ”€ Theta Z < 1.0? ' + czTheta.toFixed(2) + ' < 1.0 = ' + (czTheta < THRESHOLDS.COGNITION.FOCUS_SCORE.THETA_ELEVATED));\n   179â†’    console.log('     â””â”€ Beta Z > -1.0? ' + czBeta.toFixed(2) + ' > -1.0 = ' + (czBeta > THRESHOLDS.COGNITION.FOCUS_SCORE.BETA_REDUCED));\n   180â†’\n   181â†’    // Pass if all conditions met\n   182â†’    const fzPass = fzTheta < THRESHOLDS.COGNITION.FOCUS_SCORE.THETA_ELEVATED &&\n   183â†’                   fzBeta > THRESHOLDS.COGNITION.FOCUS_SCORE.BETA_REDUCED;\n   184â†’    const czPass = czTheta < THRESHOLDS.COGNITION.FOCUS_SCORE.THETA_ELEVATED &&\n   185â†’                   czBeta > THRESHOLDS.COGNITION.FOCUS_SCORE.BETA_REDUCED;\n   186â†’\n   187â†’    console.log('\\n  ðŸ› DEBUG - Step 3: Evaluate Combined Result');\n   188â†’    console.log('     â”œâ”€ Fz passes all checks? ' + fzPass);\n   189â†’    console.log('     â”œâ”€ Cz passes all checks? ' + czPass);\n   190â†’    console.log('     â””â”€ Both regions pass? ' + (fzPass && czPass));\n   191â†’\n   192â†’    const score = (fzPass && czPass) ? 1 : 0;\n   193â†’    console.log('     âœ… FINAL SCORE: ' + score + '/1 ' + (score === 1 ? '(OPTIMAL)' : '(SUB-OPTIMAL)'));\n   194â†’\n   195â†’    console.log('\\n  ðŸ’¡ Clinical Interpretation:');\n   196â†’    if (score === 1) {\n   197â†’      console.log('     â†’ Theta not elevated, Beta not reduced = Good attentional control');\n   198â†’      console.log('     â†’ Brain shows age-appropriate focus ability');\n   199â†’    } else {\n   200â†’      if (fzTheta >= 1.0 || czTheta >= 1.0) {\n   201â†’        console.log('     â†’ Elevated Theta = Possible attention deficits');\n   202â†’      }\n   203â†’      if (fzBeta <= -1.0 || czBeta <= -1.0) {\n   204â†’        console.log('     â†’ Reduced Beta = Possible underarousal/low engagement');\n   205â†’      }\n   206â†’    }\n   207â†’\n   208â†’    return {\n   209â†’      name: 'Focus Score',\n   210â†’      value: { fzTheta, fzBeta, czTheta, czBeta },\n   211â†’      score,\n   212â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   213â†’      details: `Fz: Theta Z=${fzTheta.toFixed(2)}, Beta Z=${fzBeta.toFixed(2)} | Cz: Theta Z=${czTheta.toFixed(2)}, Beta Z=${czBeta.toFixed(2)}`\n   214â†’    };\n   215â†’  }\n   216â†’\n   217â†’  /**\n   218â†’   * Metric 2: Alpha Peak\n   219â†’   * Eyes Closed, Alpha Peak Frequency Z-score\n   220â†’   * Pass if Z-score within Â±1.0\n   221â†’   */\n   222â†’  calculateAlphaPeak() {\n   223â†’    const alphaPeakZscore = this.data.EC?.special?.alphaPeakZscore || 0.0;\n   224â†’\n   225â†’    const score = this.scoreZMetric(alphaPeakZscore, THRESHOLDS.COGNITION.ALPHA_PEAK.NORMAL_RANGE, 'within');\n   226â†’\n   227â†’    return {\n   228â†’      name: 'Alpha Peak',\n   229â†’      value: alphaPeakZscore,\n   230â†’      score,\n   231â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   232â†’      details: `Alpha Peak Z-score: ${alphaPeakZscore.toFixed(2)} (within Â±1.0 is normal)`\n   233â†’    };\n   234â†’  }\n   235â†’\n   236â†’  /**\n   237â†’   * Metric 3: Alpha/Theta Balance\n   238â†’   * Eyes Closed, Check if Alpha Z-score > -1.0 and Theta Z-score < 1.0 across regions\n   239â†’   * Pass if all regions meet criteria\n   240â†’   */\n   241â†’  calculateAlphaThetaBalance() {\n   242â†’    const fzAlpha = this.getZScore('EC', 'absolute', 'Fz', 'Alpha');\n   243â†’    const fzTheta = this.getZScore('EC', 'absolute', 'Fz', 'Theta');\n   244â†’    const czAlpha = this.getZScore('EC', 'absolute', 'Cz', 'Alpha');\n   245â†’    const czTheta = this.getZScore('EC', 'absolute', 'Cz', 'Theta');\n   246â†’    const pzAlpha = this.getZScore('EC', 'absolute', 'Pz', 'Alpha');\n   247â†’    const pzTheta = this.getZScore('EC', 'absolute', 'Pz', 'Theta');\n   248â†’\n   249â†’    if (fzAlpha == null || fzTheta == null || czAlpha == null || czTheta == null || pzAlpha == null || pzTheta == null) {\n   250â†’      return {\n   251â†’        name: 'Alpha/Theta Balance',\n   252â†’        value: null,\n   253â†’        score: 0,\n   254â†’        interpretation: 'Insufficient data',\n   255â†’        details: 'Missing Z-score data'\n   256â†’      };\n   257â†’    }\n   258â†’\n   259â†’    // Check if all regions pass\n   260â†’    const allRegionsPass =\n   261â†’      fzAlpha > THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.ALPHA_LOW &&\n   262â†’      fzTheta < THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.THETA_HIGH &&\n   263â†’      czAlpha > THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.ALPHA_LOW &&\n   264â†’      czTheta < THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.THETA_HIGH &&\n   265â†’      pzAlpha > THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.ALPHA_LOW &&\n   266â†’      pzTheta < THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.THETA_HIGH;\n   267â†’\n   268â†’    const score = allRegionsPass ? 1 : 0;\n   269â†’\n   270â†’    return {\n   271â†’      name: 'Alpha/Theta Balance',\n   272â†’      value: { fzAlpha, fzTheta, czAlpha, czTheta, pzAlpha, pzTheta },\n   273â†’      score,\n   274â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   275â†’      details: `Alpha Z-scores: Fz=${fzAlpha.toFixed(2)}, Cz=${czAlpha.toFixed(2)}, Pz=${pzAlpha.toFixed(2)} | Theta Z-scores: Fz=${fzTheta.toFixed(2)}, Cz=${czTheta.toFixed(2)}, Pz=${pzTheta.toFixed(2)}`\n   276â†’    };\n   277â†’  }\n   278â†’\n   279â†’  /**\n   280â†’   * STRESS METRICS\n   281â†’   */\n   282â†’\n   283â†’  /**\n   284â†’   * Metric 1: Arousal Score (HiBeta Z-scores)\n   285â†’   * Eyes Open, HiBeta Z-scores across Fz, Cz, Pz\n   286â†’   * Pass if all < 1.0 (not elevated)\n   287â†’   */\n   288â†’  calculateArousalScore() {\n   289â†’    const fzHiBeta = this.getZScore('EO', 'absolute', 'Fz', 'HiBeta');\n   290â†’    const czHiBeta = this.getZScore('EO', 'absolute', 'Cz', 'HiBeta');\n   291â†’    const pzHiBeta = this.getZScore('EO', 'absolute', 'Pz', 'HiBeta');\n   292â†’\n   293â†’    if (fzHiBeta == null || czHiBeta == null || pzHiBeta == null) {\n   294â†’      return {\n   295â†’        name: 'Arousal Score',\n   296â†’        value: null,\n   297â†’        score: 0,\n   298â†’        interpretation: 'Insufficient data',\n   299â†’        details: 'Missing HiBeta Z-score data'\n   300â†’      };\n   301â†’    }\n   302â†’\n   303â†’    const allWithinRange =\n   304â†’      fzHiBeta < THRESHOLDS.STRESS.AROUSAL_SCORE.HIBETA_ELEVATED &&\n   305â†’      czHiBeta < THRESHOLDS.STRESS.AROUSAL_SCORE.HIBETA_ELEVATED &&\n   306â†’      pzHiBeta < THRESHOLDS.STRESS.AROUSAL_SCORE.HIBETA_ELEVATED;\n   307â†’\n   308â†’    const score = allWithinRange ? 1 : 0;\n   309â†’\n   310â†’    return {\n   311â†’      name: 'Arousal Score',\n   312â†’      value: { fzHiBeta, czHiBeta, pzHiBeta },\n   313â†’      score,\n   314â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   315â†’      details: `HiBeta Z-scores: Fz=${fzHiBeta.toFixed(2)}, Cz=${czHiBeta.toFixed(2)}, Pz=${pzHiBeta.toFixed(2)} (< 1.0 is normal)`\n   316â†’    };\n   317â†’  }\n   318â†’\n   319â†’  /**\n   320â†’   * Metric 2: Relaxation Score (Posterior Theta)\n   321â†’   * Eyes Closed, Pz Theta Z-score\n   322â†’   * Pass if > -1.0 (not reduced)\n   323â†’   */\n   324â†’  calculateRelaxationScore() {\n   325â†’    const pzTheta = this.getZScore('EC', 'absolute', 'Pz', 'Theta');\n   326â†’\n   327â†’    if (pzTheta == null) {\n   328â†’      return {\n   329â†’        name: 'Relaxation Score',\n   330â†’        value: null,\n   331â†’        score: 0,\n   332â†’        interpretation: 'Insufficient data',\n   333â†’        details: 'Missing Pz Theta Z-score'\n   334â†’      };\n   335â†’    }\n   336â†’\n   337â†’    const score = this.scoreZMetric(pzTheta, THRESHOLDS.STRESS.RELAXATION_SCORE.THETA_LOW, 'above');\n   338â†’\n   339â†’    return {\n   340â†’      name: 'Relaxation Score',\n   341â†’      value: pzTheta,\n   342â†’      score,\n   343â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   344â†’      details: `Pz Theta Z-score: ${pzTheta.toFixed(2)} (> -1.0 is normal)`\n   345â†’    };\n   346â†’  }\n   347â†’\n   348â†’  /**\n   349â†’   * Metric 3: Regeneration (Posterior Alpha)\n   350â†’   * Eyes Closed, Pz Alpha Z-score\n   351â†’   * Pass if > -1.0 (not reduced)\n   352â†’   */\n   353â†’  calculateRegeneration() {\n   354â†’    const pzAlpha = this.getZScore('EC', 'absolute', 'Pz', 'Alpha');\n   355â†’\n   356â†’    if (pzAlpha == null) {\n   357â†’      return {\n   358â†’        name: 'Regeneration',\n   359â†’        value: null,\n   360â†’        score: 0,\n   361â†’        interpretation: 'Insufficient data',\n   362â†’        details: 'Missing Pz Alpha Z-score'\n   363â†’      };\n   364â†’    }\n   365â†’\n   366â†’    const score = this.scoreZMetric(pzAlpha, THRESHOLDS.STRESS.REGENERATION.ALPHA_LOW, 'above');\n   367â†’\n   368â†’    return {\n   369â†’      name: 'Regeneration',\n   370â†’      value: pzAlpha,\n   371â†’      score,\n   372â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   373â†’      details: `Pz Alpha Z-score: ${pzAlpha.toFixed(2)} (> -1.0 is normal)`\n   374â†’    };\n   375â†’  }\n   376â†’\n   377â†’  /**\n   378â†’   * FOCUS AND ATTENTION METRICS\n   379â†’   */\n   380â†’\n   381â†’  /**\n   382â†’   * Metric 1: Focus Theta (Frontal Theta)\n   383â†’   * Eyes Open, Fz Theta Z-score\n   384â†’   * Pass if < 1.0 (not elevated)\n   385â†’   */\n   386â†’  calculateFocusTheta() {\n   387â†’    const fzTheta = this.getZScore('EO', 'absolute', 'Fz', 'Theta');\n   388â†’\n   389â†’    if (fzTheta == null) {\n   390â†’      return {\n   391â†’        name: 'Focus Theta',\n   392â†’        value: null,\n   393â†’        score: 0,\n   394â†’        interpretation: 'Insufficient data',\n   395â†’        details: 'Missing Fz Theta Z-score'\n   396â†’      };\n   397â†’    }\n   398â†’\n   399â†’    const score = this.scoreZMetric(fzTheta, THRESHOLDS.FOCUS_AND_ATTENTION.FOCUS_THETA.THETA_ELEVATED, 'below');\n   400â†’\n   401â†’    return {\n   402â†’      name: 'Focus Theta',\n   403â†’      value: fzTheta,\n   404â†’      score,\n   405â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   406â†’      details: `Fz Theta Z-score: ${fzTheta.toFixed(2)} (< 1.0 is normal)`\n   407â†’    };\n   408â†’  }\n   409â†’\n   410â†’  /**\n   411â†’   * Metric 2: Beta Coherence (C3-C4 Beta asymmetry)\n   412â†’   * Eyes Open, Check C3 and C4 Beta Z-score difference\n   413â†’   * Pass if |difference| < 1.0\n   414â†’   */\n   415â†’  calculateBetaCoherence() {\n   416â†’    const c3Beta = this.getZScore('EO', 'absolute', 'C3', 'Beta');\n   417â†’    const c4Beta = this.getZScore('EO', 'absolute', 'C4', 'Beta');\n   418â†’\n   419â†’    if (c3Beta == null || c4Beta == null) {\n   420â†’      return {\n   421â†’        name: 'Beta Coherence',\n   422â†’        value: null,\n   423â†’        score: 0,\n   424â†’        interpretation: 'Insufficient data',\n   425â†’        details: 'Missing C3/C4 Beta Z-scores'\n   426â†’      };\n   427â†’    }\n   428â†’\n   429â†’    const asymmetry = Math.abs(c3Beta - c4Beta);\n   430â†’    const score = asymmetry < THRESHOLDS.FOCUS_AND_ATTENTION.BETA_COHERENCE.ASYMMETRY_THRESHOLD ? 1 : 0;\n   431â†’\n   432â†’    return {\n   433â†’      name: 'Beta Coherence',\n   434â†’      value: { c3Beta, c4Beta, asymmetry },\n   435â†’      score,\n   436â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   437â†’      details: `C3 Beta Z=${c3Beta.toFixed(2)}, C4 Beta Z=${c4Beta.toFixed(2)}, Asymmetry=${asymmetry.toFixed(2)} (< 1.0 is normal)`\n   438â†’    };\n   439â†’  }\n   440â†’\n   441â†’  /**\n   442â†’   * Metric 3: Theta/Beta Ratio\n   443â†’   * Eyes Open, Cz Theta and Beta Z-scores\n   444â†’   * Pass if Theta < 1.0 and Beta > -1.0\n   445â†’   */\n   446â†’  calculateThetaBetaRatio() {\n   447â†’    const czTheta = this.getZScore('EO', 'absolute', 'Cz', 'Theta');\n   448â†’    const czBeta = this.getZScore('EO', 'absolute', 'Cz', 'Beta');\n   449â†’\n   450â†’    if (czTheta == null || czBeta == null) {\n   451â†’      return {\n   452â†’        name: 'Theta/Beta Ratio',\n   453â†’        value: null,\n   454â†’        score: 0,\n   455â†’        interpretation: 'Insufficient data',\n   456â†’        details: 'Missing Cz Theta/Beta Z-scores'\n   457â†’      };\n   458â†’    }\n   459â†’\n   460â†’    const score = (czTheta < THRESHOLDS.FOCUS_AND_ATTENTION.THETA_BETA_RATIO.THETA_HIGH &&\n   461â†’                   czBeta > THRESHOLDS.FOCUS_AND_ATTENTION.THETA_BETA_RATIO.BETA_LOW) ? 1 : 0;\n   462â†’\n   463â†’    return {\n   464â†’      name: 'Theta/Beta Ratio',\n   465â†’      value: { czTheta, czBeta },\n   466â†’      score,\n   467â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   468â†’      details: `Cz Theta Z=${czTheta.toFixed(2)} (< 1.0), Beta Z=${czBeta.toFixed(2)} (> -1.0)`\n   469â†’    };\n   470â†’  }\n   471â†’\n   472â†’  /**\n   473â†’   * BURNOUT AND FATIGUE METRICS\n   474â†’   */\n   475â†’\n   476â†’  /**\n   477â†’   * Metric 1: Delta Activity (Frontal Delta)\n   478â†’   * Eyes Open, Fz Delta Z-score\n   479â†’   * Pass if < 1.0 (not elevated)\n   480â†’   */\n   481â†’  calculateDeltaActivity() {\n   482â†’    const fzDelta = this.getZScore('EO', 'absolute', 'Fz', 'Delta');\n   483â†’\n   484â†’    if (fzDelta == null) {\n   485â†’      return {\n   486â†’        name: 'Delta Activity',\n   487â†’        value: null,\n   488â†’        score: 0,\n   489â†’        interpretation: 'Insufficient data',\n   490â†’        details: 'Missing Fz Delta Z-score'\n   491â†’      };\n   492â†’    }\n   493â†’\n   494â†’    const score = this.scoreZMetric(fzDelta, THRESHOLDS.BURNOUT_AND_FATIGUE.DELTA_ACTIVITY.DELTA_ELEVATED, 'below');\n   495â†’\n   496â†’    return {\n   497â†’      name: 'Delta Activity',\n   498â†’      value: fzDelta,\n   499â†’      score,\n   500â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   501â†’      details: `Fz Delta Z-score: ${fzDelta.toFixed(2)} (< 1.0 is normal)`\n   502â†’    };\n   503â†’  }\n   504â†’\n   505â†’  /**\n   506â†’   * Metric 2: Theta Dominance\n   507â†’   * Eyes Open, Average Theta Z-score across regions\n   508â†’   * Pass if average < 1.0\n   509â†’   */\n   510â†’  calculateThetaDominance() {\n   511â†’    const fzTheta = this.getZScore('EO', 'absolute', 'Fz', 'Theta');\n   512â†’    const czTheta = this.getZScore('EO', 'absolute', 'Cz', 'Theta');\n   513â†’    const pzTheta = this.getZScore('EO', 'absolute', 'Pz', 'Theta');\n   514â†’\n   515â†’    if (fzTheta == null || czTheta == null || pzTheta == null) {\n   516â†’      return {\n   517â†’        name: 'Theta Dominance',\n   518â†’        value: null,\n   519â†’        score: 0,\n   520â†’        interpretation: 'Insufficient data',\n   521â†’        details: 'Missing Theta Z-scores'\n   522â†’      };\n   523â†’    }\n   524â†’\n   525â†’    const avgTheta = (fzTheta + czTheta + pzTheta) / 3;\n   526â†’    const score = avgTheta < THRESHOLDS.BURNOUT_AND_FATIGUE.THETA_DOMINANCE.THETA_EXCESSIVE ? 1 : 0;\n   527â†’\n   528â†’    return {\n   529â†’      name: 'Theta Dominance',\n   530â†’      value: avgTheta,\n   531â†’      score,\n   532â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   533â†’      details: `Average Theta Z-score: ${avgTheta.toFixed(2)} (< 1.0 is normal)`\n   534â†’    };\n   535â†’  }\n   536â†’\n   537â†’  /**\n   538â†’   * Metric 3: Alpha Suppression\n   539â†’   * Eyes Closed, Average Alpha Z-score\n   540â†’   * Pass if > -1.0 (not suppressed)\n   541â†’   */\n   542â†’  calculateAlphaSuppression() {\n   543â†’    const fzAlpha = this.getZScore('EC', 'absolute', 'Fz', 'Alpha');\n   544â†’    const czAlpha = this.getZScore('EC', 'absolute', 'Cz', 'Alpha');\n   545â†’    const pzAlpha = this.getZScore('EC', 'absolute', 'Pz', 'Alpha');\n   546â†’\n   547â†’    if (fzAlpha == null || czAlpha == null || pzAlpha == null) {\n   548â†’      return {\n   549â†’        name: 'Alpha Suppression',\n   550â†’        value: null,\n   551â†’        score: 0,\n   552â†’        interpretation: 'Insufficient data',\n   553â†’        details: 'Missing Alpha Z-scores'\n   554â†’      };\n   555â†’    }\n   556â†’\n   557â†’    const avgAlpha = (fzAlpha + czAlpha + pzAlpha) / 3;\n   558â†’    const score = avgAlpha > THRESHOLDS.BURNOUT_AND_FATIGUE.ALPHA_SUPPRESSION.ALPHA_LOW ? 1 : 0;\n   559â†’\n   560â†’    return {\n   561â†’      name: 'Alpha Suppression',\n   562â†’      value: avgAlpha,\n   563â†’      score,\n   564â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   565â†’      details: `Average Alpha Z-score: ${avgAlpha.toFixed(2)} (> -1.0 is normal)`\n   566â†’    };\n   567â†’  }\n   568â†’\n   569â†’  /**\n   570â†’   * EMOTIONAL REGULATION METRICS\n   571â†’   */\n   572â†’\n   573â†’  /**\n   574â†’   * Metric 1: Right Frontal Alpha\n   575â†’   * Eyes Closed, F4 Alpha Z-score\n   576â†’   * Pass if > -1.0 (not reduced)\n   577â†’   */\n   578â†’  calculateRightFrontalAlpha() {\n   579â†’    const f4Alpha = this.getZScore('EC', 'absolute', 'F4', 'Alpha');\n   580â†’\n   581â†’    if (f4Alpha == null) {\n   582â†’      return {\n   583â†’        name: 'Right Frontal Alpha',\n   584â†’        value: null,\n   585â†’        score: 0,\n   586â†’        interpretation: 'Insufficient data',\n   587â†’        details: 'Missing F4 Alpha Z-score'\n   588â†’      };\n   589â†’    }\n   590â†’\n   591â†’    const score = this.scoreZMetric(f4Alpha, THRESHOLDS.EMOTIONAL_REGULATION.RIGHT_FRONTAL_ALPHA.ALPHA_LOW, 'above');\n   592â†’\n   593â†’    return {\n   594â†’      name: 'Right Frontal Alpha',\n   595â†’      value: f4Alpha,\n   596â†’      score,\n   597â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   598â†’      details: `F4 Alpha Z-score: ${f4Alpha.toFixed(2)} (> -1.0 is normal)`\n   599â†’    };\n   600â†’  }\n   601â†’\n   602â†’  /**\n   603â†’   * Metric 2: Alpha Asymmetry (F3-F4)\n   604â†’   * Eyes Closed, F3 and F4 Alpha Z-score difference\n   605â†’   * Pass if |difference| < 1.0\n   606â†’   */\n   607â†’  calculateAlphaAsymmetry() {\n   608â†’    const f3Alpha = this.getZScore('EC', 'absolute', 'F3', 'Alpha');\n   609â†’    const f4Alpha = this.getZScore('EC', 'absolute', 'F4', 'Alpha');\n   610â†’\n   611â†’    if (f3Alpha == null || f4Alpha == null) {\n   612â†’      return {\n   613â†’        name: 'Alpha Asymmetry',\n   614â†’        value: null,\n   615â†’        score: 0,\n   616â†’        interpretation: 'Insufficient data',\n   617â†’        details: 'Missing F3/F4 Alpha Z-scores'\n   618â†’      };\n   619â†’    }\n   620â†’\n   621â†’    const asymmetry = Math.abs(f3Alpha - f4Alpha);\n   622â†’    const score = asymmetry < THRESHOLDS.EMOTIONAL_REGULATION.ALPHA_ASYMMETRY.ASYMMETRY_THRESHOLD ? 1 : 0;\n   623â†’\n   624â†’    return {\n   625â†’      name: 'Alpha Asymmetry',\n   626â†’      value: { f3Alpha, f4Alpha, asymmetry },\n   627â†’      score,\n   628â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   629â†’      details: `F3 Alpha Z=${f3Alpha.toFixed(2)}, F4 Alpha Z=${f4Alpha.toFixed(2)}, Asymmetry=${asymmetry.toFixed(2)} (< 1.0 is normal)`\n   630â†’    };\n   631â†’  }\n   632â†’\n   633â†’  /**\n   634â†’   * Metric 3: Beta Stress Response\n   635â†’   * Eyes Open, Frontal Beta Z-scores\n   636â†’   * Pass if both F3 and F4 < 1.0\n   637â†’   */\n   638â†’  calculateBetaStress() {\n   639â†’    const f3Beta = this.getZScore('EO', 'absolute', 'F3', 'Beta');\n   640â†’    const f4Beta = this.getZScore('EO', 'absolute', 'F4', 'Beta');\n   641â†’\n   642â†’    if (f3Beta == null || f4Beta == null) {\n   643â†’      return {\n   644â†’        name: 'Beta Stress Response',\n   645â†’        value: null,\n   646â†’        score: 0,\n   647â†’        interpretation: 'Insufficient data',\n   648â†’        details: 'Missing F3/F4 Beta Z-scores'\n   649â†’      };\n   650â†’    }\n   651â†’\n   652â†’    const score = (f3Beta < THRESHOLDS.EMOTIONAL_REGULATION.BETA_STRESS.BETA_ELEVATED &&\n   653â†’                   f4Beta < THRESHOLDS.EMOTIONAL_REGULATION.BETA_STRESS.BETA_ELEVATED) ? 1 : 0;\n   654â†’\n   655â†’    return {\n   656â†’      name: 'Beta Stress Response',\n   657â†’      value: { f3Beta, f4Beta },\n   658â†’      score,\n   659â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   660â†’      details: `F3 Beta Z=${f3Beta.toFixed(2)}, F4 Beta Z=${f4Beta.toFixed(2)} (< 1.0 is normal)`\n   661â†’    };\n   662â†’  }\n   663â†’\n   664â†’  /**\n   665â†’   * LEARNING METRICS\n   666â†’   */\n   667â†’\n   668â†’  /**\n   669â†’   * Metric 1: Central Theta\n   670â†’   * Eyes Closed, Cz Theta Z-score\n   671â†’   * Pass if within Â±1.0\n   672â†’   */\n   673â†’  calculateCentralTheta() {\n   674â†’    const czTheta = this.getZScore('EC', 'absolute', 'Cz', 'Theta');\n   675â†’\n   676â†’    if (czTheta == null) {\n   677â†’      return {\n   678â†’        name: 'Central Theta',\n   679â†’        value: null,\n   680â†’        score: 0,\n   681â†’        interpretation: 'Insufficient data',\n   682â†’        details: 'Missing Cz Theta Z-score'\n   683â†’      };\n   684â†’    }\n   685â†’\n   686â†’    const score = this.scoreZMetric(czTheta, THRESHOLDS.LEARNING.CENTRAL_THETA.NORMAL_RANGE, 'within');\n   687â†’\n   688â†’    return {\n   689â†’      name: 'Central Theta',\n   690â†’      value: czTheta,\n   691â†’      score,\n   692â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   693â†’      details: `Cz Theta Z-score: ${czTheta.toFixed(2)} (within Â±1.0 is normal)`\n   694â†’    };\n   695â†’  }\n   696â†’\n   697â†’  /**\n   698â†’   * Metric 2: Alpha Modulation\n   699â†’   * Eyes Closed, Cz Alpha Z-score\n   700â†’   * Pass if within Â±1.0\n   701â†’   */\n   702â†’  calculateAlphaModulation() {\n   703â†’    const czAlpha = this.getZScore('EC', 'absolute', 'Cz', 'Alpha');\n   704â†’\n   705â†’    if (czAlpha == null) {\n   706â†’      return {\n   707â†’        name: 'Alpha Modulation',\n   708â†’        value: null,\n   709â†’        score: 0,\n   710â†’        interpretation: 'Insufficient data',\n   711â†’        details: 'Missing Cz Alpha Z-score'\n   712â†’      };\n   713â†’    }\n   714â†’\n   715â†’    const score = this.scoreZMetric(czAlpha, THRESHOLDS.LEARNING.ALPHA_MODULATION.NORMAL_RANGE, 'within');\n   716â†’\n   717â†’    return {\n   718â†’      name: 'Alpha Modulation',\n   719â†’      value: czAlpha,\n   720â†’      score,\n   721â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   722â†’      details: `Cz Alpha Z-score: ${czAlpha.toFixed(2)} (within Â±1.0 is normal)`\n   723â†’    };\n   724â†’  }\n   725â†’\n   726â†’  /**\n   727â†’   * Metric 3: Beta Engagement\n   728â†’   * Eyes Open, Cz Beta Z-score\n   729â†’   * Pass if within Â±1.0\n   730â†’   */\n   731â†’  calculateBetaEngagement() {\n   732â†’    const czBeta = this.getZScore('EO', 'absolute', 'Cz', 'Beta');\n   733â†’\n   734â†’    if (czBeta == null) {\n   735â†’      return {\n   736â†’        name: 'Beta Engagement',\n   737â†’        value: null,\n   738â†’        score: 0,\n   739â†’        interpretation: 'Insufficient data',\n   740â†’        details: 'Missing Cz Beta Z-score'\n   741â†’      };\n   742â†’    }\n   743â†’\n   744â†’    const score = this.scoreZMetric(czBeta, THRESHOLDS.LEARNING.BETA_ENGAGEMENT.NORMAL_RANGE, 'within');\n   745â†’\n   746â†’    return {\n   747â†’      name: 'Beta Engagement',\n   748â†’      value: czBeta,\n   749â†’      score,\n   750â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   751â†’      details: `Cz Beta Z-score: ${czBeta.toFixed(2)} (within Â±1.0 is normal)`\n   752â†’    };\n   753â†’  }\n   754â†’\n   755â†’  /**\n   756â†’   * CREATIVITY METRICS\n   757â†’   */\n   758â†’\n   759â†’  /**\n   760â†’   * Metric 1: Alpha Power\n   761â†’   * Eyes Closed, Parietal Alpha Z-scores (P3, P4, Pz)\n   762â†’   * Pass if average > -1.0\n   763â†’   */\n   764â†’  calculateAlphaPower() {\n   765â†’    const p3Alpha = this.getZScore('EC', 'absolute', 'P3', 'Alpha');\n   766â†’    const p4Alpha = this.getZScore('EC', 'absolute', 'P4', 'Alpha');\n   767â†’    const pzAlpha = this.getZScore('EC', 'absolute', 'Pz', 'Alpha');\n   768â†’\n   769â†’    if (p3Alpha == null || p4Alpha == null || pzAlpha == null) {\n   770â†’      return {\n   771â†’        name: 'Alpha Power',\n   772â†’        value: null,\n   773â†’        score: 0,\n   774â†’        interpretation: 'Insufficient data',\n   775â†’        details: 'Missing parietal Alpha Z-scores'\n   776â†’      };\n   777â†’    }\n   778â†’\n   779â†’    const avgAlpha = (p3Alpha + p4Alpha + pzAlpha) / 3;\n   780â†’    const score = avgAlpha > THRESHOLDS.CREATIVITY.ALPHA_POWER.ALPHA_LOW ? 1 : 0;\n   781â†’\n   782â†’    return {\n   783â†’      name: 'Alpha Power',\n   784â†’      value: avgAlpha,\n   785â†’      score,\n   786â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   787â†’      details: `Average parietal Alpha Z-score: ${avgAlpha.toFixed(2)} (> -1.0 is normal)`\n   788â†’    };\n   789â†’  }\n   790â†’\n   791â†’  /**\n   792â†’   * Metric 2: Theta Enhancement\n   793â†’   * Eyes Closed, Parietal Theta Z-scores\n   794â†’   * Pass if average within Â±1.0\n   795â†’   */\n   796â†’  calculateThetaEnhancement() {\n   797â†’    const p3Theta = this.getZScore('EC', 'absolute', 'P3', 'Theta');\n   798â†’    const p4Theta = this.getZScore('EC', 'absolute', 'P4', 'Theta');\n   799â†’    const pzTheta = this.getZScore('EC', 'absolute', 'Pz', 'Theta');\n   800â†’\n   801â†’    if (p3Theta == null || p4Theta == null || pzTheta == null) {\n   802â†’      return {\n   803â†’        name: 'Theta Enhancement',\n   804â†’        value: null,\n   805â†’        score: 0,\n   806â†’        interpretation: 'Insufficient data',\n   807â†’        details: 'Missing parietal Theta Z-scores'\n   808â†’      };\n   809â†’    }\n   810â†’\n   811â†’    const avgTheta = (p3Theta + p4Theta + pzTheta) / 3;\n   812â†’    const score = this.scoreZMetric(avgTheta, THRESHOLDS.CREATIVITY.THETA_ENHANCEMENT.NORMAL_RANGE, 'within');\n   813â†’\n   814â†’    return {\n   815â†’      name: 'Theta Enhancement',\n   816â†’      value: avgTheta,\n   817â†’      score,\n   818â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   819â†’      details: `Average parietal Theta Z-score: ${avgTheta.toFixed(2)} (within Â±1.0 is normal)`\n   820â†’    };\n   821â†’  }\n   822â†’\n   823â†’  /**\n   824â†’   * Metric 3: Low Beta Activity\n   825â†’   * Eyes Closed, Parietal Beta Z-scores\n   826â†’   * Pass if average < 1.0\n   827â†’   */\n   828â†’  calculateLowBeta() {\n   829â†’    const p3Beta = this.getZScore('EC', 'absolute', 'P3', 'Beta');\n   830â†’    const p4Beta = this.getZScore('EC', 'absolute', 'P4', 'Beta');\n   831â†’    const pzBeta = this.getZScore('EC', 'absolute', 'Pz', 'Beta');\n   832â†’\n   833â†’    if (p3Beta == null || p4Beta == null || pzBeta == null) {\n   834â†’      return {\n   835â†’        name: 'Low Beta Activity',\n   836â†’        value: null,\n   837â†’        score: 0,\n   838â†’        interpretation: 'Insufficient data',\n   839â†’        details: 'Missing parietal Beta Z-scores'\n   840â†’      };\n   841â†’    }\n   842â†’\n   843â†’    const avgBeta = (p3Beta + p4Beta + pzBeta) / 3;\n   844â†’    const score = avgBeta < THRESHOLDS.CREATIVITY.LOW_BETA.BETA_HIGH ? 1 : 0;\n   845â†’\n   846â†’    return {\n   847â†’      name: 'Low Beta Activity',\n   848â†’      value: avgBeta,\n   849â†’      score,\n   850â†’      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n   851â†’      details: `Average parietal Beta Z-score: ${avgBeta.toFixed(2)} (< 1.0 is normal)`\n   852â†’    };\n   853â†’  }\n   854â†’\n   855â†’  // ==================== PARAMETER AGGREGATIONS ====================\n   856â†’\n   857â†’  /**\n   858â†’   * Parameter 1: COGNITION (Score 0-3)\n   859â†’   */\n   860â†’  calculateCognition() {\n   861â†’    const metric1 = this.calculateFocusScore();\n   862â†’    const metric2 = this.calculateAlphaPeak();\n   863â†’    const metric3 = this.calculateAlphaThetaBalance();\n   864â†’\n   865â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   866â†’\n   867â†’    return {\n   868â†’      name: 'Cognition',\n   869â†’      score: totalScore,\n   870â†’      maxScore: 3,\n   871â†’      classification: this.classifyScore(totalScore),\n   872â†’      metrics: [metric1, metric2, metric3]\n   873â†’    };\n   874â†’  }\n   875â†’\n   876â†’  /**\n   877â†’   * Parameter 2: STRESS (Score 0-3)\n   878â†’   */\n   879â†’  calculateStress() {\n   880â†’    const metric1 = this.calculateArousalScore();\n   881â†’    const metric2 = this.calculateRelaxationScore();\n   882â†’    const metric3 = this.calculateRegeneration();\n   883â†’\n   884â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   885â†’\n   886â†’    return {\n   887â†’      name: 'Stress',\n   888â†’      score: totalScore,\n   889â†’      maxScore: 3,\n   890â†’      classification: this.classifyScore(totalScore),\n   891â†’      metrics: [metric1, metric2, metric3]\n   892â†’    };\n   893â†’  }\n   894â†’\n   895â†’  /**\n   896â†’   * Parameter 3: FOCUS AND ATTENTION (Score 0-3)\n   897â†’   */\n   898â†’  calculateFocusAttention() {\n   899â†’    const metric1 = this.calculateFocusTheta();\n   900â†’    const metric2 = this.calculateBetaCoherence();\n   901â†’    const metric3 = this.calculateThetaBetaRatio();\n   902â†’\n   903â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   904â†’\n   905â†’    return {\n   906â†’      name: 'Focus and Attention',\n   907â†’      score: totalScore,\n   908â†’      maxScore: 3,\n   909â†’      classification: this.classifyScore(totalScore),\n   910â†’      metrics: [metric1, metric2, metric3]\n   911â†’    };\n   912â†’  }\n   913â†’\n   914â†’  /**\n   915â†’   * Parameter 4: BURNOUT AND FATIGUE (Score 0-3)\n   916â†’   */\n   917â†’  calculateBurnoutFatigue() {\n   918â†’    const metric1 = this.calculateDeltaActivity();\n   919â†’    const metric2 = this.calculateThetaDominance();\n   920â†’    const metric3 = this.calculateAlphaSuppression();\n   921â†’\n   922â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   923â†’\n   924â†’    return {\n   925â†’      name: 'Burnout and Fatigue',\n   926â†’      score: totalScore,\n   927â†’      maxScore: 3,\n   928â†’      classification: this.classifyScore(totalScore),\n   929â†’      metrics: [metric1, metric2, metric3]\n   930â†’    };\n   931â†’  }\n   932â†’\n   933â†’  /**\n   934â†’   * Parameter 5: EMOTIONAL REGULATION (Score 0-3)\n   935â†’   */\n   936â†’  calculateEmotionalRegulation() {\n   937â†’    const metric1 = this.calculateRightFrontalAlpha();\n   938â†’    const metric2 = this.calculateAlphaAsymmetry();\n   939â†’    const metric3 = this.calculateBetaStress();\n   940â†’\n   941â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   942â†’\n   943â†’    return {\n   944â†’      name: 'Emotional Regulation',\n   945â†’      score: totalScore,\n   946â†’      maxScore: 3,\n   947â†’      classification: this.classifyScore(totalScore),\n   948â†’      metrics: [metric1, metric2, metric3]\n   949â†’    };\n   950â†’  }\n   951â†’\n   952â†’  /**\n   953â†’   * Parameter 6: LEARNING (Score 0-3)\n   954â†’   */\n   955â†’  calculateLearning() {\n   956â†’    const metric1 = this.calculateCentralTheta();\n   957â†’    const metric2 = this.calculateAlphaModulation();\n   958â†’    const metric3 = this.calculateBetaEngagement();\n   959â†’\n   960â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   961â†’\n   962â†’    return {\n   963â†’      name: 'Learning',\n   964â†’      score: totalScore,\n   965â†’      maxScore: 3,\n   966â†’      classification: this.classifyScore(totalScore),\n   967â†’      metrics: [metric1, metric2, metric3]\n   968â†’    };\n   969â†’  }\n   970â†’\n   971â†’  /**\n   972â†’   * Parameter 7: CREATIVITY (Score 0-3)\n   973â†’   */\n   974â†’  calculateCreativity() {\n   975â†’    const metric1 = this.calculateAlphaPower();\n   976â†’    const metric2 = this.calculateThetaEnhancement();\n   977â†’    const metric3 = this.calculateLowBeta();\n   978â†’\n   979â†’    const totalScore = metric1.score + metric2.score + metric3.score;\n   980â†’\n   981â†’    return {\n   982â†’      name: 'Creativity',\n   983â†’      score: totalScore,\n   984â†’      maxScore: 3,\n   985â†’      classification: this.classifyScore(totalScore),\n   986â†’      metrics: [metric1, metric2, metric3]\n   987â†’    };\n   988â†’  }\n   989â†’}\n   990â†’\n   991â†’module.exports = ZScoreCalculator;\n   992â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7e25889f-6099-40de-9fb5-4c184e66540a","timestamp":"2025-12-09T09:17:07.843Z","toolUseResult":{"type":"text","file":{"filePath":"D:\\Todays\\Neuro360\\server\\services\\zscoreCalculator.js","content":"/**\n * QEEG Z-Score Algorithm Calculator\n * Calculates 7 brain health parameters using Z-score data instead of raw power values\n * Z-scores represent standard deviations from age-matched norms\n * Each parameter has 3 sub-metrics, scored 0-3, classified as Low/Medium/High\n */\n\nconst THRESHOLDS = require('./zscoreThresholds');\n\nclass ZScoreCalculator {\n  constructor(qeegData) {\n    this.data = qeegData;\n    this.results = {\n      parameters: [],\n      rawCalculations: {},\n      overallScore: 0\n    };\n  }\n\n  /**\n   * Main calculation method - calculates all 7 parameters\n   */\n  calculate() {\n    console.log('\\nðŸ§® ========== STARTING Z-SCORE ALGORITHM CALCULATIONS ==========');\n    console.log('ðŸ“Š Input Data Type: Z-SCORE MODE (Standard Deviations from Age-Matched Norms)');\n    console.log('ðŸ“‹ Z-score interpretation:');\n    console.log('   â€¢ Z = 0: Average (at the norm)');\n    console.log('   â€¢ Z > 0: Above average (higher than norm)');\n    console.log('   â€¢ Z < 0: Below average (lower than norm)');\n    console.log('   â€¢ |Z| < 1.0: Within normal range (Â±1 SD)');\n    console.log('   â€¢ |Z| > 2.0: Clinically significant deviation');\n    console.log('===========================================\\n');\n\n    console.log('ðŸ› === ENHANCED Z-SCORE DEBUG MODE ACTIVATED ===');\n    console.log('ðŸ“‹ This debug output will show:');\n    console.log('   1. Every Z-score value from QEEG data');\n    console.log('   2. Threshold comparisons (e.g., within Â±1.0 SD)');\n    console.log('   3. Clinical interpretation of deviations');\n    console.log('   4. Final score aggregation for each parameter');\n    console.log('===========================================\\n');\n\n    const parameters = [\n      this.calculateCognition(),\n      this.calculateStress(),\n      this.calculateFocusAttention(),\n      this.calculateBurnoutFatigue(),\n      this.calculateEmotionalRegulation(),\n      this.calculateLearning(),\n      this.calculateCreativity()\n    ];\n\n    console.log('\\nâœ… Final 7 Parameter Scores Calculated (Z-Score Mode):');\n    parameters.forEach((p, i) => {\n      const emoji = p.score <= 1 ? 'ðŸ”´' : p.score === 2 ? 'ðŸŸ¡' : 'ðŸŸ¢';\n      console.log(`${i + 1}. ${p.name}: ${p.score}/${p.maxScore} (${p.classification}) ${emoji}`);\n      p.metrics.forEach(m => {\n        console.log(`   - ${m.name}: ${m.score} point - ${m.interpretation}`);\n      });\n    });\n\n    // === ENHANCED DEBUG: Show complete Z-score calculation summary ===\n    console.log('\\nðŸ› === DEBUG: COMPLETE Z-SCORE CALCULATION SUMMARY ===');\n    console.log('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”');\n    console.log('â”‚ Parameter                   â”‚ Score â”‚ Classificationâ”‚');\n    console.log('â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤');\n    parameters.forEach(p => {\n      const padding = ' '.repeat(28 - p.name.length);\n      console.log(`â”‚ ${p.name}${padding}â”‚  ${p.score}/3  â”‚ ${p.classification.padEnd(12)} â”‚`);\n    });\n    console.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜');\n    console.log(`\\nðŸ“Š OVERALL BRAIN HEALTH SCORE: ${parameters.reduce((sum, p) => sum + p.score, 0)}/21`);\n    console.log('=== END DEBUG: Z-SCORE CALCULATION SUMMARY ===\\n');\n\n    console.log('========== Z-SCORE CALCULATIONS COMPLETE ==========\\n');\n\n    this.results.parameters = parameters;\n    this.results.overallScore = parameters.reduce((sum, p) => sum + p.score, 0);\n\n    return this.results;\n  }\n\n  // ==================== HELPER METHODS ====================\n\n  /**\n   * Get Z-score value from QEEG data\n   * @param {string} condition - 'EC' (Eyes Closed) or 'EO' (Eyes Open)\n   * @param {string} powerType - 'absolute' or 'relative'\n   * @param {string} channel - e.g., 'Fz', 'Cz', 'Pz'\n   * @param {string} band - e.g., 'Theta', 'Alpha', 'Beta', 'HiBeta', 'Delta'\n   */\n  getZScore(condition, powerType, channel, band) {\n    try {\n      // Z-scores are stored in data[condition].zscores[powerType][channel][band]\n      return this.data[condition].zscores[powerType][channel][band];\n    } catch (error) {\n      console.error(`Error getting Z-score: ${condition}.zscores.${powerType}.${channel}.${band}`);\n      return null;\n    }\n  }\n\n  /**\n   * Check if Z-score is within normal range\n   * @param {number} zscore - The Z-score value\n   * @param {number} threshold - Threshold value (typically 1.0 or 2.0)\n   * @param {string} comparison - 'within', 'above', 'below'\n   * @returns {number} 1 if passes, 0 if fails\n   */\n  scoreZMetric(zscore, threshold, comparison = 'within') {\n    if (zscore === null || zscore === undefined) return 0;\n\n    if (comparison === 'within') {\n      // Check if Z-score is within Â±threshold (normal range)\n      return Math.abs(zscore) <= threshold ? 1 : 0;\n    } else if (comparison === 'below') {\n      // Check if Z-score is below threshold (not elevated)\n      return zscore < threshold ? 1 : 0;\n    } else if (comparison === 'above') {\n      // Check if Z-score is above threshold (not reduced)\n      return zscore > threshold ? 1 : 0;\n    }\n    return 0;\n  }\n\n  /**\n   * Classify score to bucket (Low/Medium/High)\n   */\n  classifyScore(score) {\n    if (score <= 1) return 'Low';\n    if (score === 2) return 'Medium';\n    return 'High';\n  }\n\n  // ==================== INDIVIDUAL METRICS ====================\n\n  /**\n   * COGNITION METRICS\n   */\n\n  /**\n   * Metric 1: Focus Score (Theta & Beta Z-scores)\n   * Eyes Open, Check Fz & Cz Theta and Beta Z-scores\n   * Pass if Theta Z-score < 1.0 AND Beta Z-score > -1.0\n   */\n  calculateFocusScore() {\n    console.log('\\n  ðŸ” === Calculating Focus Score (Z-Score Mode) ===');\n    console.log('  ðŸ“‹ Purpose: Assess focus based on Z-scores (deviations from age norms)');\n    console.log('  ðŸ“Š Data Source: Eyes Open (EO), Absolute Power Z-scores, Fz & Cz');\n    console.log('  ðŸŽ¯ Criteria: Theta Z < 1.0 (not elevated) AND Beta Z > -1.0 (not reduced)\\n');\n\n    const fzTheta = this.getZScore('EO', 'absolute', 'Fz', 'Theta');\n    const fzBeta = this.getZScore('EO', 'absolute', 'Fz', 'Beta');\n    const czTheta = this.getZScore('EO', 'absolute', 'Cz', 'Theta');\n    const czBeta = this.getZScore('EO', 'absolute', 'Cz', 'Beta');\n\n    console.log('  ðŸ› DEBUG - Step 1: Extract Z-Score Values');\n    console.log('     â”œâ”€ EO.zscores.absolute.Fz.Theta = ' + (fzTheta !== null ? fzTheta.toFixed(2) : 'NULL') + ' SD');\n    console.log('     â”œâ”€ EO.zscores.absolute.Fz.Beta  = ' + (fzBeta !== null ? fzBeta.toFixed(2) : 'NULL') + ' SD');\n    console.log('     â”œâ”€ EO.zscores.absolute.Cz.Theta = ' + (czTheta !== null ? czTheta.toFixed(2) : 'NULL') + ' SD');\n    console.log('     â””â”€ EO.zscores.absolute.Cz.Beta  = ' + (czBeta !== null ? czBeta.toFixed(2) : 'NULL') + ' SD');\n\n    if (fzTheta == null || fzBeta == null || czTheta == null || czBeta == null) {\n      console.log('     âŒ Missing Z-score data, returning 0');\n      return {\n        name: 'Focus Score',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Z-score data for frontal regions'\n      };\n    }\n\n    console.log('\\n  ðŸ› DEBUG - Step 2: Check Thresholds');\n    console.log('     Fz checks:');\n    console.log('     â”œâ”€ Theta Z < 1.0? ' + fzTheta.toFixed(2) + ' < 1.0 = ' + (fzTheta < THRESHOLDS.COGNITION.FOCUS_SCORE.THETA_ELEVATED));\n    console.log('     â””â”€ Beta Z > -1.0? ' + fzBeta.toFixed(2) + ' > -1.0 = ' + (fzBeta > THRESHOLDS.COGNITION.FOCUS_SCORE.BETA_REDUCED));\n\n    console.log('     Cz checks:');\n    console.log('     â”œâ”€ Theta Z < 1.0? ' + czTheta.toFixed(2) + ' < 1.0 = ' + (czTheta < THRESHOLDS.COGNITION.FOCUS_SCORE.THETA_ELEVATED));\n    console.log('     â””â”€ Beta Z > -1.0? ' + czBeta.toFixed(2) + ' > -1.0 = ' + (czBeta > THRESHOLDS.COGNITION.FOCUS_SCORE.BETA_REDUCED));\n\n    // Pass if all conditions met\n    const fzPass = fzTheta < THRESHOLDS.COGNITION.FOCUS_SCORE.THETA_ELEVATED &&\n                   fzBeta > THRESHOLDS.COGNITION.FOCUS_SCORE.BETA_REDUCED;\n    const czPass = czTheta < THRESHOLDS.COGNITION.FOCUS_SCORE.THETA_ELEVATED &&\n                   czBeta > THRESHOLDS.COGNITION.FOCUS_SCORE.BETA_REDUCED;\n\n    console.log('\\n  ðŸ› DEBUG - Step 3: Evaluate Combined Result');\n    console.log('     â”œâ”€ Fz passes all checks? ' + fzPass);\n    console.log('     â”œâ”€ Cz passes all checks? ' + czPass);\n    console.log('     â””â”€ Both regions pass? ' + (fzPass && czPass));\n\n    const score = (fzPass && czPass) ? 1 : 0;\n    console.log('     âœ… FINAL SCORE: ' + score + '/1 ' + (score === 1 ? '(OPTIMAL)' : '(SUB-OPTIMAL)'));\n\n    console.log('\\n  ðŸ’¡ Clinical Interpretation:');\n    if (score === 1) {\n      console.log('     â†’ Theta not elevated, Beta not reduced = Good attentional control');\n      console.log('     â†’ Brain shows age-appropriate focus ability');\n    } else {\n      if (fzTheta >= 1.0 || czTheta >= 1.0) {\n        console.log('     â†’ Elevated Theta = Possible attention deficits');\n      }\n      if (fzBeta <= -1.0 || czBeta <= -1.0) {\n        console.log('     â†’ Reduced Beta = Possible underarousal/low engagement');\n      }\n    }\n\n    return {\n      name: 'Focus Score',\n      value: { fzTheta, fzBeta, czTheta, czBeta },\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Fz: Theta Z=${fzTheta.toFixed(2)}, Beta Z=${fzBeta.toFixed(2)} | Cz: Theta Z=${czTheta.toFixed(2)}, Beta Z=${czBeta.toFixed(2)}`\n    };\n  }\n\n  /**\n   * Metric 2: Alpha Peak\n   * Eyes Closed, Alpha Peak Frequency Z-score\n   * Pass if Z-score within Â±1.0\n   */\n  calculateAlphaPeak() {\n    const alphaPeakZscore = this.data.EC?.special?.alphaPeakZscore || 0.0;\n\n    const score = this.scoreZMetric(alphaPeakZscore, THRESHOLDS.COGNITION.ALPHA_PEAK.NORMAL_RANGE, 'within');\n\n    return {\n      name: 'Alpha Peak',\n      value: alphaPeakZscore,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Alpha Peak Z-score: ${alphaPeakZscore.toFixed(2)} (within Â±1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 3: Alpha/Theta Balance\n   * Eyes Closed, Check if Alpha Z-score > -1.0 and Theta Z-score < 1.0 across regions\n   * Pass if all regions meet criteria\n   */\n  calculateAlphaThetaBalance() {\n    const fzAlpha = this.getZScore('EC', 'absolute', 'Fz', 'Alpha');\n    const fzTheta = this.getZScore('EC', 'absolute', 'Fz', 'Theta');\n    const czAlpha = this.getZScore('EC', 'absolute', 'Cz', 'Alpha');\n    const czTheta = this.getZScore('EC', 'absolute', 'Cz', 'Theta');\n    const pzAlpha = this.getZScore('EC', 'absolute', 'Pz', 'Alpha');\n    const pzTheta = this.getZScore('EC', 'absolute', 'Pz', 'Theta');\n\n    if (fzAlpha == null || fzTheta == null || czAlpha == null || czTheta == null || pzAlpha == null || pzTheta == null) {\n      return {\n        name: 'Alpha/Theta Balance',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Z-score data'\n      };\n    }\n\n    // Check if all regions pass\n    const allRegionsPass =\n      fzAlpha > THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.ALPHA_LOW &&\n      fzTheta < THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.THETA_HIGH &&\n      czAlpha > THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.ALPHA_LOW &&\n      czTheta < THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.THETA_HIGH &&\n      pzAlpha > THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.ALPHA_LOW &&\n      pzTheta < THRESHOLDS.COGNITION.ALPHA_THETA_BALANCE.THETA_HIGH;\n\n    const score = allRegionsPass ? 1 : 0;\n\n    return {\n      name: 'Alpha/Theta Balance',\n      value: { fzAlpha, fzTheta, czAlpha, czTheta, pzAlpha, pzTheta },\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Alpha Z-scores: Fz=${fzAlpha.toFixed(2)}, Cz=${czAlpha.toFixed(2)}, Pz=${pzAlpha.toFixed(2)} | Theta Z-scores: Fz=${fzTheta.toFixed(2)}, Cz=${czTheta.toFixed(2)}, Pz=${pzTheta.toFixed(2)}`\n    };\n  }\n\n  /**\n   * STRESS METRICS\n   */\n\n  /**\n   * Metric 1: Arousal Score (HiBeta Z-scores)\n   * Eyes Open, HiBeta Z-scores across Fz, Cz, Pz\n   * Pass if all < 1.0 (not elevated)\n   */\n  calculateArousalScore() {\n    const fzHiBeta = this.getZScore('EO', 'absolute', 'Fz', 'HiBeta');\n    const czHiBeta = this.getZScore('EO', 'absolute', 'Cz', 'HiBeta');\n    const pzHiBeta = this.getZScore('EO', 'absolute', 'Pz', 'HiBeta');\n\n    if (fzHiBeta == null || czHiBeta == null || pzHiBeta == null) {\n      return {\n        name: 'Arousal Score',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing HiBeta Z-score data'\n      };\n    }\n\n    const allWithinRange =\n      fzHiBeta < THRESHOLDS.STRESS.AROUSAL_SCORE.HIBETA_ELEVATED &&\n      czHiBeta < THRESHOLDS.STRESS.AROUSAL_SCORE.HIBETA_ELEVATED &&\n      pzHiBeta < THRESHOLDS.STRESS.AROUSAL_SCORE.HIBETA_ELEVATED;\n\n    const score = allWithinRange ? 1 : 0;\n\n    return {\n      name: 'Arousal Score',\n      value: { fzHiBeta, czHiBeta, pzHiBeta },\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `HiBeta Z-scores: Fz=${fzHiBeta.toFixed(2)}, Cz=${czHiBeta.toFixed(2)}, Pz=${pzHiBeta.toFixed(2)} (< 1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 2: Relaxation Score (Posterior Theta)\n   * Eyes Closed, Pz Theta Z-score\n   * Pass if > -1.0 (not reduced)\n   */\n  calculateRelaxationScore() {\n    const pzTheta = this.getZScore('EC', 'absolute', 'Pz', 'Theta');\n\n    if (pzTheta == null) {\n      return {\n        name: 'Relaxation Score',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Pz Theta Z-score'\n      };\n    }\n\n    const score = this.scoreZMetric(pzTheta, THRESHOLDS.STRESS.RELAXATION_SCORE.THETA_LOW, 'above');\n\n    return {\n      name: 'Relaxation Score',\n      value: pzTheta,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Pz Theta Z-score: ${pzTheta.toFixed(2)} (> -1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 3: Regeneration (Posterior Alpha)\n   * Eyes Closed, Pz Alpha Z-score\n   * Pass if > -1.0 (not reduced)\n   */\n  calculateRegeneration() {\n    const pzAlpha = this.getZScore('EC', 'absolute', 'Pz', 'Alpha');\n\n    if (pzAlpha == null) {\n      return {\n        name: 'Regeneration',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Pz Alpha Z-score'\n      };\n    }\n\n    const score = this.scoreZMetric(pzAlpha, THRESHOLDS.STRESS.REGENERATION.ALPHA_LOW, 'above');\n\n    return {\n      name: 'Regeneration',\n      value: pzAlpha,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Pz Alpha Z-score: ${pzAlpha.toFixed(2)} (> -1.0 is normal)`\n    };\n  }\n\n  /**\n   * FOCUS AND ATTENTION METRICS\n   */\n\n  /**\n   * Metric 1: Focus Theta (Frontal Theta)\n   * Eyes Open, Fz Theta Z-score\n   * Pass if < 1.0 (not elevated)\n   */\n  calculateFocusTheta() {\n    const fzTheta = this.getZScore('EO', 'absolute', 'Fz', 'Theta');\n\n    if (fzTheta == null) {\n      return {\n        name: 'Focus Theta',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Fz Theta Z-score'\n      };\n    }\n\n    const score = this.scoreZMetric(fzTheta, THRESHOLDS.FOCUS_AND_ATTENTION.FOCUS_THETA.THETA_ELEVATED, 'below');\n\n    return {\n      name: 'Focus Theta',\n      value: fzTheta,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Fz Theta Z-score: ${fzTheta.toFixed(2)} (< 1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 2: Beta Coherence (C3-C4 Beta asymmetry)\n   * Eyes Open, Check C3 and C4 Beta Z-score difference\n   * Pass if |difference| < 1.0\n   */\n  calculateBetaCoherence() {\n    const c3Beta = this.getZScore('EO', 'absolute', 'C3', 'Beta');\n    const c4Beta = this.getZScore('EO', 'absolute', 'C4', 'Beta');\n\n    if (c3Beta == null || c4Beta == null) {\n      return {\n        name: 'Beta Coherence',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing C3/C4 Beta Z-scores'\n      };\n    }\n\n    const asymmetry = Math.abs(c3Beta - c4Beta);\n    const score = asymmetry < THRESHOLDS.FOCUS_AND_ATTENTION.BETA_COHERENCE.ASYMMETRY_THRESHOLD ? 1 : 0;\n\n    return {\n      name: 'Beta Coherence',\n      value: { c3Beta, c4Beta, asymmetry },\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `C3 Beta Z=${c3Beta.toFixed(2)}, C4 Beta Z=${c4Beta.toFixed(2)}, Asymmetry=${asymmetry.toFixed(2)} (< 1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 3: Theta/Beta Ratio\n   * Eyes Open, Cz Theta and Beta Z-scores\n   * Pass if Theta < 1.0 and Beta > -1.0\n   */\n  calculateThetaBetaRatio() {\n    const czTheta = this.getZScore('EO', 'absolute', 'Cz', 'Theta');\n    const czBeta = this.getZScore('EO', 'absolute', 'Cz', 'Beta');\n\n    if (czTheta == null || czBeta == null) {\n      return {\n        name: 'Theta/Beta Ratio',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Cz Theta/Beta Z-scores'\n      };\n    }\n\n    const score = (czTheta < THRESHOLDS.FOCUS_AND_ATTENTION.THETA_BETA_RATIO.THETA_HIGH &&\n                   czBeta > THRESHOLDS.FOCUS_AND_ATTENTION.THETA_BETA_RATIO.BETA_LOW) ? 1 : 0;\n\n    return {\n      name: 'Theta/Beta Ratio',\n      value: { czTheta, czBeta },\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Cz Theta Z=${czTheta.toFixed(2)} (< 1.0), Beta Z=${czBeta.toFixed(2)} (> -1.0)`\n    };\n  }\n\n  /**\n   * BURNOUT AND FATIGUE METRICS\n   */\n\n  /**\n   * Metric 1: Delta Activity (Frontal Delta)\n   * Eyes Open, Fz Delta Z-score\n   * Pass if < 1.0 (not elevated)\n   */\n  calculateDeltaActivity() {\n    const fzDelta = this.getZScore('EO', 'absolute', 'Fz', 'Delta');\n\n    if (fzDelta == null) {\n      return {\n        name: 'Delta Activity',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Fz Delta Z-score'\n      };\n    }\n\n    const score = this.scoreZMetric(fzDelta, THRESHOLDS.BURNOUT_AND_FATIGUE.DELTA_ACTIVITY.DELTA_ELEVATED, 'below');\n\n    return {\n      name: 'Delta Activity',\n      value: fzDelta,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Fz Delta Z-score: ${fzDelta.toFixed(2)} (< 1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 2: Theta Dominance\n   * Eyes Open, Average Theta Z-score across regions\n   * Pass if average < 1.0\n   */\n  calculateThetaDominance() {\n    const fzTheta = this.getZScore('EO', 'absolute', 'Fz', 'Theta');\n    const czTheta = this.getZScore('EO', 'absolute', 'Cz', 'Theta');\n    const pzTheta = this.getZScore('EO', 'absolute', 'Pz', 'Theta');\n\n    if (fzTheta == null || czTheta == null || pzTheta == null) {\n      return {\n        name: 'Theta Dominance',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Theta Z-scores'\n      };\n    }\n\n    const avgTheta = (fzTheta + czTheta + pzTheta) / 3;\n    const score = avgTheta < THRESHOLDS.BURNOUT_AND_FATIGUE.THETA_DOMINANCE.THETA_EXCESSIVE ? 1 : 0;\n\n    return {\n      name: 'Theta Dominance',\n      value: avgTheta,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Average Theta Z-score: ${avgTheta.toFixed(2)} (< 1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 3: Alpha Suppression\n   * Eyes Closed, Average Alpha Z-score\n   * Pass if > -1.0 (not suppressed)\n   */\n  calculateAlphaSuppression() {\n    const fzAlpha = this.getZScore('EC', 'absolute', 'Fz', 'Alpha');\n    const czAlpha = this.getZScore('EC', 'absolute', 'Cz', 'Alpha');\n    const pzAlpha = this.getZScore('EC', 'absolute', 'Pz', 'Alpha');\n\n    if (fzAlpha == null || czAlpha == null || pzAlpha == null) {\n      return {\n        name: 'Alpha Suppression',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Alpha Z-scores'\n      };\n    }\n\n    const avgAlpha = (fzAlpha + czAlpha + pzAlpha) / 3;\n    const score = avgAlpha > THRESHOLDS.BURNOUT_AND_FATIGUE.ALPHA_SUPPRESSION.ALPHA_LOW ? 1 : 0;\n\n    return {\n      name: 'Alpha Suppression',\n      value: avgAlpha,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Average Alpha Z-score: ${avgAlpha.toFixed(2)} (> -1.0 is normal)`\n    };\n  }\n\n  /**\n   * EMOTIONAL REGULATION METRICS\n   */\n\n  /**\n   * Metric 1: Right Frontal Alpha\n   * Eyes Closed, F4 Alpha Z-score\n   * Pass if > -1.0 (not reduced)\n   */\n  calculateRightFrontalAlpha() {\n    const f4Alpha = this.getZScore('EC', 'absolute', 'F4', 'Alpha');\n\n    if (f4Alpha == null) {\n      return {\n        name: 'Right Frontal Alpha',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing F4 Alpha Z-score'\n      };\n    }\n\n    const score = this.scoreZMetric(f4Alpha, THRESHOLDS.EMOTIONAL_REGULATION.RIGHT_FRONTAL_ALPHA.ALPHA_LOW, 'above');\n\n    return {\n      name: 'Right Frontal Alpha',\n      value: f4Alpha,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `F4 Alpha Z-score: ${f4Alpha.toFixed(2)} (> -1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 2: Alpha Asymmetry (F3-F4)\n   * Eyes Closed, F3 and F4 Alpha Z-score difference\n   * Pass if |difference| < 1.0\n   */\n  calculateAlphaAsymmetry() {\n    const f3Alpha = this.getZScore('EC', 'absolute', 'F3', 'Alpha');\n    const f4Alpha = this.getZScore('EC', 'absolute', 'F4', 'Alpha');\n\n    if (f3Alpha == null || f4Alpha == null) {\n      return {\n        name: 'Alpha Asymmetry',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing F3/F4 Alpha Z-scores'\n      };\n    }\n\n    const asymmetry = Math.abs(f3Alpha - f4Alpha);\n    const score = asymmetry < THRESHOLDS.EMOTIONAL_REGULATION.ALPHA_ASYMMETRY.ASYMMETRY_THRESHOLD ? 1 : 0;\n\n    return {\n      name: 'Alpha Asymmetry',\n      value: { f3Alpha, f4Alpha, asymmetry },\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `F3 Alpha Z=${f3Alpha.toFixed(2)}, F4 Alpha Z=${f4Alpha.toFixed(2)}, Asymmetry=${asymmetry.toFixed(2)} (< 1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 3: Beta Stress Response\n   * Eyes Open, Frontal Beta Z-scores\n   * Pass if both F3 and F4 < 1.0\n   */\n  calculateBetaStress() {\n    const f3Beta = this.getZScore('EO', 'absolute', 'F3', 'Beta');\n    const f4Beta = this.getZScore('EO', 'absolute', 'F4', 'Beta');\n\n    if (f3Beta == null || f4Beta == null) {\n      return {\n        name: 'Beta Stress Response',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing F3/F4 Beta Z-scores'\n      };\n    }\n\n    const score = (f3Beta < THRESHOLDS.EMOTIONAL_REGULATION.BETA_STRESS.BETA_ELEVATED &&\n                   f4Beta < THRESHOLDS.EMOTIONAL_REGULATION.BETA_STRESS.BETA_ELEVATED) ? 1 : 0;\n\n    return {\n      name: 'Beta Stress Response',\n      value: { f3Beta, f4Beta },\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `F3 Beta Z=${f3Beta.toFixed(2)}, F4 Beta Z=${f4Beta.toFixed(2)} (< 1.0 is normal)`\n    };\n  }\n\n  /**\n   * LEARNING METRICS\n   */\n\n  /**\n   * Metric 1: Central Theta\n   * Eyes Closed, Cz Theta Z-score\n   * Pass if within Â±1.0\n   */\n  calculateCentralTheta() {\n    const czTheta = this.getZScore('EC', 'absolute', 'Cz', 'Theta');\n\n    if (czTheta == null) {\n      return {\n        name: 'Central Theta',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Cz Theta Z-score'\n      };\n    }\n\n    const score = this.scoreZMetric(czTheta, THRESHOLDS.LEARNING.CENTRAL_THETA.NORMAL_RANGE, 'within');\n\n    return {\n      name: 'Central Theta',\n      value: czTheta,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Cz Theta Z-score: ${czTheta.toFixed(2)} (within Â±1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 2: Alpha Modulation\n   * Eyes Closed, Cz Alpha Z-score\n   * Pass if within Â±1.0\n   */\n  calculateAlphaModulation() {\n    const czAlpha = this.getZScore('EC', 'absolute', 'Cz', 'Alpha');\n\n    if (czAlpha == null) {\n      return {\n        name: 'Alpha Modulation',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Cz Alpha Z-score'\n      };\n    }\n\n    const score = this.scoreZMetric(czAlpha, THRESHOLDS.LEARNING.ALPHA_MODULATION.NORMAL_RANGE, 'within');\n\n    return {\n      name: 'Alpha Modulation',\n      value: czAlpha,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Cz Alpha Z-score: ${czAlpha.toFixed(2)} (within Â±1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 3: Beta Engagement\n   * Eyes Open, Cz Beta Z-score\n   * Pass if within Â±1.0\n   */\n  calculateBetaEngagement() {\n    const czBeta = this.getZScore('EO', 'absolute', 'Cz', 'Beta');\n\n    if (czBeta == null) {\n      return {\n        name: 'Beta Engagement',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing Cz Beta Z-score'\n      };\n    }\n\n    const score = this.scoreZMetric(czBeta, THRESHOLDS.LEARNING.BETA_ENGAGEMENT.NORMAL_RANGE, 'within');\n\n    return {\n      name: 'Beta Engagement',\n      value: czBeta,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Cz Beta Z-score: ${czBeta.toFixed(2)} (within Â±1.0 is normal)`\n    };\n  }\n\n  /**\n   * CREATIVITY METRICS\n   */\n\n  /**\n   * Metric 1: Alpha Power\n   * Eyes Closed, Parietal Alpha Z-scores (P3, P4, Pz)\n   * Pass if average > -1.0\n   */\n  calculateAlphaPower() {\n    const p3Alpha = this.getZScore('EC', 'absolute', 'P3', 'Alpha');\n    const p4Alpha = this.getZScore('EC', 'absolute', 'P4', 'Alpha');\n    const pzAlpha = this.getZScore('EC', 'absolute', 'Pz', 'Alpha');\n\n    if (p3Alpha == null || p4Alpha == null || pzAlpha == null) {\n      return {\n        name: 'Alpha Power',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing parietal Alpha Z-scores'\n      };\n    }\n\n    const avgAlpha = (p3Alpha + p4Alpha + pzAlpha) / 3;\n    const score = avgAlpha > THRESHOLDS.CREATIVITY.ALPHA_POWER.ALPHA_LOW ? 1 : 0;\n\n    return {\n      name: 'Alpha Power',\n      value: avgAlpha,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Average parietal Alpha Z-score: ${avgAlpha.toFixed(2)} (> -1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 2: Theta Enhancement\n   * Eyes Closed, Parietal Theta Z-scores\n   * Pass if average within Â±1.0\n   */\n  calculateThetaEnhancement() {\n    const p3Theta = this.getZScore('EC', 'absolute', 'P3', 'Theta');\n    const p4Theta = this.getZScore('EC', 'absolute', 'P4', 'Theta');\n    const pzTheta = this.getZScore('EC', 'absolute', 'Pz', 'Theta');\n\n    if (p3Theta == null || p4Theta == null || pzTheta == null) {\n      return {\n        name: 'Theta Enhancement',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing parietal Theta Z-scores'\n      };\n    }\n\n    const avgTheta = (p3Theta + p4Theta + pzTheta) / 3;\n    const score = this.scoreZMetric(avgTheta, THRESHOLDS.CREATIVITY.THETA_ENHANCEMENT.NORMAL_RANGE, 'within');\n\n    return {\n      name: 'Theta Enhancement',\n      value: avgTheta,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Average parietal Theta Z-score: ${avgTheta.toFixed(2)} (within Â±1.0 is normal)`\n    };\n  }\n\n  /**\n   * Metric 3: Low Beta Activity\n   * Eyes Closed, Parietal Beta Z-scores\n   * Pass if average < 1.0\n   */\n  calculateLowBeta() {\n    const p3Beta = this.getZScore('EC', 'absolute', 'P3', 'Beta');\n    const p4Beta = this.getZScore('EC', 'absolute', 'P4', 'Beta');\n    const pzBeta = this.getZScore('EC', 'absolute', 'Pz', 'Beta');\n\n    if (p3Beta == null || p4Beta == null || pzBeta == null) {\n      return {\n        name: 'Low Beta Activity',\n        value: null,\n        score: 0,\n        interpretation: 'Insufficient data',\n        details: 'Missing parietal Beta Z-scores'\n      };\n    }\n\n    const avgBeta = (p3Beta + p4Beta + pzBeta) / 3;\n    const score = avgBeta < THRESHOLDS.CREATIVITY.LOW_BETA.BETA_HIGH ? 1 : 0;\n\n    return {\n      name: 'Low Beta Activity',\n      value: avgBeta,\n      score,\n      interpretation: score === 1 ? 'âœ“ Within optimal range' : 'âœ— Outside optimal range',\n      details: `Average parietal Beta Z-score: ${avgBeta.toFixed(2)} (< 1.0 is normal)`\n    };\n  }\n\n  // ==================== PARAMETER AGGREGATIONS ====================\n\n  /**\n   * Parameter 1: COGNITION (Score 0-3)\n   */\n  calculateCognition() {\n    const metric1 = this.calculateFocusScore();\n    const metric2 = this.calculateAlphaPeak();\n    const metric3 = this.calculateAlphaThetaBalance();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n\n    return {\n      name: 'Cognition',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [metric1, metric2, metric3]\n    };\n  }\n\n  /**\n   * Parameter 2: STRESS (Score 0-3)\n   */\n  calculateStress() {\n    const metric1 = this.calculateArousalScore();\n    const metric2 = this.calculateRelaxationScore();\n    const metric3 = this.calculateRegeneration();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n\n    return {\n      name: 'Stress',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [metric1, metric2, metric3]\n    };\n  }\n\n  /**\n   * Parameter 3: FOCUS AND ATTENTION (Score 0-3)\n   */\n  calculateFocusAttention() {\n    const metric1 = this.calculateFocusTheta();\n    const metric2 = this.calculateBetaCoherence();\n    const metric3 = this.calculateThetaBetaRatio();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n\n    return {\n      name: 'Focus and Attention',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [metric1, metric2, metric3]\n    };\n  }\n\n  /**\n   * Parameter 4: BURNOUT AND FATIGUE (Score 0-3)\n   */\n  calculateBurnoutFatigue() {\n    const metric1 = this.calculateDeltaActivity();\n    const metric2 = this.calculateThetaDominance();\n    const metric3 = this.calculateAlphaSuppression();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n\n    return {\n      name: 'Burnout and Fatigue',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [metric1, metric2, metric3]\n    };\n  }\n\n  /**\n   * Parameter 5: EMOTIONAL REGULATION (Score 0-3)\n   */\n  calculateEmotionalRegulation() {\n    const metric1 = this.calculateRightFrontalAlpha();\n    const metric2 = this.calculateAlphaAsymmetry();\n    const metric3 = this.calculateBetaStress();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n\n    return {\n      name: 'Emotional Regulation',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [metric1, metric2, metric3]\n    };\n  }\n\n  /**\n   * Parameter 6: LEARNING (Score 0-3)\n   */\n  calculateLearning() {\n    const metric1 = this.calculateCentralTheta();\n    const metric2 = this.calculateAlphaModulation();\n    const metric3 = this.calculateBetaEngagement();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n\n    return {\n      name: 'Learning',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [metric1, metric2, metric3]\n    };\n  }\n\n  /**\n   * Parameter 7: CREATIVITY (Score 0-3)\n   */\n  calculateCreativity() {\n    const metric1 = this.calculateAlphaPower();\n    const metric2 = this.calculateThetaEnhancement();\n    const metric3 = this.calculateLowBeta();\n\n    const totalScore = metric1.score + metric2.score + metric3.score;\n\n    return {\n      name: 'Creativity',\n      score: totalScore,\n      maxScore: 3,\n      classification: this.classifyScore(totalScore),\n      metrics: [metric1, metric2, metric3]\n    };\n  }\n}\n\nmodule.exports = ZScoreCalculator;\n","numLines":992,"startLine":1,"totalLines":992}}}
{"parentUuid":"7e25889f-6099-40de-9fb5-4c184e66540a","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XtUPwSduEoFPG2dYC4tcGE","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me check if there's a thresholds file referenced in the Z-score calculator:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":28106,"cache_read_input_tokens":9818,"cache_creation":{"ephemeral_5m_input_tokens":28106,"ephemeral_1h_input_tokens":0},"output_tokens":82,"service_tier":"standard"}},"requestId":"req_011CVvrwQcPuZKrVpMBVsf6q","type":"assistant","uuid":"d1731ee0-ddba-414f-bdba-d037aab2816e","timestamp":"2025-12-09T09:17:13.562Z"}
{"parentUuid":"d1731ee0-ddba-414f-bdba-d037aab2816e","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01XtUPwSduEoFPG2dYC4tcGE","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01J9rbSeNVGGC6iNHa5uoaAx","name":"Glob","input":{"pattern":"**/zscoreThresholds.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":28106,"cache_read_input_tokens":9818,"cache_creation":{"ephemeral_5m_input_tokens":28106,"ephemeral_1h_input_tokens":0},"output_tokens":82,"service_tier":"standard"}},"requestId":"req_011CVvrwQcPuZKrVpMBVsf6q","type":"assistant","uuid":"7ecf6256-b70b-4b35-bb0d-64f05c147e9b","timestamp":"2025-12-09T09:17:14.001Z"}
{"parentUuid":"7ecf6256-b70b-4b35-bb0d-64f05c147e9b","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01J9rbSeNVGGC6iNHa5uoaAx","type":"tool_result","content":"D:\\Todays\\Neuro360\\server\\services\\zscoreThresholds.js"}]},"uuid":"79562128-b79c-4491-9775-66c96ac84774","timestamp":"2025-12-09T09:17:16.785Z","toolUseResult":{"filenames":["D:\\Todays\\Neuro360\\server\\services\\zscoreThresholds.js"],"durationMs":688,"numFiles":1,"truncated":false}}
{"parentUuid":"79562128-b79c-4491-9775-66c96ac84774","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011sY24udhRLaYy4amD7tvm5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AqAq4MwM2qmjzKLhyzXVGw","name":"Read","input":{"file_path":"D:\\Todays\\Neuro360\\server\\services\\zscoreThresholds.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":326,"cache_read_input_tokens":37924,"cache_creation":{"ephemeral_5m_input_tokens":326,"ephemeral_1h_input_tokens":0},"output_tokens":75,"service_tier":"standard"}},"requestId":"req_011CVvrx18YhPfADRyPFcUmw","type":"assistant","uuid":"ef08d575-d3fb-49aa-8e2e-bd974f6d2cf5","timestamp":"2025-12-09T09:17:21.053Z"}
{"parentUuid":"ef08d575-d3fb-49aa-8e2e-bd974f6d2cf5","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AqAq4MwM2qmjzKLhyzXVGw","type":"tool_result","content":"     1â†’/**\n     2â†’ * Z-Score Thresholds for Brain Performance Metrics\n     3â†’ *\n     4â†’ * Z-scores represent standard deviations from the mean:\n     5â†’ * - Negative values = below average (lower than normal)\n     6â†’ * - Zero (0) = average (normal)\n     7â†’ * - Positive values = above average (higher than normal)\n     8â†’ *\n     9â†’ * Clinical significance ranges:\n    10â†’ * - Normal range: -1.0 to +1.0 (within 1 standard deviation)\n    11â†’ * - Mild deviation: -2.0 to +2.0 (within 2 standard deviations)\n    12â†’ * - Significant deviation: beyond Â±2.0 (outside 2 standard deviations)\n    13â†’ */\n    14â†’\n    15â†’module.exports = {\n    16â†’  /**\n    17â†’   * General Z-score ranges\n    18â†’   */\n    19â†’  RANGES: {\n    20â†’    NORMAL: { min: -1.0, max: 1.0 },\n    21â†’    MILD: { min: -2.0, max: 2.0 },\n    22â†’    SIGNIFICANT_THRESHOLD: 2.0\n    23â†’  },\n    24â†’\n    25â†’  /**\n    26â†’   * Parameter 1: COGNITION\n    27â†’   *\n    28â†’   * Metric 1: Focus Score (Fz & Cz Theta/Beta ratio)\n    29â†’   * - Higher Theta/Beta ratio = poor focus\n    30â†’   * - Optimal: Z-score < 1.0 for Theta, > -1.0 for Beta\n    31â†’   */\n    32â†’  COGNITION: {\n    33â†’    FOCUS_SCORE: {\n    34â†’      THETA_ELEVATED: 1.0,        // Fz & Cz Theta Z-score should be < 1.0\n    35â†’      BETA_REDUCED: -1.0,         // Fz & Cz Beta Z-score should be > -1.0\n    36â†’      description: 'Elevated theta or reduced beta indicates attention deficit'\n    37â†’    },\n    38â†’\n    39â†’    /**\n    40â†’     * Metric 2: Alpha Peak Frequency\n    41â†’     * - Optimal: Z-score between -1.0 and +1.0 (normal range)\n    42â†’     * - Low alpha peak may indicate cognitive slowing\n    43â†’     */\n    44â†’    ALPHA_PEAK: {\n    45â†’      NORMAL_RANGE: 1.0,          // Alpha peak Z-score should be within Â±1.0\n    46â†’      description: 'Alpha peak frequency deviation from age norms'\n    47â†’    },\n    48â†’\n    49â†’    /**\n    50â†’     * Metric 3: Alpha/Theta Balance\n    51â†’     * - Ratio should be balanced\n    52â†’     * - Z-score for Alpha should be > -1.0, Theta should be < 1.0\n    53â†’     */\n    54â†’    ALPHA_THETA_BALANCE: {\n    55â†’      ALPHA_LOW: -1.0,            // Alpha Z-score should be > -1.0\n    56â†’      THETA_HIGH: 1.0,            // Theta Z-score should be < 1.0\n    57â†’      description: 'Low alpha or high theta indicates poor cognitive balance'\n    58â†’    }\n    59â†’  },\n    60â†’\n    61â†’  /**\n    62â†’   * Parameter 2: STRESS\n    63â†’   *\n    64â†’   * Metric 1: Arousal Score (HiBeta activity)\n    65â†’   * - High HiBeta = hyperarousal/stress\n    66â†’   * - Optimal: Z-score < 1.0\n    67â†’   */\n    68â†’  STRESS: {\n    69â†’    AROUSAL_SCORE: {\n    70â†’      HIBETA_ELEVATED: 1.0,       // HiBeta Z-score should be < 1.0 across Fz, Cz, Pz\n    71â†’      description: 'Elevated high beta indicates hyperarousal and stress'\n    72â†’    },\n    73â†’\n    74â†’    /**\n    75â†’     * Metric 2: Relaxation Score (Theta in posterior regions)\n    76â†’     * - Low posterior theta = inability to relax\n    77â†’     * - Optimal: Z-score > -1.0 for Pz Theta\n    78â†’     */\n    79â†’    RELAXATION_SCORE: {\n    80â†’      THETA_LOW: -1.0,            // Pz Theta Z-score should be > -1.0\n    81â†’      description: 'Low posterior theta indicates difficulty relaxing'\n    82â†’    },\n    83â†’\n    84â†’    /**\n    85â†’     * Metric 3: Regeneration (Alpha in posterior)\n    86â†’     * - Low posterior alpha = poor regeneration capacity\n    87â†’     * - Optimal: Z-score > -1.0 for Pz Alpha\n    88â†’     */\n    89â†’    REGENERATION: {\n    90â†’      ALPHA_LOW: -1.0,            // Pz Alpha Z-score should be > -1.0\n    91â†’      description: 'Low posterior alpha indicates poor regeneration'\n    92â†’    }\n    93â†’  },\n    94â†’\n    95â†’  /**\n    96â†’   * Parameter 3: FOCUS AND ATTENTION\n    97â†’   *\n    98â†’   * Metric 1: Focus Theta (Frontal Theta)\n    99â†’   * - Elevated frontal theta = attention problems\n   100â†’   * - Optimal: Z-score < 1.0\n   101â†’   */\n   102â†’  FOCUS_AND_ATTENTION: {\n   103â†’    FOCUS_THETA: {\n   104â†’      THETA_ELEVATED: 1.0,        // Fz Theta Z-score should be < 1.0\n   105â†’      description: 'Elevated frontal theta indicates attention deficit'\n   106â†’    },\n   107â†’\n   108â†’    /**\n   109â†’     * Metric 2: Beta Coherence (C3-C4)\n   110â†’     * - Imbalanced beta = attention inconsistency\n   111â†’     * - Optimal: Z-score difference < 1.0\n   112â†’     */\n   113â†’    BETA_COHERENCE: {\n   114â†’      ASYMMETRY_THRESHOLD: 1.0,   // |C3-C4 Beta Z-score difference| should be < 1.0\n   115â†’      description: 'Beta asymmetry indicates inconsistent attention'\n   116â†’    },\n   117â†’\n   118â†’    /**\n   119â†’     * Metric 3: Theta/Beta Ratio\n   120â†’     * - High ratio = ADHD-like patterns\n   121â†’     * - Optimal: Z-score < 1.0 for Theta, > -1.0 for Beta\n   122â†’     */\n   123â†’    THETA_BETA_RATIO: {\n   124â†’      THETA_HIGH: 1.0,\n   125â†’      BETA_LOW: -1.0,\n   126â†’      description: 'High theta/beta ratio indicates ADHD-like attention patterns'\n   127â†’    }\n   128â†’  },\n   129â†’\n   130â†’  /**\n   131â†’   * Parameter 4: BURNOUT AND FATIGUE\n   132â†’   *\n   133â†’   * Metric 1: Delta Activity (Frontal Delta)\n   134â†’   * - Elevated delta = fatigue/burnout\n   135â†’   * - Optimal: Z-score < 1.0\n   136â†’   */\n   137â†’  BURNOUT_AND_FATIGUE: {\n   138â†’    DELTA_ACTIVITY: {\n   139â†’      DELTA_ELEVATED: 1.0,        // Frontal Delta Z-score should be < 1.0\n   140â†’      description: 'Elevated frontal delta indicates fatigue or burnout'\n   141â†’    },\n   142â†’\n   143â†’    /**\n   144â†’     * Metric 2: Theta Dominance\n   145â†’     * - Excessive theta = drowsiness\n   146â†’     * - Optimal: Z-score < 1.0 across all regions\n   147â†’     */\n   148â†’    THETA_DOMINANCE: {\n   149â†’      THETA_EXCESSIVE: 1.0,       // Global Theta Z-score should be < 1.0\n   150â†’      description: 'Excessive theta indicates drowsiness or mental fatigue'\n   151â†’    },\n   152â†’\n   153â†’    /**\n   154â†’     * Metric 3: Alpha Suppression\n   155â†’     * - Reduced alpha = inability to rest mentally\n   156â†’     * - Optimal: Z-score > -1.0\n   157â†’     */\n   158â†’    ALPHA_SUPPRESSION: {\n   159â†’      ALPHA_LOW: -1.0,            // Alpha Z-score should be > -1.0\n   160â†’      description: 'Suppressed alpha indicates inability to rest mentally'\n   161â†’    }\n   162â†’  },\n   163â†’\n   164â†’  /**\n   165â†’   * Parameter 5: EMOTIONAL REGULATION\n   166â†’   *\n   167â†’   * Metric 1: Right Frontal Alpha\n   168â†’   * - Low right frontal alpha = poor emotional control\n   169â†’   * - Optimal: Z-score > -1.0\n   170â†’   */\n   171â†’  EMOTIONAL_REGULATION: {\n   172â†’    RIGHT_FRONTAL_ALPHA: {\n   173â†’      ALPHA_LOW: -1.0,            // F4 Alpha Z-score should be > -1.0\n   174â†’      description: 'Low right frontal alpha indicates emotional dysregulation'\n   175â†’    },\n   176â†’\n   177â†’    /**\n   178â†’     * Metric 2: Alpha Asymmetry (F3-F4)\n   179â†’     * - Imbalance indicates emotional bias\n   180â†’     * - Optimal: Z-score difference < 1.0\n   181â†’     */\n   182â†’    ALPHA_ASYMMETRY: {\n   183â†’      ASYMMETRY_THRESHOLD: 1.0,   // |F3-F4 Alpha Z-score difference| should be < 1.0\n   184â†’      description: 'Alpha asymmetry indicates emotional processing bias'\n   185â†’    },\n   186â†’\n   187â†’    /**\n   188â†’     * Metric 3: Beta Stress Response\n   189â†’     * - High frontal beta = emotional stress\n   190â†’     * - Optimal: Z-score < 1.0\n   191â†’     */\n   192â†’    BETA_STRESS: {\n   193â†’      BETA_ELEVATED: 1.0,         // F3/F4 Beta Z-score should be < 1.0\n   194â†’      description: 'Elevated frontal beta indicates emotional stress response'\n   195â†’    }\n   196â†’  },\n   197â†’\n   198â†’  /**\n   199â†’   * Parameter 6: LEARNING\n   200â†’   *\n   201â†’   * Metric 1: Central Theta\n   202â†’   * - Moderate theta aids learning, too much impairs\n   203â†’   * - Optimal: Z-score between -1.0 and +1.0\n   204â†’   */\n   205â†’  LEARNING: {\n   206â†’    CENTRAL_THETA: {\n   207â†’      NORMAL_RANGE: 1.0,          // Cz Theta Z-score should be within Â±1.0\n   208â†’      description: 'Central theta should be balanced for optimal learning'\n   209â†’    },\n   210â†’\n   211â†’    /**\n   212â†’     * Metric 2: Alpha Modulation\n   213â†’     * - Alpha should be flexible (not too high or low)\n   214â†’     * - Optimal: Z-score within Â±1.0\n   215â†’     */\n   216â†’    ALPHA_MODULATION: {\n   217â†’      NORMAL_RANGE: 1.0,          // Central Alpha Z-score should be within Â±1.0\n   218â†’      description: 'Alpha should be flexible for learning and memory encoding'\n   219â†’    },\n   220â†’\n   221â†’    /**\n   222â†’     * Metric 3: Beta Engagement\n   223â†’     * - Appropriate beta = cognitive engagement\n   224â†’     * - Optimal: Z-score within Â±1.0\n   225â†’     */\n   226â†’    BETA_ENGAGEMENT: {\n   227â†’      NORMAL_RANGE: 1.0,          // Central Beta Z-score should be within Â±1.0\n   228â†’      description: 'Beta activity should be balanced for cognitive engagement'\n   229â†’    }\n   230â†’  },\n   231â†’\n   232â†’  /**\n   233â†’   * Parameter 7: CREATIVITY\n   234â†’   *\n   235â†’   * Metric 1: Alpha Power\n   236â†’   * - Higher alpha = better creative flow\n   237â†’   * - Optimal: Z-score > -1.0\n   238â†’   */\n   239â†’  CREATIVITY: {\n   240â†’    ALPHA_POWER: {\n   241â†’      ALPHA_LOW: -1.0,            // Parietal Alpha Z-score should be > -1.0\n   242â†’      description: 'Higher alpha power supports creative thinking'\n   243â†’    },\n   244â†’\n   245â†’    /**\n   246â†’     * Metric 2: Theta Enhancement\n   247â†’     * - Moderate theta supports creativity\n   248â†’     * - Optimal: Z-score within Â±1.0\n   249â†’     */\n   250â†’    THETA_ENHANCEMENT: {\n   251â†’      NORMAL_RANGE: 1.0,          // Parietal Theta Z-score should be within Â±1.0\n   252â†’      description: 'Balanced theta supports creative insight'\n   253â†’    },\n   254â†’\n   255â†’    /**\n   256â†’     * Metric 3: Low Beta Activity\n   257â†’     * - Excessive beta inhibits creativity\n   258â†’     * - Optimal: Z-score < 1.0\n   259â†’     */\n   260â†’    LOW_BETA: {\n   261â†’      BETA_HIGH: 1.0,             // Beta Z-score should be < 1.0 in posterior regions\n   262â†’      description: 'Elevated beta may inhibit creative flow'\n   263â†’    }\n   264â†’  }\n   265â†’};\n   266â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0e292657-92dd-4052-b83d-632621e1ef94","timestamp":"2025-12-09T09:17:23.126Z","toolUseResult":{"type":"text","file":{"filePath":"D:\\Todays\\Neuro360\\server\\services\\zscoreThresholds.js","content":"/**\n * Z-Score Thresholds for Brain Performance Metrics\n *\n * Z-scores represent standard deviations from the mean:\n * - Negative values = below average (lower than normal)\n * - Zero (0) = average (normal)\n * - Positive values = above average (higher than normal)\n *\n * Clinical significance ranges:\n * - Normal range: -1.0 to +1.0 (within 1 standard deviation)\n * - Mild deviation: -2.0 to +2.0 (within 2 standard deviations)\n * - Significant deviation: beyond Â±2.0 (outside 2 standard deviations)\n */\n\nmodule.exports = {\n  /**\n   * General Z-score ranges\n   */\n  RANGES: {\n    NORMAL: { min: -1.0, max: 1.0 },\n    MILD: { min: -2.0, max: 2.0 },\n    SIGNIFICANT_THRESHOLD: 2.0\n  },\n\n  /**\n   * Parameter 1: COGNITION\n   *\n   * Metric 1: Focus Score (Fz & Cz Theta/Beta ratio)\n   * - Higher Theta/Beta ratio = poor focus\n   * - Optimal: Z-score < 1.0 for Theta, > -1.0 for Beta\n   */\n  COGNITION: {\n    FOCUS_SCORE: {\n      THETA_ELEVATED: 1.0,        // Fz & Cz Theta Z-score should be < 1.0\n      BETA_REDUCED: -1.0,         // Fz & Cz Beta Z-score should be > -1.0\n      description: 'Elevated theta or reduced beta indicates attention deficit'\n    },\n\n    /**\n     * Metric 2: Alpha Peak Frequency\n     * - Optimal: Z-score between -1.0 and +1.0 (normal range)\n     * - Low alpha peak may indicate cognitive slowing\n     */\n    ALPHA_PEAK: {\n      NORMAL_RANGE: 1.0,          // Alpha peak Z-score should be within Â±1.0\n      description: 'Alpha peak frequency deviation from age norms'\n    },\n\n    /**\n     * Metric 3: Alpha/Theta Balance\n     * - Ratio should be balanced\n     * - Z-score for Alpha should be > -1.0, Theta should be < 1.0\n     */\n    ALPHA_THETA_BALANCE: {\n      ALPHA_LOW: -1.0,            // Alpha Z-score should be > -1.0\n      THETA_HIGH: 1.0,            // Theta Z-score should be < 1.0\n      description: 'Low alpha or high theta indicates poor cognitive balance'\n    }\n  },\n\n  /**\n   * Parameter 2: STRESS\n   *\n   * Metric 1: Arousal Score (HiBeta activity)\n   * - High HiBeta = hyperarousal/stress\n   * - Optimal: Z-score < 1.0\n   */\n  STRESS: {\n    AROUSAL_SCORE: {\n      HIBETA_ELEVATED: 1.0,       // HiBeta Z-score should be < 1.0 across Fz, Cz, Pz\n      description: 'Elevated high beta indicates hyperarousal and stress'\n    },\n\n    /**\n     * Metric 2: Relaxation Score (Theta in posterior regions)\n     * - Low posterior theta = inability to relax\n     * - Optimal: Z-score > -1.0 for Pz Theta\n     */\n    RELAXATION_SCORE: {\n      THETA_LOW: -1.0,            // Pz Theta Z-score should be > -1.0\n      description: 'Low posterior theta indicates difficulty relaxing'\n    },\n\n    /**\n     * Metric 3: Regeneration (Alpha in posterior)\n     * - Low posterior alpha = poor regeneration capacity\n     * - Optimal: Z-score > -1.0 for Pz Alpha\n     */\n    REGENERATION: {\n      ALPHA_LOW: -1.0,            // Pz Alpha Z-score should be > -1.0\n      description: 'Low posterior alpha indicates poor regeneration'\n    }\n  },\n\n  /**\n   * Parameter 3: FOCUS AND ATTENTION\n   *\n   * Metric 1: Focus Theta (Frontal Theta)\n   * - Elevated frontal theta = attention problems\n   * - Optimal: Z-score < 1.0\n   */\n  FOCUS_AND_ATTENTION: {\n    FOCUS_THETA: {\n      THETA_ELEVATED: 1.0,        // Fz Theta Z-score should be < 1.0\n      description: 'Elevated frontal theta indicates attention deficit'\n    },\n\n    /**\n     * Metric 2: Beta Coherence (C3-C4)\n     * - Imbalanced beta = attention inconsistency\n     * - Optimal: Z-score difference < 1.0\n     */\n    BETA_COHERENCE: {\n      ASYMMETRY_THRESHOLD: 1.0,   // |C3-C4 Beta Z-score difference| should be < 1.0\n      description: 'Beta asymmetry indicates inconsistent attention'\n    },\n\n    /**\n     * Metric 3: Theta/Beta Ratio\n     * - High ratio = ADHD-like patterns\n     * - Optimal: Z-score < 1.0 for Theta, > -1.0 for Beta\n     */\n    THETA_BETA_RATIO: {\n      THETA_HIGH: 1.0,\n      BETA_LOW: -1.0,\n      description: 'High theta/beta ratio indicates ADHD-like attention patterns'\n    }\n  },\n\n  /**\n   * Parameter 4: BURNOUT AND FATIGUE\n   *\n   * Metric 1: Delta Activity (Frontal Delta)\n   * - Elevated delta = fatigue/burnout\n   * - Optimal: Z-score < 1.0\n   */\n  BURNOUT_AND_FATIGUE: {\n    DELTA_ACTIVITY: {\n      DELTA_ELEVATED: 1.0,        // Frontal Delta Z-score should be < 1.0\n      description: 'Elevated frontal delta indicates fatigue or burnout'\n    },\n\n    /**\n     * Metric 2: Theta Dominance\n     * - Excessive theta = drowsiness\n     * - Optimal: Z-score < 1.0 across all regions\n     */\n    THETA_DOMINANCE: {\n      THETA_EXCESSIVE: 1.0,       // Global Theta Z-score should be < 1.0\n      description: 'Excessive theta indicates drowsiness or mental fatigue'\n    },\n\n    /**\n     * Metric 3: Alpha Suppression\n     * - Reduced alpha = inability to rest mentally\n     * - Optimal: Z-score > -1.0\n     */\n    ALPHA_SUPPRESSION: {\n      ALPHA_LOW: -1.0,            // Alpha Z-score should be > -1.0\n      description: 'Suppressed alpha indicates inability to rest mentally'\n    }\n  },\n\n  /**\n   * Parameter 5: EMOTIONAL REGULATION\n   *\n   * Metric 1: Right Frontal Alpha\n   * - Low right frontal alpha = poor emotional control\n   * - Optimal: Z-score > -1.0\n   */\n  EMOTIONAL_REGULATION: {\n    RIGHT_FRONTAL_ALPHA: {\n      ALPHA_LOW: -1.0,            // F4 Alpha Z-score should be > -1.0\n      description: 'Low right frontal alpha indicates emotional dysregulation'\n    },\n\n    /**\n     * Metric 2: Alpha Asymmetry (F3-F4)\n     * - Imbalance indicates emotional bias\n     * - Optimal: Z-score difference < 1.0\n     */\n    ALPHA_ASYMMETRY: {\n      ASYMMETRY_THRESHOLD: 1.0,   // |F3-F4 Alpha Z-score difference| should be < 1.0\n      description: 'Alpha asymmetry indicates emotional processing bias'\n    },\n\n    /**\n     * Metric 3: Beta Stress Response\n     * - High frontal beta = emotional stress\n     * - Optimal: Z-score < 1.0\n     */\n    BETA_STRESS: {\n      BETA_ELEVATED: 1.0,         // F3/F4 Beta Z-score should be < 1.0\n      description: 'Elevated frontal beta indicates emotional stress response'\n    }\n  },\n\n  /**\n   * Parameter 6: LEARNING\n   *\n   * Metric 1: Central Theta\n   * - Moderate theta aids learning, too much impairs\n   * - Optimal: Z-score between -1.0 and +1.0\n   */\n  LEARNING: {\n    CENTRAL_THETA: {\n      NORMAL_RANGE: 1.0,          // Cz Theta Z-score should be within Â±1.0\n      description: 'Central theta should be balanced for optimal learning'\n    },\n\n    /**\n     * Metric 2: Alpha Modulation\n     * - Alpha should be flexible (not too high or low)\n     * - Optimal: Z-score within Â±1.0\n     */\n    ALPHA_MODULATION: {\n      NORMAL_RANGE: 1.0,          // Central Alpha Z-score should be within Â±1.0\n      description: 'Alpha should be flexible for learning and memory encoding'\n    },\n\n    /**\n     * Metric 3: Beta Engagement\n     * - Appropriate beta = cognitive engagement\n     * - Optimal: Z-score within Â±1.0\n     */\n    BETA_ENGAGEMENT: {\n      NORMAL_RANGE: 1.0,          // Central Beta Z-score should be within Â±1.0\n      description: 'Beta activity should be balanced for cognitive engagement'\n    }\n  },\n\n  /**\n   * Parameter 7: CREATIVITY\n   *\n   * Metric 1: Alpha Power\n   * - Higher alpha = better creative flow\n   * - Optimal: Z-score > -1.0\n   */\n  CREATIVITY: {\n    ALPHA_POWER: {\n      ALPHA_LOW: -1.0,            // Parietal Alpha Z-score should be > -1.0\n      description: 'Higher alpha power supports creative thinking'\n    },\n\n    /**\n     * Metric 2: Theta Enhancement\n     * - Moderate theta supports creativity\n     * - Optimal: Z-score within Â±1.0\n     */\n    THETA_ENHANCEMENT: {\n      NORMAL_RANGE: 1.0,          // Parietal Theta Z-score should be within Â±1.0\n      description: 'Balanced theta supports creative insight'\n    },\n\n    /**\n     * Metric 3: Low Beta Activity\n     * - Excessive beta inhibits creativity\n     * - Optimal: Z-score < 1.0\n     */\n    LOW_BETA: {\n      BETA_HIGH: 1.0,             // Beta Z-score should be < 1.0 in posterior regions\n      description: 'Elevated beta may inhibit creative flow'\n    }\n  }\n};\n","numLines":266,"startLine":1,"totalLines":266}}}
{"parentUuid":"0e292657-92dd-4052-b83d-632621e1ef94","isSidechain":true,"userType":"external","cwd":"D:\\Todays\\Neuro360","sessionId":"470c5952-f035-40fd-bfe4-fb0aa43c1089","version":"2.0.33","gitBranch":"main","agentId":"61c02f75","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_0141iThfzuhnnLNhee6qPyZa","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have all the information needed to create a comprehensive comparison. Let me analyze the implementation against the specification provided.\n\n## COMPREHENSIVE ANALYSIS: Algorithm Implementation vs Specification\n\nBased on my analysis of the code files (D:\\Todays\\Neuro360\\server\\services\\algorithmCalculator.js and D:\\Todays\\Neuro360\\server\\services\\zscoreCalculator.js), I can now provide a detailed comparison.\n\n### KEY FINDING: Two Different Implementations Exist\n\nThe codebase contains **TWO SEPARATE algorithm calculators**:\n1. **algorithmCalculator.js** - Uses raw power values (absolute/relative)\n2. **zscoreCalculator.js** - Uses Z-scores (standard deviations from norms)\n\n---\n\n## DETAILED COMPARISON TABLE\n\n### **1. COGNITION**\n\n| Sub-Parameter | Spec Condition | Spec Power Type | Spec Formula | Spec Threshold | Implementation (algorithmCalculator.js) | Implementation (zscoreCalculator.js) | Match Status |\n|---------------|----------------|-----------------|--------------|----------------|----------------------------------------|-------------------------------------|--------------|\n| **Focus Score (Theta:Beta)** | Eyes Open | Absolute | Average (Fz Theta/Fz Beta + Cz Theta/Cz Beta) / 2 | < 1.5 is normal | âœ… MATCHES - Lines 133-179: Uses EO absolute, calculates (FzTheta/FzBeta + CzTheta/CzBeta)/2, threshold < 1.5 | âŒ DIFFERENT APPROACH - Uses Z-scores instead: Theta Z < 1.0 AND Beta Z > -1.0 | âœ… Raw implementation MATCHES spec |\n| **Alpha Peak** | Eyes Closed | Special | Pz or below | > 9 Hz is normal | âœ… MATCHES - Lines 186-209: Uses EC special.alphaPeak, threshold > 9 | âœ… MODIFIED - Uses Z-score within Â±1.0 instead of Hz | âœ… Raw implementation MATCHES spec |\n| **Alpha:Theta Balance** | Eyes Closed | Absolute | Order: Fz > Cz > Pz | Fz>Cz>Pz is normal | âŒ **CRITICAL MISMATCH** - Lines 218-258: Implementation checks Pz > Cz > Fz (REVERSED), comment says \"posterior dominance...is actually common in eyes-closed\" | âŒ DIFFERENT - Uses Z-score thresholds Alpha > -1.0, Theta < 1.0 | âŒ **SPEC ERROR OR IMPLEMENTATION ERROR** |\n\n**CRITICAL ISSUE FOR COGNITION:**\nThe spec says \"Order: Fz > Cz > Pz\" but the implementation does \"Pz > Cz > Fz\" with a note that posterior dominance is normal for eyes-closed. This is a **fundamental discrepancy** that needs clarification.\n\n---\n\n### **2. STRESS**\n\n| Sub-Parameter | Spec Condition | Spec Power Type | Spec Formula | Spec Threshold | Implementation (algorithmCalculator.js) | Implementation (zscoreCalculator.js) | Match Status |\n|---------------|----------------|-----------------|--------------|----------------|----------------------------------------|-------------------------------------|--------------|\n| **Arousal Score (High Beta:Beta)** | Eyes Open | Absolute | Average (Fz HiBeta/Fz Beta + Cz HiBeta/Cz Beta) / 2 | < 1 is normal | âœ… MATCHES - Lines 265-299: Calculates average HiBeta/Beta ratio at Fz & Cz, threshold < 1 | âŒ DIFFERENT - Uses HiBeta Z-scores < 1.0 at Fz, Cz, Pz | âœ… Raw implementation MATCHES spec |\n| **Relaxation Score** | Eyes Closed | Absolute | EC Alpha:EC Beta at Pz | > 1 is healthy | âŒ **MISMATCH** - Lines 306-352: Uses RELATIVE power (not absolute), threshold >= 9.9 (~10) instead of > 1 | âŒ DIFFERENT - Uses Pz Theta Z-score > -1.0 | âŒ **POWER TYPE & THRESHOLD MISMATCH** |\n| **Regeneration (Alpha Modulation)** | EO & EC | Relative | Alpha Pz (EC-EO)/EC*100 | > 30% is healthy | âœ… MATCHES - Lines 359-388: Uses relative power, formula ((EC-EO)/EC)*100, threshold > 30% | âŒ DIFFERENT - Uses Pz Alpha Z-score > -1.0 | âœ… Raw implementation MATCHES spec |\n\n**CRITICAL ISSUE FOR STRESS:**\nRelaxation Score uses RELATIVE power instead of ABSOLUTE (line 312), and threshold is ~10 instead of > 1.\n\n---\n\n### **3. FOCUS & ATTENTION**\n\n| Sub-Parameter | Spec Condition | Spec Power Type | Spec Formula | Spec Threshold | Implementation (algorithmCalculator.js) | Implementation (zscoreCalculator.js) | Match Status |\n|---------------|----------------|-----------------|--------------|----------------|----------------------------------------|-------------------------------------|--------------|\n| **Focus Score Theta** | Eyes Open | Relative | Average Theta at Fz and Cz | < 20 is normal | âœ… MATCHES - Lines 395-422: Uses EO relative, averages Fz & Cz Theta, threshold < 20 | âŒ DIFFERENT - Uses Fz Theta Z-score < 1.0 | âœ… Raw implementation MATCHES spec |\n| **Alpha:Theta Balance** | Eyes Closed | Absolute | Fz>Cz>Pz | Fz>Cz>Pz is normal | âŒ **SAME ISSUE AS COGNITION** - Implementation checks Pz > Cz > Fz (reversed) | âŒ DIFFERENT - Uses Z-score \"Beta Coherence\" (C3-C4) instead | âŒ **ORDER REVERSED** |\n| **Focus Stimulus Control (Theta:Beta)** | Eyes Open | Absolute | Average at Fz and Cz | < 1.5 is normal | âœ… MATCHES - Same as Cognition Focus Score | âŒ DIFFERENT - Uses \"Theta/Beta Ratio\" with Z-scores | âœ… Raw implementation MATCHES spec |\n\n---\n\n### **4. BURNOUT & FATIGUE**\n\n| Sub-Parameter | Spec Condition | Spec Power Type | Spec Formula | Spec Threshold | Implementation (algorithmCalculator.js) | Implementation (zscoreCalculator.js) | Match Status |\n|---------------|----------------|-----------------|--------------|----------------|----------------------------------------|-------------------------------------|--------------|\n| **Arousal Score (High Beta:Beta)** | Eyes Open | Absolute | (Same as Stress) | < 1 is normal | âœ… MATCHES - Reuses same function | âŒ DIFFERENT - Uses Delta Z-score instead | âœ… Raw implementation MATCHES spec |\n| **Relaxation Score** | Eyes Closed | Absolute | (Same as Stress) | > 1 is healthy | âŒ **SAME MISMATCH AS STRESS** - Uses relative, threshold ~10 | âŒ DIFFERENT - Uses Theta Dominance Z-score | âŒ **POWER TYPE & THRESHOLD MISMATCH** |\n| **Excessive Delta** | Eyes Open | Relative | Average of 7 channels (Fz, C3, Cz, C4, P3, Pz, P4) | < 70% is normal | âœ… MATCHES - Lines 429-468: Averages 7 channels, relative power, threshold < 70 | âŒ DIFFERENT - Uses Alpha Suppression Z-score | âœ… Raw implementation MATCHES spec |\n\n---\n\n### **5. EMOTIONAL REGULATION**\n\n| Sub-Parameter | Spec Condition | Spec Power Type | Spec Formula | Spec Threshold | Implementation (algorithmCalculator.js) | Implementation (zscoreCalculator.js) | Match Status |\n|---------------|----------------|-----------------|--------------|----------------|----------------------------------------|-------------------------------------|--------------|\n| **Alpha Asymmetry Frontal** | Eyes Closed | Absolute | F4/F3 | < 1 is normal | âœ… MATCHES - Lines 475-502: Uses EC absolute, F4/F3 ratio, threshold < 1 | âš ï¸ SIMILAR - Uses Z-score asymmetry \\|F3-F4\\| < 1.0 | âœ… Raw implementation MATCHES spec |\n| **Arousal Score** | Eyes Open | Absolute | (Same as Stress) | < 1 is normal | âœ… MATCHES - Reuses same function | âš ï¸ SIMILAR - Uses \"Right Frontal Alpha\" Z-score instead | âœ… Raw implementation MATCHES spec |\n| **Regeneration Alpha Modulation** | EO & EC | Relative | (Same as Stress) | > 30% is healthy | âœ… MATCHES - Reuses same function | âŒ DIFFERENT - Uses Beta Stress Response Z-score | âœ… Raw implementation MATCHES spec |\n\n---\n\n### **6. LEARNING**\n\n| Sub-Parameter | Spec Condition | Spec Power Type | Spec Formula | Spec Threshold | Implementation (algorithmCalculator.js) | Implementation (zscoreCalculator.js) | Match Status |\n|---------------|----------------|-----------------|--------------|----------------|----------------------------------------|-------------------------------------|--------------|\n| **Peak Alpha** | Eyes Closed | Special | (Same as Cognition) | > 9 is normal | âœ… MATCHES - Reuses same function | âŒ DIFFERENT - Uses \"Central Theta\" Z-score instead | âœ… Raw implementation MATCHES spec |\n| **Focus Theta:Beta** | Eyes Open | Relative | (Same as Cognition) | < 1.5 is normal | âš ï¸ **INCONSISTENT** - Spec says \"Relative\" but Cognition uses \"Absolute\". Implementation uses absolute. | âŒ DIFFERENT - Uses \"Alpha Modulation\" Z-score | âš ï¸ **SPEC POWER TYPE UNCLEAR** |\n| **Arousal Score** | Eyes Open | Absolute | (Same as Stress) | < 1 is normal | âœ… MATCHES - Reuses same function | âŒ DIFFERENT - Uses \"Beta Engagement\" Z-score | âœ… Raw implementation MATCHES spec |\n\n**CRITICAL ISSUE FOR LEARNING:**\nSpec lists \"Focus Theta:Beta\" with \"Relative\" power type, but in Cognition section the same metric uses \"Absolute\". Implementation uses absolute power. This is a specification inconsistency.\n\n---\n\n### **7. CREATIVITY**\n\n| Sub-Parameter | Spec Condition | Spec Power Type | Spec Formula | Spec Threshold | Implementation (algorithmCalculator.js) | Implementation (zscoreCalculator.js) | Match Status |\n|---------------|----------------|-----------------|--------------|----------------|----------------------------------------|-------------------------------------|--------------|\n| **Relaxation Score** | Eyes Closed | Absolute | (Same as Stress) | > 1 is healthy | âŒ **SAME MISMATCH AS STRESS** - Uses relative, threshold ~10 | âŒ DIFFERENT - Uses \"Alpha Power\" at parietal regions | âŒ **POWER TYPE & THRESHOLD MISMATCH** |\n| **Focus Theta:Beta** | Eyes Open | Relative | (Same as Cognition) | < 1.5 is normal | âš ï¸ **INCONSISTENT** - Same power type issue as Learning | âŒ DIFFERENT - Uses \"Theta Enhancement\" Z-score | âš ï¸ **SPEC POWER TYPE UNCLEAR** |\n| **Peak Alpha** | Eyes Closed | Special | (Same as Cognition) | > 9 is normal | âœ… MATCHES - Reuses same function | âŒ DIFFERENT - Uses \"Low Beta Activity\" Z-score | âœ… Raw implementation MATCHES spec |\n\n---\n\n## SUMMARY OF CRITICAL ISSUES\n\n### âŒ **CONFIRMED MISMATCHES (algorithmCalculator.js vs Spec):**\n\n1. **Alpha:Theta Balance ORDER REVERSED**\n   - **Spec says:** Fz > Cz > Pz is normal\n   - **Code does:** Pz > Cz > Fz (lines 246)\n   - **Impact:** Affects Cognition and Focus & Attention parameters\n   - **Note:** Code comment suggests this is intentional for eyes-closed recordings\n\n2. **Relaxation Score - WRONG POWER TYPE & THRESHOLD**\n   - **Spec says:** Eyes Closed, ABSOLUTE power, EC Alpha:EC Beta at Pz, > 1 is healthy\n   - **Code does:** Eyes Closed, RELATIVE power (line 312), threshold >= 9.9 (line 335)\n   - **Impact:** Affects Stress, Burnout & Fatigue, and Creativity parameters\n   - **This is a significant discrepancy**\n\n### âš ï¸ **SPECIFICATION INCONSISTENCIES:**\n\n3. **Focus Theta:Beta Power Type Inconsistent in Spec**\n   - In Cognition: Listed as \"Absolute\"\n   - In Learning & Creativity: Listed as \"Relative\"\n   - Implementation uses Absolute consistently\n   - **Need clarification on which is correct**\n\n### âœ… **CORRECTLY IMPLEMENTED:**\n\n- Focus Score (Theta:Beta) - Formula and threshold match\n- Alpha Peak - Formula and threshold match\n- Arousal Score (High Beta:Beta) - Formula and threshold match\n- Regeneration (Alpha Modulation) - Formula and threshold match\n- Focus Score Theta - Formula and threshold match\n- Excessive Delta - Formula and threshold match\n- Alpha Asymmetry Frontal - Formula and threshold match\n\n---\n\n## Z-SCORE CALCULATOR NOTE:\n\nThe **zscoreCalculator.js** file implements a completely different approach using Z-scores (statistical deviations from age-matched norms) instead of raw power values. This appears to be an alternative algorithm, not an implementation of the provided specification. The Z-score approach:\n- Uses different metrics entirely (e.g., \"Beta Coherence\" instead of \"Alpha:Theta Balance\")\n- Uses statistical thresholds (Â±1.0 SD) instead of raw ratios\n- Is designed for comparing individual results against normative databases\n\n---\n\n## RECOMMENDATIONS:\n\n1. **Clarify Alpha:Theta Balance order** - Is Fz > Cz > Pz correct, or should it be Pz > Cz > Fz for eyes-closed?\n2. **Fix Relaxation Score** - Should use ABSOLUTE power and threshold > 1, not relative with threshold ~10\n3. **Resolve Focus Theta:Beta power type** - Should it be Absolute or Relative?\n4. **Document which calculator to use** - Raw power (algorithmCalculator.js) vs Z-score (zscoreCalculator.js)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":3984,"cache_read_input_tokens":38250,"cache_creation":{"ephemeral_5m_input_tokens":3984,"ephemeral_1h_input_tokens":0},"output_tokens":3663,"service_tier":"standard"}},"requestId":"req_011CVvrxXtyQzEvNiGfsgopM","type":"assistant","uuid":"6f07ecf8-7827-46e1-9f00-a37061ab0849","timestamp":"2025-12-09T09:18:26.143Z"}
